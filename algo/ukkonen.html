<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><title>MAXimal :: algo :: Суффиксное дерево. Алгоритм Укконена</title><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><meta name="author" lang="ru" content="e-maxx" /><meta name="description" content="Алгоритмы, олимпиадное программирование, математика" /><meta name="keywords" content="алгоритмы программирование" /><meta name="google-site-verification" content="Pnjjj2XuxB0CTiqgDDvkp79bfSeDQ8Vw57iNeDJZkSc" /><link rel="stylesheet" type="text/css" href="../data/style.css"><script type="text/javascript" src="../data/jquery.js"></script><script type="text/javascript" src="../data/page-contents.js"></script><link rel="stylesheet" type="text/css" href="../geshi/geshi.css"><!--[if IE]><style>.menu a, .menu a:hover { width: 100%; }</style><![endif]--></head><body><table class=main cellpadding=0 cellspacing=0><tr><td class=title colspan=2><p>MAXimal</p></td></tr><tr><td class=menu><ul><li><a href="../index.php.html" >home</a></li><li><a href="index.html" class=current>algo</a></li><li><a href="../bookz/index.html" >bookz</a></li><li><a href="../forum/index.html" >forum</a></li><li><a href="../about.php.html" >about</a></li></ul></td><td class=content><p class=algoinfo>добавлено: 16 Mar 2011 0:51<br>редактировано: 4 Feb 2013 0:51</p><div id="contents-table"><p id="contents-table-title">Содержание <a href="ukkonen.html#" id="contents-hide">[скрыть]</a><a href="ukkonen.html#" id="contents-show" style="display:none">[показать]</a></p><div style="display:none"></div></div><h1> Суффиксное дерево. Алгоритм Укконена </h1><p>Эта статья &mdash; временная заглушка, и не содержит никаких описаний.<p>Описание алгоритма Укконена можно найти, например, в книге Гасфилда "Строки, деревья и последовательности в алгоритмах".<p><p><h2 style="padding-top:40px;"> Реализация алгоритма Укконена </h2><p>Этот алгоритм строит суффиксное дерево для данной строки длины <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> за время <img class=tex src="../tex2png/cache/a8770007d7bdb23d5616ac746b0f45ad.png" alt="O (n \log k)">, где <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> &mdash; размер алфавита (если его считать константой, то асимптотика получается <img class=tex src="../tex2png/cache/ad5a094bea72e51fb50321739f51ec0d.png" alt="O (n)">).<p>Входными данными для алгоритма являются строка <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s"> и её длина <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n">, которые передаются в виде глобальных переменных.<p>Основная функция &mdash; <img class=tex src="../tex2png/cache/e6bcb649bfa85b55dee6b06c3f381bbb.png" alt="\rm build\_tree">, она строит суффиксное дерево. Дерево хранится в виде массива структур <img class=tex src="../tex2png/cache/9d2c84fb9b7d547b760d9dfb737ae02c.png" alt="\rm node">, где <img class=tex src="../tex2png/cache/f22334b1b28b54c904fae143c02cc864.png" alt="{\rm node}[0]"> &mdash; корень суффиксного дерева.<p>В целях простоты кода рёбра хранятся в тех же самых структурах: для каждой вершины в её структуре <img class=tex src="../tex2png/cache/9d2c84fb9b7d547b760d9dfb737ae02c.png" alt="\rm node"> записаны данные о ребре, входящем в неё из предка. Итого, в каждой <img class=tex src="../tex2png/cache/9d2c84fb9b7d547b760d9dfb737ae02c.png" alt="\rm node"> хранятся: <img class=tex src="../tex2png/cache/5da5090de09ee020bba6974c7d377e42.png" alt="(l,r)">, определяющие метку <img class=tex src="../tex2png/cache/7381dad9550107c3177adb51123e8c07.png" alt="s[l..r-1]"> ребра в предка, <img class=tex src="../tex2png/cache/3908147da516fa5e9e2af7bd0817739b.png" alt="\rm par"> &mdash; вершина-предок, <img class=tex src="../tex2png/cache/6c1897af9422bca2029401ecf0e0a332.png" alt="\rm link"> &mdash; суффиксная ссылка, <img class=tex src="../tex2png/cache/06b3d31d44619b055fe808361c9a810c.png" alt="\rm next"> &mdash; список исходящих рёбер.<p><pre class="notranslate cpp">string s<span class="sy4">;</span>
<span class="kw4">int</span> n<span class="sy4">;</span>
&nbsp;
<span class="kw4">struct</span> node <span class="br0">&#123;</span>
	<span class="kw4">int</span> l, r, par, link<span class="sy4">;</span>
	map<span class="sy1">&lt;</span><span class="kw4">char</span>,<span class="kw4">int</span><span class="sy1">&gt;</span> next<span class="sy4">;</span>
&nbsp;
	node <span class="br0">&#40;</span><span class="kw4">int</span> l<span class="sy1">=</span><span class="nu0">0</span>, <span class="kw4">int</span> r<span class="sy1">=</span><span class="nu0">0</span>, <span class="kw4">int</span> par<span class="sy1">=</span><span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span>
		<span class="sy4">:</span> l<span class="br0">&#40;</span>l<span class="br0">&#41;</span>, r<span class="br0">&#40;</span>r<span class="br0">&#41;</span>, par<span class="br0">&#40;</span>par<span class="br0">&#41;</span>, link<span class="br0">&#40;</span><span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="br0">&#125;</span>
	<span class="kw4">int</span> len<span class="br0">&#40;</span><span class="br0">&#41;</span>  <span class="br0">&#123;</span>  <span class="kw1">return</span> r <span class="sy2">-</span> l<span class="sy4">;</span>  <span class="br0">&#125;</span>
	<span class="kw4">int</span> <span class="sy3">&amp;</span>get <span class="br0">&#40;</span><span class="kw4">char</span> c<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy3">!</span>next.<span class="me1">count</span><span class="br0">&#40;</span>c<span class="br0">&#41;</span><span class="br0">&#41;</span>  next<span class="br0">&#91;</span>c<span class="br0">&#93;</span> <span class="sy1">=</span> <span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>
		<span class="kw1">return</span> next<span class="br0">&#91;</span>c<span class="br0">&#93;</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
node t<span class="br0">&#91;</span>MAXN<span class="br0">&#93;</span><span class="sy4">;</span>
<span class="kw4">int</span> sz<span class="sy4">;</span>
&nbsp;
<span class="kw4">struct</span> state <span class="br0">&#123;</span>
	<span class="kw4">int</span> v, pos<span class="sy4">;</span>
	state <span class="br0">&#40;</span><span class="kw4">int</span> v, <span class="kw4">int</span> pos<span class="br0">&#41;</span> <span class="sy4">:</span> v<span class="br0">&#40;</span>v<span class="br0">&#41;</span>, pos<span class="br0">&#40;</span>pos<span class="br0">&#41;</span>  <span class="br0">&#123;</span><span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
state ptr <span class="br0">&#40;</span><span class="nu0">0</span>, <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp;
state go <span class="br0">&#40;</span>state st, <span class="kw4">int</span> l, <span class="kw4">int</span> r<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">while</span> <span class="br0">&#40;</span>l <span class="sy1">&lt;</span> r<span class="br0">&#41;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>st.<span class="me1">pos</span> <span class="sy1">==</span> t<span class="br0">&#91;</span>st.<span class="me1">v</span><span class="br0">&#93;</span>.<span class="me1">len</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			st <span class="sy1">=</span> state <span class="br0">&#40;</span>t<span class="br0">&#91;</span>st.<span class="me1">v</span><span class="br0">&#93;</span>.<span class="me1">get</span><span class="br0">&#40;</span> s<span class="br0">&#91;</span>l<span class="br0">&#93;</span> <span class="br0">&#41;</span>, <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy4">;</span>
			<span class="kw1">if</span> <span class="br0">&#40;</span>st.<span class="me1">v</span> <span class="sy1">==</span> <span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span>  <span class="kw1">return</span> st<span class="sy4">;</span>
		<span class="br0">&#125;</span>
		<span class="kw1">else</span> <span class="br0">&#123;</span>
			<span class="kw1">if</span> <span class="br0">&#40;</span>s<span class="br0">&#91;</span> t<span class="br0">&#91;</span>st.<span class="me1">v</span><span class="br0">&#93;</span>.<span class="me1">l</span> <span class="sy2">+</span> st.<span class="me1">pos</span> <span class="br0">&#93;</span> <span class="sy3">!</span><span class="sy1">=</span> s<span class="br0">&#91;</span>l<span class="br0">&#93;</span><span class="br0">&#41;</span>
				<span class="kw1">return</span> state <span class="br0">&#40;</span><span class="sy2">-</span><span class="nu0">1</span>, <span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy4">;</span>
			<span class="kw1">if</span> <span class="br0">&#40;</span>r<span class="sy2">-</span>l <span class="sy1">&lt;</span> t<span class="br0">&#91;</span>st.<span class="me1">v</span><span class="br0">&#93;</span>.<span class="me1">len</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy2">-</span> st.<span class="me1">pos</span><span class="br0">&#41;</span>
				<span class="kw1">return</span> state <span class="br0">&#40;</span>st.<span class="me1">v</span>, st.<span class="me1">pos</span> <span class="sy2">+</span> r<span class="sy2">-</span>l<span class="br0">&#41;</span><span class="sy4">;</span>
			l <span class="sy2">+</span><span class="sy1">=</span> t<span class="br0">&#91;</span>st.<span class="me1">v</span><span class="br0">&#93;</span>.<span class="me1">len</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy2">-</span> st.<span class="me1">pos</span><span class="sy4">;</span>
			st.<span class="me1">pos</span> <span class="sy1">=</span> t<span class="br0">&#91;</span>st.<span class="me1">v</span><span class="br0">&#93;</span>.<span class="me1">len</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span>
		<span class="br0">&#125;</span>
	<span class="kw1">return</span> st<span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">int</span> split <span class="br0">&#40;</span>state st<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>st.<span class="me1">pos</span> <span class="sy1">==</span> t<span class="br0">&#91;</span>st.<span class="me1">v</span><span class="br0">&#93;</span>.<span class="me1">len</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
		<span class="kw1">return</span> st.<span class="me1">v</span><span class="sy4">;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>st.<span class="me1">pos</span> <span class="sy1">==</span> <span class="nu0">0</span><span class="br0">&#41;</span>
		<span class="kw1">return</span> t<span class="br0">&#91;</span>st.<span class="me1">v</span><span class="br0">&#93;</span>.<span class="me1">par</span><span class="sy4">;</span>
	node v <span class="sy1">=</span> t<span class="br0">&#91;</span>st.<span class="me1">v</span><span class="br0">&#93;</span><span class="sy4">;</span>
	<span class="kw4">int</span> id <span class="sy1">=</span> sz<span class="sy2">++</span><span class="sy4">;</span>
	t<span class="br0">&#91;</span>id<span class="br0">&#93;</span> <span class="sy1">=</span> node <span class="br0">&#40;</span>v.<span class="me1">l</span>, v.<span class="me1">l</span><span class="sy2">+</span>st.<span class="me1">pos</span>, v.<span class="me1">par</span><span class="br0">&#41;</span><span class="sy4">;</span>
	t<span class="br0">&#91;</span>v.<span class="me1">par</span><span class="br0">&#93;</span>.<span class="me1">get</span><span class="br0">&#40;</span> s<span class="br0">&#91;</span>v.<span class="me1">l</span><span class="br0">&#93;</span> <span class="br0">&#41;</span> <span class="sy1">=</span> id<span class="sy4">;</span>
	t<span class="br0">&#91;</span>id<span class="br0">&#93;</span>.<span class="me1">get</span><span class="br0">&#40;</span> s<span class="br0">&#91;</span>v.<span class="me1">l</span><span class="sy2">+</span>st.<span class="me1">pos</span><span class="br0">&#93;</span> <span class="br0">&#41;</span> <span class="sy1">=</span> st.<span class="me1">v</span><span class="sy4">;</span>
	t<span class="br0">&#91;</span>st.<span class="me1">v</span><span class="br0">&#93;</span>.<span class="me1">par</span> <span class="sy1">=</span> id<span class="sy4">;</span>
	t<span class="br0">&#91;</span>st.<span class="me1">v</span><span class="br0">&#93;</span>.<span class="me1">l</span> <span class="sy2">+</span><span class="sy1">=</span> st.<span class="me1">pos</span><span class="sy4">;</span>
	<span class="kw1">return</span> id<span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">int</span> get_link <span class="br0">&#40;</span><span class="kw4">int</span> v<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>t<span class="br0">&#91;</span>v<span class="br0">&#93;</span>.<span class="me1">link</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span>  <span class="kw1">return</span> t<span class="br0">&#91;</span>v<span class="br0">&#93;</span>.<span class="me1">link</span><span class="sy4">;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>t<span class="br0">&#91;</span>v<span class="br0">&#93;</span>.<span class="me1">par</span> <span class="sy1">==</span> <span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span>  <span class="kw1">return</span> <span class="nu0">0</span><span class="sy4">;</span>
	<span class="kw4">int</span> to <span class="sy1">=</span> get_link <span class="br0">&#40;</span>t<span class="br0">&#91;</span>v<span class="br0">&#93;</span>.<span class="me1">par</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">return</span> t<span class="br0">&#91;</span>v<span class="br0">&#93;</span>.<span class="me1">link</span> <span class="sy1">=</span> split <span class="br0">&#40;</span>go <span class="br0">&#40;</span>state<span class="br0">&#40;</span>to,t<span class="br0">&#91;</span>to<span class="br0">&#93;</span>.<span class="me1">len</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>, t<span class="br0">&#91;</span>v<span class="br0">&#93;</span>.<span class="me1">l</span> <span class="sy2">+</span> <span class="br0">&#40;</span>t<span class="br0">&#91;</span>v<span class="br0">&#93;</span>.<span class="me1">par</span><span class="sy1">==</span><span class="nu0">0</span><span class="br0">&#41;</span>, t<span class="br0">&#91;</span>v<span class="br0">&#93;</span>.<span class="me1">r</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">void</span> tree_extend <span class="br0">&#40;</span><span class="kw4">int</span> pos<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">for</span><span class="br0">&#40;</span><span class="sy4">;;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
		state nptr <span class="sy1">=</span> go <span class="br0">&#40;</span>ptr, pos, pos<span class="sy2">+</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy4">;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>nptr.<span class="me1">v</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			ptr <span class="sy1">=</span> nptr<span class="sy4">;</span>
			<span class="kw1">return</span><span class="sy4">;</span>
		<span class="br0">&#125;</span>
&nbsp;
		<span class="kw4">int</span> mid <span class="sy1">=</span> split <span class="br0">&#40;</span>ptr<span class="br0">&#41;</span><span class="sy4">;</span>
		<span class="kw4">int</span> leaf <span class="sy1">=</span> sz<span class="sy2">++</span><span class="sy4">;</span>
		t<span class="br0">&#91;</span>leaf<span class="br0">&#93;</span> <span class="sy1">=</span> node <span class="br0">&#40;</span>pos, n, mid<span class="br0">&#41;</span><span class="sy4">;</span>
		t<span class="br0">&#91;</span>mid<span class="br0">&#93;</span>.<span class="me1">get</span><span class="br0">&#40;</span> s<span class="br0">&#91;</span>pos<span class="br0">&#93;</span> <span class="br0">&#41;</span> <span class="sy1">=</span> leaf<span class="sy4">;</span>
&nbsp;
		ptr.<span class="me1">v</span> <span class="sy1">=</span> get_link <span class="br0">&#40;</span>mid<span class="br0">&#41;</span><span class="sy4">;</span>
		ptr.<span class="me1">pos</span> <span class="sy1">=</span> t<span class="br0">&#91;</span>ptr.<span class="me1">v</span><span class="br0">&#93;</span>.<span class="me1">len</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy3">!</span>mid<span class="br0">&#41;</span>  <span class="kw1">break</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">void</span> build_tree<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	sz <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>n<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span>
		tree_extend <span class="br0">&#40;</span>i<span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span></pre><p><p><h2 style="padding-top:40px;"> Сжатая реализация </h2><p>Приведём также следующую компактную реализацию алгоритма Укконена, предложенную <a href="http://codeforces.ru/profile/freopen">freopen</a>:<p><pre class="notranslate cpp"><span class="kw4">const</span> <span class="kw4">int</span> N<span class="sy1">=</span><span class="nu0">1000000</span>,INF<span class="sy1">=</span><span class="nu0">1000000000</span><span class="sy4">;</span>
string a<span class="sy4">;</span>
<span class="kw4">int</span> t<span class="br0">&#91;</span>N<span class="br0">&#93;</span><span class="br0">&#91;</span><span class="nu0">26</span><span class="br0">&#93;</span>,l<span class="br0">&#91;</span>N<span class="br0">&#93;</span>,r<span class="br0">&#91;</span>N<span class="br0">&#93;</span>,p<span class="br0">&#91;</span>N<span class="br0">&#93;</span>,s<span class="br0">&#91;</span>N<span class="br0">&#93;</span>,tv,tp,ts,la<span class="sy4">;</span>
&nbsp;
<span class="kw4">void</span> ukkadd <span class="br0">&#40;</span><span class="kw4">int</span> c<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	suff<span class="sy4">:;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>r<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy1">&lt;</span>tp<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>t<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="br0">&#91;</span>c<span class="br0">&#93;</span><span class="sy1">==</span><span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> t<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="br0">&#91;</span>c<span class="br0">&#93;</span><span class="sy1">=</span>ts<span class="sy4">;</span>  l<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="sy1">=</span>la<span class="sy4">;</span>
			p<span class="br0">&#91;</span>ts<span class="sy2">++</span><span class="br0">&#93;</span><span class="sy1">=</span>tv<span class="sy4">;</span>  tv<span class="sy1">=</span>s<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy4">;</span>  tp<span class="sy1">=</span>r<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy2">+</span><span class="nu0">1</span><span class="sy4">;</span>  <span class="kw1">goto</span> suff<span class="sy4">;</span> <span class="br0">&#125;</span>
		tv<span class="sy1">=</span>t<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="br0">&#91;</span>c<span class="br0">&#93;</span><span class="sy4">;</span> tp<span class="sy1">=</span>l<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>tp<span class="sy1">==</span><span class="sy2">-</span><span class="nu0">1</span> <span class="sy3">||</span> c<span class="sy1">==</span>a<span class="br0">&#91;</span>tp<span class="br0">&#93;</span><span class="sy2">-</span><span class="st0">'a'</span><span class="br0">&#41;</span> tp<span class="sy2">++</span><span class="sy4">;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
		l<span class="br0">&#91;</span>ts<span class="sy2">+</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy1">=</span>la<span class="sy4">;</span>  p<span class="br0">&#91;</span>ts<span class="sy2">+</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy1">=</span>ts<span class="sy4">;</span>
		l<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="sy1">=</span>l<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy4">;</span>  r<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="sy1">=</span>tp<span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>  p<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="sy1">=</span>p<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy4">;</span>  t<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="br0">&#91;</span>c<span class="br0">&#93;</span><span class="sy1">=</span>ts<span class="sy2">+</span><span class="nu0">1</span><span class="sy4">;</span>  t<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="br0">&#91;</span>a<span class="br0">&#91;</span>tp<span class="br0">&#93;</span><span class="sy2">-</span><span class="st0">'a'</span><span class="br0">&#93;</span><span class="sy1">=</span>tv<span class="sy4">;</span>
		l<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy1">=</span>tp<span class="sy4">;</span>  p<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy1">=</span>ts<span class="sy4">;</span>  t<span class="br0">&#91;</span>p<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="br0">&#93;</span><span class="br0">&#91;</span>a<span class="br0">&#91;</span>l<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="br0">&#93;</span><span class="sy2">-</span><span class="st0">'a'</span><span class="br0">&#93;</span><span class="sy1">=</span>ts<span class="sy4">;</span>  ts<span class="sy2">+</span><span class="sy1">=</span><span class="nu0">2</span><span class="sy4">;</span>
		tv<span class="sy1">=</span>s<span class="br0">&#91;</span>p<span class="br0">&#91;</span>ts<span class="sy2">-</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#93;</span><span class="sy4">;</span>  tp<span class="sy1">=</span>l<span class="br0">&#91;</span>ts<span class="sy2">-</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="sy4">;</span>
		<span class="kw1">while</span> <span class="br0">&#40;</span>tp<span class="sy1">&lt;=</span>r<span class="br0">&#91;</span>ts<span class="sy2">-</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>  tv<span class="sy1">=</span>t<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="br0">&#91;</span>a<span class="br0">&#91;</span>tp<span class="br0">&#93;</span><span class="sy2">-</span><span class="st0">'a'</span><span class="br0">&#93;</span><span class="sy4">;</span>  tp<span class="sy2">+</span><span class="sy1">=</span>r<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy2">-</span>l<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy2">+</span><span class="nu0">1</span><span class="sy4">;</span><span class="br0">&#125;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>tp<span class="sy1">==</span>r<span class="br0">&#91;</span>ts<span class="sy2">-</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="sy2">+</span><span class="nu0">1</span><span class="br0">&#41;</span>  s<span class="br0">&#91;</span>ts<span class="sy2">-</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="sy1">=</span>tv<span class="sy4">;</span>  <span class="kw1">else</span> s<span class="br0">&#91;</span>ts<span class="sy2">-</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="sy1">=</span>ts<span class="sy4">;</span> 
		tp<span class="sy1">=</span>r<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy2">-</span><span class="br0">&#40;</span>tp<span class="sy2">-</span>r<span class="br0">&#91;</span>ts<span class="sy2">-</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy2">+</span><span class="nu0">2</span><span class="sy4">;</span>  <span class="kw1">goto</span> suff<span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">void</span> build<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	ts<span class="sy1">=</span><span class="nu0">2</span><span class="sy4">;</span>
	tv<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span>
	tp<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span>
	fill<span class="br0">&#40;</span>r,r<span class="sy2">+</span>N,<span class="br0">&#40;</span><span class="kw4">int</span><span class="br0">&#41;</span>a.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy4">;</span>
	s<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy1">=</span><span class="nu0">1</span><span class="sy4">;</span>
	l<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy1">=</span><span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>
	r<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy1">=</span><span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>
	l<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy1">=</span><span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>
	r<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy1">=</span><span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>
	<span class="kw3">memset</span> <span class="br0">&#40;</span>t, <span class="sy2">-</span><span class="nu0">1</span>, <span class="kw3">sizeof</span> t<span class="br0">&#41;</span><span class="sy4">;</span>
	fill<span class="br0">&#40;</span>t<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>,t<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy2">+</span><span class="nu0">26</span>,<span class="nu0">0</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span>la<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> la<span class="sy1">&lt;</span><span class="br0">&#40;</span><span class="kw4">int</span><span class="br0">&#41;</span>a.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span> <span class="sy2">++</span>la<span class="br0">&#41;</span>
		ukkadd <span class="br0">&#40;</span>a<span class="br0">&#91;</span>la<span class="br0">&#93;</span><span class="sy2">-</span><span class="st0">'a'</span><span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span></pre><p>Тот же самый код, прокомментированный:<p><pre class="notranslate cpp"><span class="kw4">const</span> <span class="kw4">int</span> N<span class="sy1">=</span><span class="nu0">1000000</span>,    <span class="co1">// максимальное число вершин в суффиксном дереве</span>
	INF<span class="sy1">=</span><span class="nu0">1000000000</span><span class="sy4">;</span> <span class="co1">// константа &quot;бесконечность&quot;</span>
string a<span class="sy4">;</span>       <span class="co1">// входная строка, для которой надо построить дерево</span>
<span class="kw4">int</span> t<span class="br0">&#91;</span>N<span class="br0">&#93;</span><span class="br0">&#91;</span><span class="nu0">26</span><span class="br0">&#93;</span>,   <span class="co1">// массив переходов (состояние, буква)</span>
	l<span class="br0">&#91;</span>N<span class="br0">&#93;</span>,   <span class="co1">// левая </span>
	r<span class="br0">&#91;</span>N<span class="br0">&#93;</span>,   <span class="co1">// и правая границы подстроки из a, отвечающие ребру, входящему в вершину</span>
	p<span class="br0">&#91;</span>N<span class="br0">&#93;</span>,   <span class="co1">// предок вершины</span>
	s<span class="br0">&#91;</span>N<span class="br0">&#93;</span>,   <span class="co1">// суффиксная ссылка</span>
	tv,     <span class="co1">// вершина текущего суффикса (если мы посередине ребра, то нижняя вершина ребра)</span>
	tp,     <span class="co1">// положение в строке соответствующее месту на ребре (от l[tv] до r[tv] включительно)</span>
	ts,     <span class="co1">// количество вершин</span>
	la<span class="sy4">;</span>     <span class="co1">// текущий символ строки</span>
&nbsp;
<span class="kw4">void</span> ukkadd<span class="br0">&#40;</span><span class="kw4">int</span> c<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="co1">// дописать к дереву символ c</span>
	suff<span class="sy4">:;</span>      <span class="co1">// будем приходить сюда после каждого перехода к суффиксу (и заново добавлять символ)</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>r<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy1">&lt;</span>tp<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="co1">// проверим, не вылезли ли мы за пределы текущего ребра</span>
		<span class="co1">// если вылезли, найдем следующее ребро. Если его нет - создадим лист и прицепим к дереву</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>t<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="br0">&#91;</span>c<span class="br0">&#93;</span><span class="sy1">==</span><span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>t<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="br0">&#91;</span>c<span class="br0">&#93;</span><span class="sy1">=</span>ts<span class="sy4">;</span>l<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="sy1">=</span>la<span class="sy4">;</span>p<span class="br0">&#91;</span>ts<span class="sy2">++</span><span class="br0">&#93;</span><span class="sy1">=</span>tv<span class="sy4">;</span>tv<span class="sy1">=</span>s<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy4">;</span>tp<span class="sy1">=</span>r<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy2">+</span><span class="nu0">1</span><span class="sy4">;</span><span class="kw1">goto</span> suff<span class="sy4">;</span><span class="br0">&#125;</span>
		tv<span class="sy1">=</span>t<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="br0">&#91;</span>c<span class="br0">&#93;</span><span class="sy4">;</span>tp<span class="sy1">=</span>l<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy4">;</span> <span class="co1">// в противном случае просто перейдем к следующему ребру</span>
	<span class="br0">&#125;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>tp<span class="sy1">==</span><span class="sy2">-</span><span class="nu0">1</span> <span class="sy3">||</span> c<span class="sy1">==</span>a<span class="br0">&#91;</span>tp<span class="br0">&#93;</span><span class="sy2">-</span><span class="st0">'a'</span><span class="br0">&#41;</span> tp<span class="sy2">++</span><span class="sy4">;</span> <span class="kw1">else</span> <span class="br0">&#123;</span> <span class="co1">// если буква на ребре совпадает с c то идем по ребру, а иначе</span>
		<span class="co1">// разделяем ребро на два. Посередине - вершина ts</span>
		l<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="sy1">=</span>l<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy4">;</span>r<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="sy1">=</span>tp<span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>p<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="sy1">=</span>p<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy4">;</span>t<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="br0">&#91;</span>a<span class="br0">&#91;</span>tp<span class="br0">&#93;</span><span class="sy2">-</span><span class="st0">'a'</span><span class="br0">&#93;</span><span class="sy1">=</span>tv<span class="sy4">;</span>
		<span class="co1">// ставим лист ts+1. Он соответствует переходу по c.</span>
		t<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="br0">&#91;</span>c<span class="br0">&#93;</span><span class="sy1">=</span>ts<span class="sy2">+</span><span class="nu0">1</span><span class="sy4">;</span>l<span class="br0">&#91;</span>ts<span class="sy2">+</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy1">=</span>la<span class="sy4">;</span>p<span class="br0">&#91;</span>ts<span class="sy2">+</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy1">=</span>ts<span class="sy4">;</span>
		<span class="co1">// обновляем параметры текущей вершины. Не забыть про переход от предка tv к ts.</span>
		l<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy1">=</span>tp<span class="sy4">;</span>p<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy1">=</span>ts<span class="sy4">;</span>t<span class="br0">&#91;</span>p<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="br0">&#93;</span><span class="br0">&#91;</span>a<span class="br0">&#91;</span>l<span class="br0">&#91;</span>ts<span class="br0">&#93;</span><span class="br0">&#93;</span><span class="sy2">-</span><span class="st0">'a'</span><span class="br0">&#93;</span><span class="sy1">=</span>ts<span class="sy4">;</span>ts<span class="sy2">+</span><span class="sy1">=</span><span class="nu0">2</span><span class="sy4">;</span>
		<span class="co1">// готовимся к спуску: поднялись на ребро и перешли по суффиксной ссылке.</span>
		<span class="co1">// tp будет отмечать, где мы в текущем суффиксе.</span>
		tv<span class="sy1">=</span>s<span class="br0">&#91;</span>p<span class="br0">&#91;</span>ts<span class="sy2">-</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#93;</span><span class="sy4">;</span>tp<span class="sy1">=</span>l<span class="br0">&#91;</span>ts<span class="sy2">-</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="sy4">;</span>
		<span class="co1">// пока текущий суффикс не кончился, топаем вниз</span>
		<span class="kw1">while</span> <span class="br0">&#40;</span>tp<span class="sy1">&lt;=</span>r<span class="br0">&#91;</span>ts<span class="sy2">-</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>tv<span class="sy1">=</span>t<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="br0">&#91;</span>a<span class="br0">&#91;</span>tp<span class="br0">&#93;</span><span class="sy2">-</span><span class="st0">'a'</span><span class="br0">&#93;</span><span class="sy4">;</span>tp<span class="sy2">+</span><span class="sy1">=</span>r<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy2">-</span>l<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy2">+</span><span class="nu0">1</span><span class="sy4">;</span><span class="br0">&#125;</span>
		<span class="co1">// если мы пришли в вершину, то поставим в нее суффиксную ссылку, иначе поставим в ts</span>
		<span class="co1">// (ведь на след. итерации мы создадим ts).</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>tp<span class="sy1">==</span>r<span class="br0">&#91;</span>ts<span class="sy2">-</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="sy2">+</span><span class="nu0">1</span><span class="br0">&#41;</span> s<span class="br0">&#91;</span>ts<span class="sy2">-</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="sy1">=</span>tv<span class="sy4">;</span> <span class="kw1">else</span> s<span class="br0">&#91;</span>ts<span class="sy2">-</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="sy1">=</span>ts<span class="sy4">;</span> 
		<span class="co1">// устанавливаем tp на новое ребро и идем добавлять букву к суффиксу.</span>
		tp<span class="sy1">=</span>r<span class="br0">&#91;</span>tv<span class="br0">&#93;</span><span class="sy2">-</span><span class="br0">&#40;</span>tp<span class="sy2">-</span>r<span class="br0">&#91;</span>ts<span class="sy2">-</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy2">+</span><span class="nu0">2</span><span class="sy4">;</span><span class="kw1">goto</span> suff<span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">void</span> build<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	ts<span class="sy1">=</span><span class="nu0">2</span><span class="sy4">;</span>
	tv<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span>
	tp<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span>
	fill<span class="br0">&#40;</span>r,r<span class="sy2">+</span>N,<span class="br0">&#40;</span><span class="kw4">int</span><span class="br0">&#41;</span>a.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="co1">// инициализируем данные для корня дерева</span>
	s<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy1">=</span><span class="nu0">1</span><span class="sy4">;</span>
	l<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy1">=</span><span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>
	r<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy1">=</span><span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>
	l<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy1">=</span><span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>
	r<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy1">=</span><span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>
	<span class="kw3">memset</span> <span class="br0">&#40;</span>t, <span class="sy2">-</span><span class="nu0">1</span>, <span class="kw3">sizeof</span> t<span class="br0">&#41;</span><span class="sy4">;</span>
	fill<span class="br0">&#40;</span>t<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>,t<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy2">+</span><span class="nu0">26</span>,<span class="nu0">0</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="co1">// добавляем текст в дерево по одной букве</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span>la<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> la<span class="sy1">&lt;</span><span class="br0">&#40;</span><span class="kw4">int</span><span class="br0">&#41;</span>a.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span> <span class="sy2">++</span>la<span class="br0">&#41;</span>
		ukkadd <span class="br0">&#40;</span>a<span class="br0">&#91;</span>la<span class="br0">&#93;</span><span class="sy2">-</span><span class="st0">'a'</span><span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span></pre><p><p><p><h2 style="padding-top:40px;"> Задачи в online judges </h2><p>Задачи, которые можно решить, используя суффиксное дерево:<p><ul><p><li><a href="http://uva.onlinejudge.org/index.php?option=onlinejudge&page=show_problem&problem=1620">UVA #10679 <b>"I Love Strings!!!"</b> &nbsp;&nbsp;&nbsp;&nbsp; [сложность: средняя]</a><p></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><hr><p>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'e-maxx';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script></td></tr></table></body></html>