<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><title>MAXimal :: algo :: Поиск пары пересекающихся отрезков алгоритмом заметающей прямой (sweep line)</title><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><meta name="author" lang="ru" content="e-maxx" /><meta name="description" content="Алгоритмы, олимпиадное программирование, математика" /><meta name="keywords" content="алгоритмы программирование" /><meta name="google-site-verification" content="Pnjjj2XuxB0CTiqgDDvkp79bfSeDQ8Vw57iNeDJZkSc" /><link rel="stylesheet" type="text/css" href="../data/style.css"><script type="text/javascript" src="../data/jquery.js"></script><script type="text/javascript" src="../data/page-contents.js"></script><link rel="stylesheet" type="text/css" href="../geshi/geshi.css"><!--[if IE]><style>.menu a, .menu a:hover { width: 100%; }</style><![endif]--></head><body><table class=main cellpadding=0 cellspacing=0><tr><td class=title colspan=2><p>MAXimal</p></td></tr><tr><td class=menu><ul><li><a href="../index.php.html" >home</a></li><li><a href="index.html" class=current>algo</a></li><li><a href="../bookz/index.html" >bookz</a></li><li><a href="../forum/index.html" >forum</a></li><li><a href="../about.php.html" >about</a></li></ul></td><td class=content><p class=algoinfo>добавлено: 26 Mar 2012 1:00<br>редактировано: 26 Mar 2012 1:00</p><div id="contents-table"><p id="contents-table-title">Содержание <a href="intersecting_segments.html#" id="contents-hide">[скрыть]</a><a href="intersecting_segments.html#" id="contents-show" style="display:none">[показать]</a></p><div style="display:none"></div></div><h1> Поиск пары пересекающихся отрезков алгоритмом заметающей прямой за O (N log N) </h1><p>Даны <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> отрезков на плоскости. Требуется проверить, пересекаются ли друг с другом хотя бы два из них. (Если ответ положителен &mdash; то вывести эту пару пересекающихся отрезков; среди нескольких ответов достаточно выбрать любой из них.)<p>Наивный алгоритм решения &mdash; перебрать за <img class=tex src="../tex2png/cache/4cd2772b06262896a7cf8a9d3c989ea4.png" alt="O (n^2)"> все пары отрезков и проверить для каждой пары, пересекаются они или нет. В данной статье описывается алгоритм с временем работы <img class=tex src="../tex2png/cache/65dae66ac82f684c5b24e464a8ca3610.png" alt="O (n \log n)">, который основан на принципе <b>сканирующей (заметающей) прямой</b> (по-английски: "sweep line").<p><p><h2 style="padding-top:40px;"> Алгоритм </h2><p>Проведём мысленно вертикальную прямую <img class=tex src="../tex2png/cache/e38d24dcebd02256c0cf37f445817c41.png" alt="x = -\infty"> и начнём двигать эту прямую вправо. По ходу своего движения эта прямая будет встречаться с отрезками, причём в любой момент времени каждый отрезок будет пересекаться с нашей прямой по одной точке (мы пока будем считать, что вертикальных отрезков нет).<p><img src="sweep_line_1.png"><p>Таким образом, для каждого отрезка в какой-то момент времени его точка появится на сканирующей прямой, затем с движением прямой будет двигаться и эта точка, и, наконец, в какой-то момент отрезок исчезнет с прямой.<p>Нас интересует <b>относительный порядок отрезков</b> по вертикали. А именно, мы будем хранить список отрезков, пересекающих сканирующую прямую в данный момент времени, где отрезки будут отсортированы по их <img class=tex src="../tex2png/cache/e1fbf2db960f0155bd590871a486e78c.png" alt="y">-координате на сканирующей прямой.<p><img src="sweep_line_2.png"><p>Этот порядок интересен тем, что пересекающиеся отрезки будут иметь одинаковую <img class=tex src="../tex2png/cache/e1fbf2db960f0155bd590871a486e78c.png" alt="y">-координату хотя бы в один момент времени:<p><img src="sweep_line_3.png"><p>Сформулируем ключевые утверждения:<p><ul><p><li>Для поиска пересекающейся пары достаточно рассматривать при каждом фиксированном положении сканирующей прямой <b>только соседние отрезки</b>.<p><li>Достаточно рассматривать сканирующую прямую не во всех возможных действительных позициях <img class=tex src="../tex2png/cache/6d05743640217f86d31f42c8321b7575.png" alt="(-\infty \ldots +\infty)">, а <b>только в тех позициях, когда появляются новые отрезки или исчезают старые</b>. Иными словами, достаточно ограничиться лишь только положениями, равными абсциссам точек-концов отрезков.<p><li>При появлении нового отрезка достаточно <b>вставить</b> его в нужное место в список, полученный для предыдущей сканирующей прямой. Проверять на пересечение надо <b>только добавляемый отрезок с его непосредственными соседями в списке сверху и снизу</b>.<p><li>При исчезновении отрезка достаточно <b>удалить</b> его из текущего списка. После этого надо <b>проверить на пересечение с верхним и нижним соседями</b> в списке.<p><li>Других изменений в порядке следования отрезков в списке, кроме описанных, не существует. Других проверок на пересечения производить не надо.<p></ul><p>Для понимания истинности этих утверждений достаточно следующих замечаний:<p><ul><p><li>Два непересекающихся отрезка никогда не меняют своего <b>относительного порядка</b>.<p>В самом деле, если один отрезок сначала был выше другого, а затем стал ниже, то между двумя этими моментами произошло пересечение этих двух отрезков.<p><li>Иметь совпадающие <img class=tex src="../tex2png/cache/e1fbf2db960f0155bd590871a486e78c.png" alt="y">-координаты два непересекающихся отрезка также не могут.<p><li>Из этого следует, что в момент появления отрезка мы можем найти в очереди позицию для этого отрезка, и больше этот отрезок переставлять в очереди не придётся: его <b>порядок относительно других отрезков в очереди меняться не будет</b>.<p><li>Два пересекающихся отрезка в момент точки своего пересечения окажутся <b>соседями</b> друг друга в очереди.<p><li>Следовательно, для нахождения пары пересекающихся отрезков достаточно проверить на пересечение только все те пары отрезков, которые когда-нибудь за время движения сканирующей прямой хотя бы раз <b>были соседями друг друга</b>.<p>Легко заметить, что этого достаточно лишь проверять добавляемый отрезок со своими верхним и нижним соседями, а также при удалении отрезка &mdash; его верхнего и нижнего соседей (которые после удаления станут соседями друг друга).<p><li>Следует обратить внимание, что при фиксированном положении сканирующей прямой мы <b>сначала</b> должны произвести <b>добавление</b> всех появляющихся здесь отрезков, и лишь <b>затем</b> &mdash; <b>удаление</b> всех исчезающих здесь отрезков.<p>Тем самым, мы не пропустим пересечения отрезков по вершине: т.е. такие случаи, когда два отрезка имеют общую вершину.<p><li>Заметим, что <b>вертикальные отрезки</b> на самом деле никак не влияют на корректность алгоритма.<p>Эти отрезки выделяются тем, что они появляются и исчезают в один и тот же момент времени. Однако, за счёт предыдущего замечания, мы знаем, что сначала все отрезки будут добавлены в очередь, и лишь затем будут удалены. Следовательно, если вертикальный отрезок пересекается с каким-то другим открытым в этот момент отрезком (в том числе вертикальным), то это будет обнаружено.<p>В какое место очереди помещать вертикальные отрезки? Ведь вертикальный отрезок не имеет одной определённой <img class=tex src="../tex2png/cache/e1fbf2db960f0155bd590871a486e78c.png" alt="y">-координаты, он простирается на целый отрезок по <img class=tex src="../tex2png/cache/e1fbf2db960f0155bd590871a486e78c.png" alt="y">-координате. Однако легко понять, что в качестве <img class=tex src="../tex2png/cache/e1fbf2db960f0155bd590871a486e78c.png" alt="y">-координаты можно взять любую координату из этого отрезка.<p></ul><p>Таким образом, весь алгоритм совершит не более <img class=tex src="../tex2png/cache/02f3339bd527ea60f4b8a5fcb94023f1.png" alt="2n"> тестов на пересечение пары отрезков, и совершит <img class=tex src="../tex2png/cache/ad5a094bea72e51fb50321739f51ec0d.png" alt="O (n)"> операций с очередью отрезков (по <img class=tex src="../tex2png/cache/817532dd84d4eb666e5d80dc58098e94.png" alt="O(1)"> операций в моменты появления и исчезновения каждого отрезка).<p>Итоговая <b>асимптотика</b> алгоритма составляет, таким образом, <img class=tex src="../tex2png/cache/65dae66ac82f684c5b24e464a8ca3610.png" alt="O (n \log n)">.<p><p><h2 style="padding-top:40px;"> Реализация </h2><p>Приведём полную реализацию описанного алгоритма:<p><pre class="notranslate cpp"><span class="kw4">const</span> <span class="kw4">double</span> EPS <span class="sy1">=</span> <span class="nu19">1E-9</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">struct</span> pt <span class="br0">&#123;</span>
	<span class="kw4">double</span> x, y<span class="sy4">;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">struct</span> seg <span class="br0">&#123;</span>
	pt p, q<span class="sy4">;</span>
	<span class="kw4">int</span> id<span class="sy4">;</span>
&nbsp;
	<span class="kw4">double</span> get_y <span class="br0">&#40;</span><span class="kw4">double</span> x<span class="br0">&#41;</span> <span class="kw4">const</span> <span class="br0">&#123;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw3">abs</span> <span class="br0">&#40;</span>p.<span class="me1">x</span> <span class="sy2">-</span> q.<span class="me1">x</span><span class="br0">&#41;</span> <span class="sy1">&lt;</span> EPS<span class="br0">&#41;</span>  <span class="kw1">return</span> p.<span class="me1">y</span><span class="sy4">;</span>
		<span class="kw1">return</span> p.<span class="me1">y</span> <span class="sy2">+</span> <span class="br0">&#40;</span>q.<span class="me1">y</span> <span class="sy2">-</span> p.<span class="me1">y</span><span class="br0">&#41;</span> <span class="sy2">*</span> <span class="br0">&#40;</span>x <span class="sy2">-</span> p.<span class="me1">x</span><span class="br0">&#41;</span> <span class="sy2">/</span> <span class="br0">&#40;</span>q.<span class="me1">x</span> <span class="sy2">-</span> p.<span class="me1">x</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp;
&nbsp;
<span class="kw2">inline</span> <span class="kw4">bool</span> intersect1d <span class="br0">&#40;</span><span class="kw4">double</span> l1, <span class="kw4">double</span> r1, <span class="kw4">double</span> l2, <span class="kw4">double</span> r2<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>l1 <span class="sy1">&gt;</span> r1<span class="br0">&#41;</span>  swap <span class="br0">&#40;</span>l1, r1<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>l2 <span class="sy1">&gt;</span> r2<span class="br0">&#41;</span>  swap <span class="br0">&#40;</span>l2, r2<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">return</span> max <span class="br0">&#40;</span>l1, l2<span class="br0">&#41;</span> <span class="sy1">&lt;=</span> min <span class="br0">&#40;</span>r1, r2<span class="br0">&#41;</span> <span class="sy2">+</span> EPS<span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">inline</span> <span class="kw4">int</span> vec <span class="br0">&#40;</span><span class="kw4">const</span> pt <span class="sy3">&amp;</span> a, <span class="kw4">const</span> pt <span class="sy3">&amp;</span> b, <span class="kw4">const</span> pt <span class="sy3">&amp;</span> c<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw4">double</span> s <span class="sy1">=</span> <span class="br0">&#40;</span>b.<span class="me1">x</span> <span class="sy2">-</span> a.<span class="me1">x</span><span class="br0">&#41;</span> <span class="sy2">*</span> <span class="br0">&#40;</span>c.<span class="me1">y</span> <span class="sy2">-</span> a.<span class="me1">y</span><span class="br0">&#41;</span> <span class="sy2">-</span> <span class="br0">&#40;</span>b.<span class="me1">y</span> <span class="sy2">-</span> a.<span class="me1">y</span><span class="br0">&#41;</span> <span class="sy2">*</span> <span class="br0">&#40;</span>c.<span class="me1">x</span> <span class="sy2">-</span> a.<span class="me1">x</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">return</span> <span class="kw3">abs</span><span class="br0">&#40;</span>s<span class="br0">&#41;</span><span class="sy1">&lt;</span>EPS <span class="sy4">?</span> <span class="nu0">0</span> <span class="sy4">:</span> s<span class="sy1">&gt;</span><span class="nu0">0</span> <span class="sy4">?</span> <span class="sy2">+</span><span class="nu0">1</span> <span class="sy4">:</span> <span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">bool</span> intersect <span class="br0">&#40;</span><span class="kw4">const</span> seg <span class="sy3">&amp;</span> a, <span class="kw4">const</span> seg <span class="sy3">&amp;</span> b<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">return</span> intersect1d <span class="br0">&#40;</span>a.<span class="me1">p</span>.<span class="me1">x</span>, a.<span class="me1">q</span>.<span class="me1">x</span>, b.<span class="me1">p</span>.<span class="me1">x</span>, b.<span class="me1">q</span>.<span class="me1">x</span><span class="br0">&#41;</span>
		<span class="sy3">&amp;&amp;</span> intersect1d <span class="br0">&#40;</span>a.<span class="me1">p</span>.<span class="me1">y</span>, a.<span class="me1">q</span>.<span class="me1">y</span>, b.<span class="me1">p</span>.<span class="me1">y</span>, b.<span class="me1">q</span>.<span class="me1">y</span><span class="br0">&#41;</span>
		<span class="sy3">&amp;&amp;</span> vec <span class="br0">&#40;</span>a.<span class="me1">p</span>, a.<span class="me1">q</span>, b.<span class="me1">p</span><span class="br0">&#41;</span> <span class="sy2">*</span> vec <span class="br0">&#40;</span>a.<span class="me1">p</span>, a.<span class="me1">q</span>, b.<span class="me1">q</span><span class="br0">&#41;</span> <span class="sy1">&lt;=</span> <span class="nu0">0</span>
		<span class="sy3">&amp;&amp;</span> vec <span class="br0">&#40;</span>b.<span class="me1">p</span>, b.<span class="me1">q</span>, a.<span class="me1">p</span><span class="br0">&#41;</span> <span class="sy2">*</span> vec <span class="br0">&#40;</span>b.<span class="me1">p</span>, b.<span class="me1">q</span>, a.<span class="me1">q</span><span class="br0">&#41;</span> <span class="sy1">&lt;=</span> <span class="nu0">0</span><span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
&nbsp;
<span class="kw4">bool</span> operator<span class="sy1">&lt;</span> <span class="br0">&#40;</span><span class="kw4">const</span> seg <span class="sy3">&amp;</span> a, <span class="kw4">const</span> seg <span class="sy3">&amp;</span> b<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw4">double</span> x <span class="sy1">=</span> max <span class="br0">&#40;</span>min <span class="br0">&#40;</span>a.<span class="me1">p</span>.<span class="me1">x</span>, a.<span class="me1">q</span>.<span class="me1">x</span><span class="br0">&#41;</span>, min <span class="br0">&#40;</span>b.<span class="me1">p</span>.<span class="me1">x</span>, b.<span class="me1">q</span>.<span class="me1">x</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">return</span> a.<span class="me1">get_y</span><span class="br0">&#40;</span>x<span class="br0">&#41;</span> <span class="sy1">&lt;</span> b.<span class="me1">get_y</span><span class="br0">&#40;</span>x<span class="br0">&#41;</span> <span class="sy2">-</span> EPS<span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
&nbsp;
<span class="kw4">struct</span> event <span class="br0">&#123;</span>
	<span class="kw4">double</span> x<span class="sy4">;</span>
	<span class="kw4">int</span> tp, id<span class="sy4">;</span>
&nbsp;
	event<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="br0">&#125;</span>
	event <span class="br0">&#40;</span><span class="kw4">double</span> x, <span class="kw4">int</span> tp, <span class="kw4">int</span> id<span class="br0">&#41;</span>
		<span class="sy4">:</span> x<span class="br0">&#40;</span>x<span class="br0">&#41;</span>, tp<span class="br0">&#40;</span>tp<span class="br0">&#41;</span>, id<span class="br0">&#40;</span>id<span class="br0">&#41;</span>
	<span class="br0">&#123;</span> <span class="br0">&#125;</span>
&nbsp;
	<span class="kw4">bool</span> operator<span class="sy1">&lt;</span> <span class="br0">&#40;</span><span class="kw4">const</span> event <span class="sy3">&amp;</span> e<span class="br0">&#41;</span> <span class="kw4">const</span> <span class="br0">&#123;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw3">abs</span> <span class="br0">&#40;</span>x <span class="sy2">-</span> e.<span class="me1">x</span><span class="br0">&#41;</span> <span class="sy1">&gt;</span> EPS<span class="br0">&#41;</span>  <span class="kw1">return</span> x <span class="sy1">&lt;</span> e.<span class="me1">x</span><span class="sy4">;</span>
		<span class="kw1">return</span> tp <span class="sy1">&gt;</span> e.<span class="me1">tp</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp;
set<span class="sy1">&lt;</span>seg<span class="sy1">&gt;</span> s<span class="sy4">;</span>
vector <span class="sy1">&lt;</span> set<span class="sy1">&lt;</span>seg<span class="sy1">&gt;</span><span class="sy4">::</span><span class="me2">iterator</span> <span class="sy1">&gt;</span> where<span class="sy4">;</span>
&nbsp;
<span class="kw2">inline</span> set<span class="sy1">&lt;</span>seg<span class="sy1">&gt;</span><span class="sy4">::</span><span class="me2">iterator</span> prev <span class="br0">&#40;</span>set<span class="sy1">&lt;</span>seg<span class="sy1">&gt;</span><span class="sy4">::</span><span class="me2">iterator</span> it<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">return</span> it <span class="sy1">==</span> s.<span class="me1">begin</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy4">?</span> s.<span class="me1">end</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy4">:</span> <span class="sy2">--</span>it<span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">inline</span> set<span class="sy1">&lt;</span>seg<span class="sy1">&gt;</span><span class="sy4">::</span><span class="me2">iterator</span> next <span class="br0">&#40;</span>set<span class="sy1">&lt;</span>seg<span class="sy1">&gt;</span><span class="sy4">::</span><span class="me2">iterator</span> it<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">return</span> <span class="sy2">++</span>it<span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
pair<span class="sy1">&lt;</span><span class="kw4">int</span>,<span class="kw4">int</span><span class="sy1">&gt;</span> solve <span class="br0">&#40;</span><span class="kw4">const</span> vector<span class="sy1">&lt;</span>seg<span class="sy1">&gt;</span> <span class="sy3">&amp;</span> a<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw4">int</span> n <span class="sy1">=</span> <span class="br0">&#40;</span><span class="kw4">int</span><span class="br0">&#41;</span> a.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	vector<span class="sy1">&lt;</span>event<span class="sy1">&gt;</span> e<span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>n<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		e.<span class="me1">push_back</span> <span class="br0">&#40;</span>event <span class="br0">&#40;</span>min <span class="br0">&#40;</span>a<span class="br0">&#91;</span>i<span class="br0">&#93;</span>.<span class="me1">p</span>.<span class="me1">x</span>, a<span class="br0">&#91;</span>i<span class="br0">&#93;</span>.<span class="me1">q</span>.<span class="me1">x</span><span class="br0">&#41;</span>, <span class="sy2">+</span><span class="nu0">1</span>, i<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
		e.<span class="me1">push_back</span> <span class="br0">&#40;</span>event <span class="br0">&#40;</span>max <span class="br0">&#40;</span>a<span class="br0">&#91;</span>i<span class="br0">&#93;</span>.<span class="me1">p</span>.<span class="me1">x</span>, a<span class="br0">&#91;</span>i<span class="br0">&#93;</span>.<span class="me1">q</span>.<span class="me1">x</span><span class="br0">&#41;</span>, <span class="sy2">-</span><span class="nu0">1</span>, i<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
	sort <span class="br0">&#40;</span>e.<span class="me1">begin</span><span class="br0">&#40;</span><span class="br0">&#41;</span>, e.<span class="me1">end</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp;
	s.<span class="me1">clear</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	where.<span class="me1">resize</span> <span class="br0">&#40;</span>a.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">size_t</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>e.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw4">int</span> id <span class="sy1">=</span> e<span class="br0">&#91;</span>i<span class="br0">&#93;</span>.<span class="me1">id</span><span class="sy4">;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>e<span class="br0">&#91;</span>i<span class="br0">&#93;</span>.<span class="me1">tp</span> <span class="sy1">==</span> <span class="sy2">+</span><span class="nu0">1</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			set<span class="sy1">&lt;</span>seg<span class="sy1">&gt;</span><span class="sy4">::</span><span class="me2">iterator</span>
				nxt <span class="sy1">=</span> s.<span class="me1">lower_bound</span> <span class="br0">&#40;</span>a<span class="br0">&#91;</span>id<span class="br0">&#93;</span><span class="br0">&#41;</span>,
				prv <span class="sy1">=</span> prev <span class="br0">&#40;</span>nxt<span class="br0">&#41;</span><span class="sy4">;</span>
			<span class="kw1">if</span> <span class="br0">&#40;</span>nxt <span class="sy3">!</span><span class="sy1">=</span> s.<span class="me1">end</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy3">&amp;&amp;</span> intersect <span class="br0">&#40;</span><span class="sy2">*</span>nxt, a<span class="br0">&#91;</span>id<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
				<span class="kw1">return</span> make_pair <span class="br0">&#40;</span>nxt<span class="sy2">-</span><span class="sy1">&gt;</span>id, id<span class="br0">&#41;</span><span class="sy4">;</span>
			<span class="kw1">if</span> <span class="br0">&#40;</span>prv <span class="sy3">!</span><span class="sy1">=</span> s.<span class="me1">end</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy3">&amp;&amp;</span> intersect <span class="br0">&#40;</span><span class="sy2">*</span>prv, a<span class="br0">&#91;</span>id<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
				<span class="kw1">return</span> make_pair <span class="br0">&#40;</span>prv<span class="sy2">-</span><span class="sy1">&gt;</span>id, id<span class="br0">&#41;</span><span class="sy4">;</span>
			where<span class="br0">&#91;</span>id<span class="br0">&#93;</span> <span class="sy1">=</span> s.<span class="me1">insert</span> <span class="br0">&#40;</span>nxt, a<span class="br0">&#91;</span>id<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy4">;</span>
		<span class="br0">&#125;</span>
		<span class="kw1">else</span> <span class="br0">&#123;</span>
			set<span class="sy1">&lt;</span>seg<span class="sy1">&gt;</span><span class="sy4">::</span><span class="me2">iterator</span>
				nxt <span class="sy1">=</span> next <span class="br0">&#40;</span>where<span class="br0">&#91;</span>id<span class="br0">&#93;</span><span class="br0">&#41;</span>,
				prv <span class="sy1">=</span> prev <span class="br0">&#40;</span>where<span class="br0">&#91;</span>id<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy4">;</span>
			<span class="kw1">if</span> <span class="br0">&#40;</span>nxt <span class="sy3">!</span><span class="sy1">=</span> s.<span class="me1">end</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy3">&amp;&amp;</span> prv <span class="sy3">!</span><span class="sy1">=</span> s.<span class="me1">end</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy3">&amp;&amp;</span> intersect <span class="br0">&#40;</span><span class="sy2">*</span>nxt, <span class="sy2">*</span>prv<span class="br0">&#41;</span><span class="br0">&#41;</span>
				<span class="kw1">return</span> make_pair <span class="br0">&#40;</span>prv<span class="sy2">-</span><span class="sy1">&gt;</span>id, nxt<span class="sy2">-</span><span class="sy1">&gt;</span>id<span class="br0">&#41;</span><span class="sy4">;</span>
			s.<span class="me1">erase</span> <span class="br0">&#40;</span>where<span class="br0">&#91;</span>id<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy4">;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="kw1">return</span> make_pair <span class="br0">&#40;</span><span class="sy2">-</span><span class="nu0">1</span>, <span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span></pre><p>Основная функция здесь &mdash; <img class=tex src="../tex2png/cache/c2a5c8d3f00461f0c1156443f76304de.png" alt="\rm solve()">, которая возвращает номера найденных пересекающихся отрезков, либо <img class=tex src="../tex2png/cache/7155f1d837d141da9f07cf0e569f3eef.png" alt="(-1, -1)">, если пересечения отсутствуют.<p>Проверка на пересечение двух отрезков осуществляется функцией <img class=tex src="../tex2png/cache/d49807615cd313de564d49d259ef78a0.png" alt="\rm intersect()">, с помощью <a href="segments_intersection_checking.html">алгоритма на основе ориентированной площади треугольника</a>.<p>Очередь отрезков в глобальной переменной <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s"> &mdash; <img class=tex src="../tex2png/cache/128bb1dc69e532697055c22194b6230e.png" alt="\rm set<event>">. Итераторы, указывающие положение каждого отрезка в очереди (для удобного удаления отрезков из очереди), хранятся в глобальном массиве <img class=tex src="../tex2png/cache/7a7fe4140366f542b1556206c0d83909.png" alt="\rm where">.<p>Введены также две вспомогательные функции <img class=tex src="../tex2png/cache/99436f48f40e13c96f5037b09c221b74.png" alt="\rm prev()"> и <img class=tex src="../tex2png/cache/2bf1657623b5585fc2f2b3f41a2f6ee1.png" alt="\rm next()">, которые возвращают итераторы на предыдущий и следующий элементы (либо <img class=tex src="../tex2png/cache/ef2f4d93b57638d63ddcd11d239c7061.png" alt="\rm end()">, если такового не существует).<p>Константа <img class=tex src="../tex2png/cache/1a0d8efafc744f1b3ed9f417a47f5e8d.png" alt="\rm EPS"> обозначает погрешность сравнения двух вещественных чисел (в основном она используется при проверке двух отрезков на пересечение).<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><hr><p>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'e-maxx';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script></td></tr></table></body></html>