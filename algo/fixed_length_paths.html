<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><title>MAXimal :: algo :: Подсчёт количества путей фиксированной длины между всеми парами вершин, нахождение кратчайших путей фиксированной длины</title><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><meta name="author" lang="ru" content="e-maxx" /><meta name="description" content="Алгоритмы, олимпиадное программирование, математика" /><meta name="keywords" content="алгоритмы программирование" /><meta name="google-site-verification" content="Pnjjj2XuxB0CTiqgDDvkp79bfSeDQ8Vw57iNeDJZkSc" /><link rel="stylesheet" type="text/css" href="../data/style.css"><script type="text/javascript" src="../data/jquery.js"></script><script type="text/javascript" src="../data/page-contents.js"></script><link rel="stylesheet" type="text/css" href="../geshi/geshi.css"><!--[if IE]><style>.menu a, .menu a:hover { width: 100%; }</style><![endif]--></head><body><table class=main cellpadding=0 cellspacing=0><tr><td class=title colspan=2><p>MAXimal</p></td></tr><tr><td class=menu><ul><li><a href="../index.php.html" >home</a></li><li><a href="index.html" class=current>algo</a></li><li><a href="../bookz/index.html" >bookz</a></li><li><a href="../forum/index.html" >forum</a></li><li><a href="../about.php.html" >about</a></li></ul></td><td class=content><p class=algoinfo>добавлено: 10 Sep 2010 16:13<br>редактировано: 3 May 2012 1:35</p><div id="contents-table"><p id="contents-table-title">Содержание <a href="fixed_length_paths.html#" id="contents-hide">[скрыть]</a><a href="fixed_length_paths.html#" id="contents-show" style="display:none">[показать]</a></p><div style="display:none"></div></div><h1> Кратчайшие пути фиксированной длины, количества путей фиксированной длины </h1><p>Ниже описываются решения этих двух задач, построенные на одной и той же идее: сведение задачи к возведению матрицы в степень (с обычной операцией умножения, и с модифицированной).<p><p><h2 style="padding-top:40px;"> Количество путей фиксированной длины </h2><p>Пусть задан ориентированный невзвешенный граф <img class=tex src="../tex2png/cache/4c5f3ba22ad1fd775e82380ae681dbdb.png" alt="G"> с <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> вершинами, и задано целое число <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k">. Требуется для каждой пары вершин <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i"> и <img class=tex src="../tex2png/cache/f2761432c5377ee4ded848884be6d407.png" alt="j"> найти количество путей между этими вершинами, состоящих ровно из <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> рёбер. Пути при этом рассматриваются произвольные, не обязательно простые (т.е. вершины могут повторяться сколько угодно раз).<p>Будем считать, что граф задан <b>матрицей смежности</b>, т.е. матрицей <img class=tex src="../tex2png/cache/beaca7ad3bd83d8cabfe8d60a891403a.png" alt="g[][]"> размера <img class=tex src="../tex2png/cache/0fc9328e33c84faad487e059a12d8e47.png" alt="n \times n">, где каждый элемент <img class=tex src="../tex2png/cache/e85b322345036b49eacb974c64de7964.png" alt="g[i][j]"> равен единице, если между этими вершинами есть ребро, и нулю, если ребра нет. Описываемый ниже алгоритм работает и в случае наличия кратных рёбер: если между какими-то вершинами <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i"> и <img class=tex src="../tex2png/cache/f2761432c5377ee4ded848884be6d407.png" alt="j"> есть сразу <img class=tex src="../tex2png/cache/4f70748eaed5e0c2c70d7e899166ee1d.png" alt="m"> рёбер, то в матрицу смежности следует записать это число <img class=tex src="../tex2png/cache/4f70748eaed5e0c2c70d7e899166ee1d.png" alt="m">. Также алгоритм корректно учитывает петли в графе, если таковые имеются.<p>Очевидно, что в таком виде <b>матрица смежности</b> графа является <b>ответом на задачу при <img class=tex src="../tex2png/cache/c52bf046f58b7dd5434e50c9358055d3.png" alt="k=1"></b> &mdash; она содержит количества путей длины <img class=tex src="../tex2png/cache/1737ac55fdbc871d8c7d14245b749ccd.png" alt="1"> между каждой парой вершин.<p>Решение будем строить <b>итеративно</b>: пусть ответ для некоторого <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> найден, покажем, как построить его для <img class=tex src="../tex2png/cache/b7e1992873e6c485f926be57173a6d22.png" alt="k+1">. Обозначим через <img class=tex src="../tex2png/cache/ad8770b8d14aef66dd76cb91e65a62df.png" alt="d_k"> найденную матрицу ответов для <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k">, а через <img class=tex src="../tex2png/cache/6c722d8a54c3cb779d2933131acccf63.png" alt="d_{k+1}"> &mdash; матрицу ответов, которую необходимо построить. Тогда очевидна следующая формула:<p><p class=formula><img class=tex src="../tex2png/cache/d83af9e3b4d04a6164da006cfa6d4d89.png" alt=" d_{k+1}[i][j] = \sum_{p = 1}^{n} d_k[i][p] \cdot [...]"></p><p>Легко заметить, что записанная выше формула &mdash; не что иное, как произведение двух матриц <img class=tex src="../tex2png/cache/ad8770b8d14aef66dd76cb91e65a62df.png" alt="d_k"> и <img class=tex src="../tex2png/cache/016b9521e1847132b61db0423dfff527.png" alt="g"> в самом обычном смысле:<p><p class=formula><img class=tex src="../tex2png/cache/2447ec160282968dc8d09a0cd401b6bb.png" alt=" d_{k+1} = d_k \cdot g. "></p><p>Таким образом, <b>решение</b> этой задачи можно представить следующим образом:<p><p class=formula><img class=tex src="../tex2png/cache/24f357d0a0a33b2ec272a63d0b5e5319.png" alt=" d_k = \underbrace{ g \cdot \ldots \cdot g}_{k\ {\[...]"></p><p>Осталось заметить, что возведение матрицы в степень можно произвести эффективно с помощью алгоритма <a href="binary_pow.html"><b>Бинарного возведения в степень</b></a>.<p>Итак, полученное решение имеет асимптотику <img class=tex src="../tex2png/cache/49438c599376fcd4d5ac2d11cf6fb81f.png" alt="O (n^3 \log k)"> и заключается в бинарном возведении в <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k">-ую степень матрицы смежности графа.<p><p><h2 style="padding-top:40px;"> Кратчайшие пути фиксированной длины </h2><p>Пусть задан ориентированный взвешенный граф <img class=tex src="../tex2png/cache/4c5f3ba22ad1fd775e82380ae681dbdb.png" alt="G"> с <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> вершинами, и задано целое число <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k">. Требуется для каждой пары вершин <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i"> и <img class=tex src="../tex2png/cache/f2761432c5377ee4ded848884be6d407.png" alt="j"> найти длину кратчайшего пути между этими вершинами, состоящего ровно из <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> рёбер.<p>Будем считать, что граф задан <b>матрицей смежности</b>, т.е. матрицей <img class=tex src="../tex2png/cache/beaca7ad3bd83d8cabfe8d60a891403a.png" alt="g[][]"> размера <img class=tex src="../tex2png/cache/0fc9328e33c84faad487e059a12d8e47.png" alt="n \times n">, где каждый элемент <img class=tex src="../tex2png/cache/e85b322345036b49eacb974c64de7964.png" alt="g[i][j]"> содержит длину ребра из вершины <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i"> в вершину <img class=tex src="../tex2png/cache/f2761432c5377ee4ded848884be6d407.png" alt="j">. Если между какими-то вершинами ребра нет, то соответствующий элемент матрицы считаем равным бесконечности <img class=tex src="../tex2png/cache/3d40198f44abce2dbb7a7eb7fba559c9.png" alt="\infty">.<p>Очевидно, что в таком виде <b>матрица смежности</b> графа является <b>ответом на задачу при <img class=tex src="../tex2png/cache/c52bf046f58b7dd5434e50c9358055d3.png" alt="k=1"></b> &mdash; она содержит длины кратчайших путей между каждой парой вершин, или <img class=tex src="../tex2png/cache/3d40198f44abce2dbb7a7eb7fba559c9.png" alt="\infty">, если пути длины <img class=tex src="../tex2png/cache/1737ac55fdbc871d8c7d14245b749ccd.png" alt="1"> не существует.<p>Решение будем строить <b>итеративно</b>: пусть ответ для некоторого <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> найден, покажем, как построить его для <img class=tex src="../tex2png/cache/b7e1992873e6c485f926be57173a6d22.png" alt="k+1">. Обозначим через <img class=tex src="../tex2png/cache/ad8770b8d14aef66dd76cb91e65a62df.png" alt="d_k"> найденную матрицу ответов для <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k">, а через <img class=tex src="../tex2png/cache/6c722d8a54c3cb779d2933131acccf63.png" alt="d_{k+1}"> &mdash; матрицу ответов, которую необходимо построить. Тогда очевидна следующая формула:<p><p class=formula><img class=tex src="../tex2png/cache/48ff9301b98f71f4223071cd41fb001e.png" alt=" d_{k+1}[i][j] = \min_{p = 1 \ldots n} ( d_k[i][p][...]"></p><p>Внимательно посмотрев на эту формулу, легко провести аналогию с матричным умножением: фактически, матрица <img class=tex src="../tex2png/cache/ad8770b8d14aef66dd76cb91e65a62df.png" alt="d_k"> умножается на матрицу <img class=tex src="../tex2png/cache/016b9521e1847132b61db0423dfff527.png" alt="g">, только в операции умножения вместо суммы по всем <img class=tex src="../tex2png/cache/2f8934466bea85c9661745280df23800.png" alt="p"> берётся минимум по всем <img class=tex src="../tex2png/cache/2f8934466bea85c9661745280df23800.png" alt="p">:<p><p class=formula><img class=tex src="../tex2png/cache/ce6e6e9458c8a120f68bb39ad1c77157.png" alt=" d_{k+1} = d_k \odot g, "></p><p>где операция <img class=tex src="../tex2png/cache/bd025961d7e8ec7d2192b3803502ae21.png" alt="\odot"> умножения двух матриц определяется следующим образом:<p><p class=formula><img class=tex src="../tex2png/cache/c2f94034966ffd8d0fefacd5fce03318.png" alt=" A \odot B = C \ \ \Longleftrightarrow\ \  C_{ij} [...]"></p><p>Таким образом, <b>решение</b> этой задачи можно представить с помощью этой операции умножения следующим образом:<p><p class=formula><img class=tex src="../tex2png/cache/988b08259928e7df4032923b9817f734.png" alt=" d_k = \underbrace{ g \odot \ldots \odot g}_{k\ {\[...]"></p><p>Осталось заметить, что возведение в степень с этой операцией умножения можно произвести эффективно с помощью алгоритма <a href="binary_pow.html"><b>Бинарного возведения в степень</b></a>, поскольку единственное требуемое для него свойство &mdash; ассоциативность операции умножения &mdash; очевидно, имеется.<p>Итак, полученное решение имеет асимптотику <img class=tex src="../tex2png/cache/49438c599376fcd4d5ac2d11cf6fb81f.png" alt="O (n^3 \log k)"> и заключается в бинарном возведении в <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k">-ую степень матрицы смежности графа с изменённой операцией умножения матриц.<p><p><h2 style="padding-top:40px;"> Обобщение на случай, когда требуются пути длины, не более чем заданная длина </h2><p>Описанные выше решения решают задачи, когда требуется рассматривать пути определённой, фиксированной длины. Однако эти же решения можно приспособить и для решения задач, когда требуется рассматривать пути, содержащие <b>не более</b> чем заданное число рёбер.<p>Сделать это можно, немного модифицировав входной граф. Например, если нас интересуют только пути, заканчивающиеся в определённой вершине <img class=tex src="../tex2png/cache/668c0ed766381807a81b9a534a4a70ce.png" alt="t">, то в граф можно <b>добавить петлю</b> <img class=tex src="../tex2png/cache/9f61eb1eaa6c2408d51acbef437f5617.png" alt="(t,t)"> нулевого веса.<p>Если же нас по-прежнему интересуют ответы для всех пар вершин, то простое добавление петель ко всем вершинам испортит ответ. Вместо этого можно <b>раздвоить</b> каждую вершину: для каждой вершины <img class=tex src="../tex2png/cache/9530057de1d317139fef00be858ff2f1.png" alt="v"> создать дополнительную вершину <img class=tex src="../tex2png/cache/ea6f08f814b984037cb82e3ae3dbea78.png" alt="v'">, провести ребро <img class=tex src="../tex2png/cache/f26ef03aa7c8b304887493326490947a.png" alt="(v,v')"> и добавить петлю <img class=tex src="../tex2png/cache/7f967a9db646df9842c4a4902fbe333d.png" alt="(v',v')">.<p>Решив на модифицированном графе задачу о поиске путей фиксированной длины, ответы на исходную задачу будут получаться как ответы между вершинами <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i"> и <img class=tex src="../tex2png/cache/3fb988890efb07b200d5bc033726476b.png" alt="j'"> (т.е. дополнительные вершины &mdash; это вершины-окончания, в которых мы можем "покрутиться" нужное число раз).<p><p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><hr><p>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'e-maxx';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script></td></tr></table></body></html>