<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><title>MAXimal :: algo :: Нахождение отрицательного цикла в графе</title><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><meta name="author" lang="ru" content="e-maxx" /><meta name="description" content="Алгоритмы, олимпиадное программирование, математика" /><meta name="keywords" content="алгоритмы программирование" /><meta name="google-site-verification" content="Pnjjj2XuxB0CTiqgDDvkp79bfSeDQ8Vw57iNeDJZkSc" /><link rel="stylesheet" type="text/css" href="../data/style.css"><script type="text/javascript" src="../data/jquery.js"></script><script type="text/javascript" src="../data/page-contents.js"></script><link rel="stylesheet" type="text/css" href="../geshi/geshi.css"><!--[if IE]><style>.menu a, .menu a:hover { width: 100%; }</style><![endif]--></head><body><table class=main cellpadding=0 cellspacing=0><tr><td class=title colspan=2><p>MAXimal</p></td></tr><tr><td class=menu><ul><li><a href="../index.php.html" >home</a></li><li><a href="index.html" class=current>algo</a></li><li><a href="../bookz/index.html" >bookz</a></li><li><a href="../forum/index.html" >forum</a></li><li><a href="../about.php.html" >about</a></li></ul></td><td class=content><p class=algoinfo>добавлено: 10 Jun 2008 22:13<br>редактировано: 24 Aug 2011 1:45</p><div id="contents-table"><p id="contents-table-title">Содержание <a href="negative_cycle.html#" id="contents-hide">[скрыть]</a><a href="negative_cycle.html#" id="contents-show" style="display:none">[показать]</a></p><div style="display:none"></div></div><h1>Нахождение отрицательного цикла в графе</h1><p>Дан ориентированный взвешенный граф <img class=tex src="../tex2png/cache/4c5f3ba22ad1fd775e82380ae681dbdb.png" alt="G"> с <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> вершинами и <img class=tex src="../tex2png/cache/4f70748eaed5e0c2c70d7e899166ee1d.png" alt="m"> рёбрами. Требуется найти в нём любой <b>цикл отрицательного веса</b>, если таковой имеется.<p>При другой постановке задачи &mdash; требуется найти <b>все пары вершин</b> такие, что между ними существует путь сколько угодно малой длины.<p>Эти два варианта задачи удобно решать разными алгоритмами, поэтому ниже будут рассмотрены оба из них.<p>Одна из распространённых "жизненных" постановок этой задачи &mdash; следующая: известны <b>курсы валют</b>, т.е. курсы перевода из одной валюты в другую. Требуется узнать, можно ли некоторой последовательностью обменов получить выгоду, т.е. стартовав с одной единицы какой-либо валюты, получить в итоге больше чем одну единицу этой же валюты.<p><p><h2 style="padding-top:40px;">Решение с помощью алгоритма Форда-Беллмана</h2><p><a href="ford_bellman.html">Алгоритм Форда-Беллмана</a> позволяет проверить наличие или отсутствие цикла отрицательного веса в графе, а при его наличии &mdash; найти один из таких циклов.<p>Не будем вдаваться здесь в подробности (которые описаны в <a href="ford_bellman.html">статье по алгоритму Форда-Беллмана</a>), а приведём лишь итог &mdash; то, как работает алгоритм.<p>Делается <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> итераций алгоритма Форда-Беллмана, и если на последней итерации не произошло никаких изменений &mdash; то отрицательного цикла в графе нет. В противном случае возьмём вершину, расстояние до которой изменилось, и будем идти от неё по предкам, пока не войдём в цикл; этот цикл и будет искомым отрицательным циклом.<p><b>Реализация</b>:<p><pre class="notranslate cpp"><span class="kw4">struct</span> edge <span class="br0">&#123;</span>
	<span class="kw4">int</span> a, b, cost<span class="sy4">;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">int</span> n, m<span class="sy4">;</span>
vector<span class="sy1">&lt;</span>edge<span class="sy1">&gt;</span> e<span class="sy4">;</span>
<span class="kw4">const</span> <span class="kw4">int</span> INF <span class="sy1">=</span> <span class="nu0">1000000000</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">void</span> solve<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	vector<span class="sy1">&lt;</span><span class="kw4">int</span><span class="sy1">&gt;</span> d <span class="br0">&#40;</span>n<span class="br0">&#41;</span><span class="sy4">;</span>
	vector<span class="sy1">&lt;</span><span class="kw4">int</span><span class="sy1">&gt;</span> p <span class="br0">&#40;</span>n, <span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw4">int</span> x<span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>n<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		x <span class="sy1">=</span> <span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>
		<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> j<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> j<span class="sy1">&lt;</span>m<span class="sy4">;</span> <span class="sy2">++</span>j<span class="br0">&#41;</span>
			<span class="kw1">if</span> <span class="br0">&#40;</span>d<span class="br0">&#91;</span>e<span class="br0">&#91;</span>j<span class="br0">&#93;</span>.<span class="me1">b</span><span class="br0">&#93;</span> <span class="sy1">&gt;</span> d<span class="br0">&#91;</span>e<span class="br0">&#91;</span>j<span class="br0">&#93;</span>.<span class="me1">a</span><span class="br0">&#93;</span> <span class="sy2">+</span> e<span class="br0">&#91;</span>j<span class="br0">&#93;</span>.<span class="me1">cost</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
				d<span class="br0">&#91;</span>e<span class="br0">&#91;</span>j<span class="br0">&#93;</span>.<span class="me1">b</span><span class="br0">&#93;</span> <span class="sy1">=</span> max <span class="br0">&#40;</span><span class="sy2">-</span>INF, d<span class="br0">&#91;</span>e<span class="br0">&#91;</span>j<span class="br0">&#93;</span>.<span class="me1">a</span><span class="br0">&#93;</span> <span class="sy2">+</span> e<span class="br0">&#91;</span>j<span class="br0">&#93;</span>.<span class="me1">cost</span><span class="br0">&#41;</span><span class="sy4">;</span>
				p<span class="br0">&#91;</span>e<span class="br0">&#91;</span>j<span class="br0">&#93;</span>.<span class="me1">b</span><span class="br0">&#93;</span> <span class="sy1">=</span> e<span class="br0">&#91;</span>j<span class="br0">&#93;</span>.<span class="me1">a</span><span class="sy4">;</span>
				x <span class="sy1">=</span> e<span class="br0">&#91;</span>j<span class="br0">&#93;</span>.<span class="me1">b</span><span class="sy4">;</span>
			<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="kw1">if</span> <span class="br0">&#40;</span>x <span class="sy1">==</span> <span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span>
		<span class="kw3">cout</span> <span class="sy1">&lt;&lt;</span> <span class="st0">&quot;No negative cycle found.&quot;</span><span class="sy4">;</span>
	<span class="kw1">else</span> <span class="br0">&#123;</span>
		<span class="kw4">int</span> y <span class="sy1">=</span> x<span class="sy4">;</span>
		<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>n<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span>
			y <span class="sy1">=</span> p<span class="br0">&#91;</span>y<span class="br0">&#93;</span><span class="sy4">;</span>
&nbsp;
		vector<span class="sy1">&lt;</span><span class="kw4">int</span><span class="sy1">&gt;</span> path<span class="sy4">;</span>
		<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> cur<span class="sy1">=</span>y<span class="sy4">;</span> <span class="sy4">;</span> cur<span class="sy1">=</span>p<span class="br0">&#91;</span>cur<span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			path.<span class="me1">push_back</span> <span class="br0">&#40;</span>cur<span class="br0">&#41;</span><span class="sy4">;</span>
			<span class="kw1">if</span> <span class="br0">&#40;</span>cur <span class="sy1">==</span> y <span class="sy3">&amp;&amp;</span> path.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy1">&gt;</span> <span class="nu0">1</span><span class="br0">&#41;</span>  <span class="kw1">break</span><span class="sy4">;</span>
		<span class="br0">&#125;</span>
		reverse <span class="br0">&#40;</span>path.<span class="me1">begin</span><span class="br0">&#40;</span><span class="br0">&#41;</span>, path.<span class="me1">end</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp;
		<span class="kw3">cout</span> <span class="sy1">&lt;&lt;</span> <span class="st0">&quot;Negative cycle: &quot;</span><span class="sy4">;</span>
		<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">size_t</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>path.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span>
			<span class="kw3">cout</span> <span class="sy1">&lt;&lt;</span> path<span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy1">&lt;&lt;</span> <span class="st0">' '</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre><p><p><h2 style="padding-top:40px;">Решение с помощью алгоритма Флойда-Уоршелла</h2><p><a href="floyd_warshall_algorithm.html">Алгоритм Флойда-Уоршелла</a> позволяет решать вторую постановку задачи &mdash; когда надо найти все пары вершин <img class=tex src="../tex2png/cache/df9c3aa69e88ca097b0e7196d6b2dfed.png" alt="(i,j)">, между которыми кратчайшего пути не существует (т.е. он имеет бесконечно малую величину).<p>Опять же, более подробные объяснения содержатся в <a href="floyd_warshall_algorithm.html">описании алгоритма Флойда-Уоршелла</a>, а здесь мы приведём только итог.<p>После того, как алгоритм Флойда-Уоршелла отработает для входного графа, переберём все пары вершин <img class=tex src="../tex2png/cache/df9c3aa69e88ca097b0e7196d6b2dfed.png" alt="(i,j)">, и для каждой такой пары проверим, бесконечно мал кратчайший путь из <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i"> в <img class=tex src="../tex2png/cache/f2761432c5377ee4ded848884be6d407.png" alt="j"> или нет. Для этого переберём третью вершину <img class=tex src="../tex2png/cache/668c0ed766381807a81b9a534a4a70ce.png" alt="t">, и если для неё оказалось <img class=tex src="../tex2png/cache/e6ff8b6773bbfc92c3490bd05d2ed1ae.png" alt="d[t][t]<0"> (т.е. она лежит в цикле отрицательного веса), а сама она достижима из <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i"> и из неё достижима <img class=tex src="../tex2png/cache/f2761432c5377ee4ded848884be6d407.png" alt="j"> &mdash; то путь <img class=tex src="../tex2png/cache/df9c3aa69e88ca097b0e7196d6b2dfed.png" alt="(i,j)"> может иметь бесконечно малую длину.<p><b>Реализация</b>:<p><pre class="notranslate cpp"><span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>n<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> j<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> j<span class="sy1">&lt;</span>n<span class="sy4">;</span> <span class="sy2">++</span>j<span class="br0">&#41;</span>
		<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> t<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> t<span class="sy1">&lt;</span>n<span class="sy4">;</span> <span class="sy2">++</span>t<span class="br0">&#41;</span>
			<span class="kw1">if</span> <span class="br0">&#40;</span>d<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#91;</span>t<span class="br0">&#93;</span> <span class="sy1">&lt;</span> INF <span class="sy3">&amp;&amp;</span> d<span class="br0">&#91;</span>t<span class="br0">&#93;</span><span class="br0">&#91;</span>t<span class="br0">&#93;</span> <span class="sy1">&lt;</span> <span class="nu0">0</span> <span class="sy3">&amp;&amp;</span> d<span class="br0">&#91;</span>t<span class="br0">&#93;</span><span class="br0">&#91;</span>j<span class="br0">&#93;</span> <span class="sy1">&lt;</span> INF<span class="br0">&#41;</span>
				d<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#91;</span>j<span class="br0">&#93;</span> <span class="sy1">=</span> <span class="sy2">-</span>INF<span class="sy4">;</span></pre><p><p><h2 style="padding-top:40px;">Задачи в online judges</h2><p>Список задач, в которых требуется искать цикл отрицательного веса:<p><ul><p><li><a href="http://uva.onlinejudge.org/index.php?option=com_onlinejudge&Itemid=8&page=show_problem&problem=499">UVA #499 <b>"Wormholes"</b> &nbsp;&nbsp;&nbsp;&nbsp; [сложность: низкая]</a><p><li><a href="http://uva.onlinejudge.org/index.php?option=com_onlinejudge&Itemid=8&page=show_problem&problem=40">UVA #104 <b>"Arbitrage"</b> &nbsp;&nbsp;&nbsp;&nbsp; [сложность: средняя]</a><p><li><a href="http://uva.onlinejudge.org/index.php?option=com_onlinejudge&Itemid=8&page=show_problem&problem=1498">UVA #10557 <b>"XYZZY"</b> &nbsp;&nbsp;&nbsp;&nbsp; [сложность: средняя]</a><p></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><hr><p>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'e-maxx';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script></td></tr></table></body></html>