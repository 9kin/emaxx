<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><title>MAXimal :: algo :: Нахождение точки пересечения двух отрезков</title><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><meta name="author" lang="ru" content="e-maxx" /><meta name="description" content="Алгоритмы, олимпиадное программирование, математика" /><meta name="keywords" content="алгоритмы программирование" /><meta name="google-site-verification" content="Pnjjj2XuxB0CTiqgDDvkp79bfSeDQ8Vw57iNeDJZkSc" /><link rel="stylesheet" type="text/css" href="../data/style.css"><script type="text/javascript" src="../data/jquery.js"></script><script type="text/javascript" src="../data/page-contents.js"></script><link rel="stylesheet" type="text/css" href="../geshi/geshi.css"><!--[if IE]><style>.menu a, .menu a:hover { width: 100%; }</style><![endif]--></head><body><table class=main cellpadding=0 cellspacing=0><tr><td class=title colspan=2><p>MAXimal</p></td></tr><tr><td class=menu><ul><li><a href="../index.php.html" >home</a></li><li><a href="index.html" class=current>algo</a></li><li><a href="../bookz/index.html" >bookz</a></li><li><a href="../forum/index.html" >forum</a></li><li><a href="../about.php.html" >about</a></li></ul></td><td class=content><p class=algoinfo>добавлено: 11 Jun 2008 10:22<br>редактировано: 20 Jun 2011 1:15</p><div id="contents-table"><p id="contents-table-title">Содержание <a href="segments_intersection.html#" id="contents-hide">[скрыть]</a><a href="segments_intersection.html#" id="contents-show" style="display:none">[показать]</a></p><div style="display:none"></div></div><h1>Пересечение двух отрезков</h1><p>Даны два отрезка <img class=tex src="../tex2png/cache/9a51958816d5650e3b69e2cd05b84323.png" alt="AB"> и <img class=tex src="../tex2png/cache/5208710f6aeeccfca4db476d19545da5.png" alt="CD"> (они могут вырождаться в точки). Требуется найти их пересечение: оно может быть пустым (если отрезки не пересекаются), может быть одной точкой, и может быть целым отрезком (если отрезки накладываются друг на друга).<p><p><h2 style="padding-top:40px;">Алгоритм</h2><p>Работать с отрезками будем как с прямыми: построим по двум отрезкам уравнения их прямых, проверим, не параллельны ли прямые. Если прямые не параллельны, то всё просто: находим их точку пересечения и проверяем, что она принадлежит обоим отрезкам (для этого достаточно проверить, что точка принадлежит каждому отрезку в проекции на ось <img class=tex src="../tex2png/cache/6c40947c41a939b41e0cfe6506c9e3c8.png" alt="X"> и на ось <img class=tex src="../tex2png/cache/2f103fbb20004cd7122d15d73c2acaf0.png" alt="Y"> по отдельности). В итоге в этом случае ответом будет либо "пусто", либо единственная найденная точка.<p>Более сложный случай &mdash; если прямые оказались параллельными (сюда же относится случай, когда один или оба отрезка выродились в точки). В этом случае надо проверить, что оба отрезка лежат на одной прямой (или, в случае когда они оба вырождены в точку &mdash; что эта точка совпадает). Если это не так, то ответ &mdash; "пусто". Если это так, то ответ &mdash; это пересечение двух отрезков, лежащих на одной прямой, что реализуется достаточно просто &mdash; надо взять максимум из левых концов и минимум из правых концов.<p>В самом начале алгоритма напишем так называемую "проверку на bounding box" &mdash; во-первых, она необходима для случая, когда два отрезка лежат на одной прямой, а во-вторых, она, как легковесная проверка, позволяет алгоритму работать в среднем быстрее на случайных тестах.<p><p><h2 style="padding-top:40px;">Реализация</h2><p>Приведём здесь полную реализацию, включая все вспомогательные функции по работе с точками и прямыми.<p>Главной здесь является функция <img class=tex src="../tex2png/cache/ad2efb63031387fc246514c73182ff04.png" alt="\rm intersect">, которая пересекает два переданных ей отрезка, и если они пересекаются хотя бы по одной точке, то возвращает <img class=tex src="../tex2png/cache/d04c5eb60a53293d4878d3c73c349aa6.png" alt="\rm true">, а в аргументах <img class=tex src="../tex2png/cache/55ab215b6a256acb20e4489af208862d.png" alt="\rm left"> и <img class=tex src="../tex2png/cache/53efccbe9ec2e9fbf5eb622a2d4820dc.png" alt="\rm right"> возвращает начало и конец отрезка-ответа (в частности, когда ответ &mdash; это единственная точка, возвращаемые начало и конец будут совпадать).<p><pre class="notranslate cpp"><span class="kw4">const</span> <span class="kw4">double</span> EPS <span class="sy1">=</span> <span class="nu19">1E-9</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">struct</span> pt <span class="br0">&#123;</span>
	<span class="kw4">double</span> x, y<span class="sy4">;</span>
&nbsp;
	<span class="kw4">bool</span> operator<span class="sy1">&lt;</span> <span class="br0">&#40;</span><span class="kw4">const</span> pt <span class="sy3">&amp;</span> p<span class="br0">&#41;</span> <span class="kw4">const</span> <span class="br0">&#123;</span>
		<span class="kw1">return</span> x <span class="sy1">&lt;</span> p.<span class="me1">x</span><span class="sy2">-</span>EPS <span class="sy3">||</span> <span class="kw3">abs</span><span class="br0">&#40;</span>x<span class="sy2">-</span>p.<span class="me1">x</span><span class="br0">&#41;</span> <span class="sy1">&lt;</span> EPS <span class="sy3">&amp;&amp;</span> y <span class="sy1">&lt;</span> p.<span class="me1">y</span> <span class="sy2">-</span> EPS<span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">struct</span> line <span class="br0">&#123;</span>
	<span class="kw4">double</span> a, b, c<span class="sy4">;</span>
&nbsp;
	line<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="br0">&#125;</span>
	line <span class="br0">&#40;</span>pt p, pt q<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		a <span class="sy1">=</span> p.<span class="me1">y</span> <span class="sy2">-</span> q.<span class="me1">y</span><span class="sy4">;</span>
		b <span class="sy1">=</span> q.<span class="me1">x</span> <span class="sy2">-</span> p.<span class="me1">x</span><span class="sy4">;</span>
		c <span class="sy1">=</span> <span class="sy2">-</span> a <span class="sy2">*</span> p.<span class="me1">x</span> <span class="sy2">-</span> b <span class="sy2">*</span> p.<span class="me1">y</span><span class="sy4">;</span>
		norm<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="kw4">void</span> norm<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw4">double</span> z <span class="sy1">=</span> <span class="kw3">sqrt</span> <span class="br0">&#40;</span>a<span class="sy2">*</span>a <span class="sy2">+</span> b<span class="sy2">*</span>b<span class="br0">&#41;</span><span class="sy4">;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw3">abs</span><span class="br0">&#40;</span>z<span class="br0">&#41;</span> <span class="sy1">&gt;</span> EPS<span class="br0">&#41;</span>
			a <span class="sy2">/</span><span class="sy1">=</span> z,  b <span class="sy2">/</span><span class="sy1">=</span> z,  c <span class="sy2">/</span><span class="sy1">=</span> z<span class="sy4">;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="kw4">double</span> dist <span class="br0">&#40;</span>pt p<span class="br0">&#41;</span> <span class="kw4">const</span> <span class="br0">&#123;</span>
		<span class="kw1">return</span> a <span class="sy2">*</span> p.<span class="me1">x</span> <span class="sy2">+</span> b <span class="sy2">*</span> p.<span class="me1">y</span> <span class="sy2">+</span> c<span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp;
<span class="co2">#define det(a,b,c,d)  (a*d-b*c)</span>
&nbsp;
<span class="kw2">inline</span> <span class="kw4">bool</span> betw <span class="br0">&#40;</span><span class="kw4">double</span> l, <span class="kw4">double</span> r, <span class="kw4">double</span> x<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">return</span> min<span class="br0">&#40;</span>l,r<span class="br0">&#41;</span> <span class="sy1">&lt;=</span> x <span class="sy2">+</span> EPS <span class="sy3">&amp;&amp;</span> x <span class="sy1">&lt;=</span> max<span class="br0">&#40;</span>l,r<span class="br0">&#41;</span> <span class="sy2">+</span> EPS<span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">inline</span> <span class="kw4">bool</span> intersect_1d <span class="br0">&#40;</span><span class="kw4">double</span> a, <span class="kw4">double</span> b, <span class="kw4">double</span> c, <span class="kw4">double</span> d<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>a <span class="sy1">&gt;</span> b<span class="br0">&#41;</span>  swap <span class="br0">&#40;</span>a, b<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>c <span class="sy1">&gt;</span> d<span class="br0">&#41;</span>  swap <span class="br0">&#40;</span>c, d<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">return</span> max <span class="br0">&#40;</span>a, c<span class="br0">&#41;</span> <span class="sy1">&lt;=</span> min <span class="br0">&#40;</span>b, d<span class="br0">&#41;</span> <span class="sy2">+</span> EPS<span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">bool</span> intersect <span class="br0">&#40;</span>pt a, pt b, pt c, pt d, pt <span class="sy3">&amp;</span> left, pt <span class="sy3">&amp;</span> right<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy3">!</span> intersect_1d <span class="br0">&#40;</span>a.<span class="me1">x</span>, b.<span class="me1">x</span>, c.<span class="me1">x</span>, d.<span class="me1">x</span><span class="br0">&#41;</span> <span class="sy3">||</span> <span class="sy3">!</span> intersect_1d <span class="br0">&#40;</span>a.<span class="me1">y</span>, b.<span class="me1">y</span>, c.<span class="me1">y</span>, d.<span class="me1">y</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
		<span class="kw1">return</span> <span class="kw2">false</span><span class="sy4">;</span>
	line m <span class="br0">&#40;</span>a, b<span class="br0">&#41;</span><span class="sy4">;</span>
	line n <span class="br0">&#40;</span>c, d<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw4">double</span> zn <span class="sy1">=</span> det <span class="br0">&#40;</span>m.<span class="me1">a</span>, m.<span class="me1">b</span>, n.<span class="me1">a</span>, n.<span class="me1">b</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw3">abs</span> <span class="br0">&#40;</span>zn<span class="br0">&#41;</span> <span class="sy1">&lt;</span> EPS<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw3">abs</span> <span class="br0">&#40;</span>m.<span class="me1">dist</span> <span class="br0">&#40;</span>c<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy1">&gt;</span> EPS <span class="sy3">||</span> <span class="kw3">abs</span> <span class="br0">&#40;</span>n.<span class="me1">dist</span> <span class="br0">&#40;</span>a<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy1">&gt;</span> EPS<span class="br0">&#41;</span>
			<span class="kw1">return</span> <span class="kw2">false</span><span class="sy4">;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>b <span class="sy1">&lt;</span> a<span class="br0">&#41;</span>  swap <span class="br0">&#40;</span>a, b<span class="br0">&#41;</span><span class="sy4">;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>d <span class="sy1">&lt;</span> c<span class="br0">&#41;</span>  swap <span class="br0">&#40;</span>c, d<span class="br0">&#41;</span><span class="sy4">;</span>
		left <span class="sy1">=</span> max <span class="br0">&#40;</span>a, c<span class="br0">&#41;</span><span class="sy4">;</span>
		right <span class="sy1">=</span> min <span class="br0">&#40;</span>b, d<span class="br0">&#41;</span><span class="sy4">;</span>
		<span class="kw1">return</span> <span class="kw2">true</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">else</span> <span class="br0">&#123;</span>
		left.<span class="me1">x</span> <span class="sy1">=</span> right.<span class="me1">x</span> <span class="sy1">=</span> <span class="sy2">-</span> det <span class="br0">&#40;</span>m.<span class="me1">c</span>, m.<span class="me1">b</span>, n.<span class="me1">c</span>, n.<span class="me1">b</span><span class="br0">&#41;</span> <span class="sy2">/</span> zn<span class="sy4">;</span>
		left.<span class="me1">y</span> <span class="sy1">=</span> right.<span class="me1">y</span> <span class="sy1">=</span> <span class="sy2">-</span> det <span class="br0">&#40;</span>m.<span class="me1">a</span>, m.<span class="me1">c</span>, n.<span class="me1">a</span>, n.<span class="me1">c</span><span class="br0">&#41;</span> <span class="sy2">/</span> zn<span class="sy4">;</span>
		<span class="kw1">return</span> betw <span class="br0">&#40;</span>a.<span class="me1">x</span>, b.<span class="me1">x</span>, left.<span class="me1">x</span><span class="br0">&#41;</span>
			<span class="sy3">&amp;&amp;</span> betw <span class="br0">&#40;</span>a.<span class="me1">y</span>, b.<span class="me1">y</span>, left.<span class="me1">y</span><span class="br0">&#41;</span>
			<span class="sy3">&amp;&amp;</span> betw <span class="br0">&#40;</span>c.<span class="me1">x</span>, d.<span class="me1">x</span>, left.<span class="me1">x</span><span class="br0">&#41;</span>
			<span class="sy3">&amp;&amp;</span> betw <span class="br0">&#40;</span>c.<span class="me1">y</span>, d.<span class="me1">y</span>, left.<span class="me1">y</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre><p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><hr><p>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'e-maxx';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script></td></tr></table></body></html>