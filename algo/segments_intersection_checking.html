<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><title>MAXimal :: algo :: Проверка двух отрезков на пересечение</title><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><meta name="author" lang="ru" content="e-maxx" /><meta name="description" content="Алгоритмы, олимпиадное программирование, математика" /><meta name="keywords" content="алгоритмы программирование" /><meta name="google-site-verification" content="Pnjjj2XuxB0CTiqgDDvkp79bfSeDQ8Vw57iNeDJZkSc" /><link rel="stylesheet" type="text/css" href="../data/style.css"><script type="text/javascript" src="../data/jquery.js"></script><script type="text/javascript" src="../data/page-contents.js"></script><link rel="stylesheet" type="text/css" href="../geshi/geshi.css"><!--[if IE]><style>.menu a, .menu a:hover { width: 100%; }</style><![endif]--></head><body><table class=main cellpadding=0 cellspacing=0><tr><td class=title colspan=2><p>MAXimal</p></td></tr><tr><td class=menu><ul><li><a href="../index.php.html" >home</a></li><li><a href="index.html" class=current>algo</a></li><li><a href="../bookz/index.html" >bookz</a></li><li><a href="../forum/index.html" >forum</a></li><li><a href="../about.php.html" >about</a></li></ul></td><td class=content><p class=algoinfo>добавлено: 11 Jun 2008 10:12<br>редактировано: 20 Jun 2011 0:50</p><div id="contents-table"><p id="contents-table-title">Содержание <a href="segments_intersection_checking.html#" id="contents-hide">[скрыть]</a><a href="segments_intersection_checking.html#" id="contents-show" style="display:none">[показать]</a></p><div style="display:none"></div></div><h1>Проверка двух отрезков на пересечение</h1><p>Даны два отрезка <img class=tex src="../tex2png/cache/9a51958816d5650e3b69e2cd05b84323.png" alt="AB"> и <img class=tex src="../tex2png/cache/5208710f6aeeccfca4db476d19545da5.png" alt="CD"> (они могут вырождаться в точки). Требуется проверить, пересекаются они или нет.<p>Если дополнительно требуется найти саму точку (точки) пересечения, то см. <a href="segments_intersection.html">соответствующую статью</a>.<p><p><h2 style="padding-top:40px;">Первый способ: ориентированная площадь треугольника</h2><p>Воспользуемся <a href="oriented_area.html">Ориентированной площадью треугольника и предикат 'По часовой стрелке'</a>. Действительно, чтобы отрезки <img class=tex src="../tex2png/cache/9a51958816d5650e3b69e2cd05b84323.png" alt="AB"> и <img class=tex src="../tex2png/cache/5208710f6aeeccfca4db476d19545da5.png" alt="CD"> пересекались, необходимо и достаточно, чтобы точки <img class=tex src="../tex2png/cache/b5f17df636a8bd667d2f5c3404ed82e7.png" alt="A"> и <img class=tex src="../tex2png/cache/fb8234db4e6ea317a7c2aef7a38775ba.png" alt="B"> находились по разные стороны прямой <img class=tex src="../tex2png/cache/5208710f6aeeccfca4db476d19545da5.png" alt="CD">, и, аналогично, точки <img class=tex src="../tex2png/cache/5572481c8713abb69ad4011419e91fc7.png" alt="C"> и <img class=tex src="../tex2png/cache/eb1a191fcb4a60d0abd8341d6d13e0e6.png" alt="D"> &mdash; по разные стороны прямой <img class=tex src="../tex2png/cache/9a51958816d5650e3b69e2cd05b84323.png" alt="AB">. Проверить это можно, вычисляя ориентированные площади соответствующих треугольников и сравнивая их знаки.<p>Единственное, на что следует обратить внимание &mdash; граничные случаи, когда какие-то точки попадают на саму прямую. При этом возникает единственный особый случай, когда вышеописанные проверки ничего не дадут &mdash; случай, когда оба отрезка лежат <b>на одной прямой</b>. Этот случай надо рассмотреть отдельно. Для этого достаточно проверить, что проекции этих двух отрезков на оси <img class=tex src="../tex2png/cache/6c40947c41a939b41e0cfe6506c9e3c8.png" alt="X"> и <img class=tex src="../tex2png/cache/2f103fbb20004cd7122d15d73c2acaf0.png" alt="Y"> пересекаются (часто эту проверку называют "проверкой на bounding box").<p>В целом, этот способ &mdash; более простой, чем тот, что будет приведён ниже (производящий пересечение двух прямых), и имеет меньше особых случаев, однако главный его недостаток &mdash; в том, что он не находит саму точку пересечения.<p><b>Реализация</b>:<pre class="notranslate cpp"><span class="kw4">struct</span> pt <span class="br0">&#123;</span>
	<span class="kw4">int</span> x, y<span class="sy4">;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp;
<span class="kw2">inline</span> <span class="kw4">int</span> area <span class="br0">&#40;</span>pt a, pt b, pt c<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">return</span> <span class="br0">&#40;</span>b.<span class="me1">x</span> <span class="sy2">-</span> a.<span class="me1">x</span><span class="br0">&#41;</span> <span class="sy2">*</span> <span class="br0">&#40;</span>c.<span class="me1">y</span> <span class="sy2">-</span> a.<span class="me1">y</span><span class="br0">&#41;</span> <span class="sy2">-</span> <span class="br0">&#40;</span>b.<span class="me1">y</span> <span class="sy2">-</span> a.<span class="me1">y</span><span class="br0">&#41;</span> <span class="sy2">*</span> <span class="br0">&#40;</span>c.<span class="me1">x</span> <span class="sy2">-</span> a.<span class="me1">x</span><span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">inline</span> <span class="kw4">bool</span> intersect_1 <span class="br0">&#40;</span><span class="kw4">int</span> a, <span class="kw4">int</span> b, <span class="kw4">int</span> c, <span class="kw4">int</span> d<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>a <span class="sy1">&gt;</span> b<span class="br0">&#41;</span>  swap <span class="br0">&#40;</span>a, b<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>c <span class="sy1">&gt;</span> d<span class="br0">&#41;</span>  swap <span class="br0">&#40;</span>c, d<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">return</span> max<span class="br0">&#40;</span>a,c<span class="br0">&#41;</span> <span class="sy1">&lt;=</span> min<span class="br0">&#40;</span>b,d<span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">bool</span> intersect <span class="br0">&#40;</span>pt a, pt b, pt c, pt d<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">return</span> intersect_1 <span class="br0">&#40;</span>a.<span class="me1">x</span>, b.<span class="me1">x</span>, c.<span class="me1">x</span>, d.<span class="me1">x</span><span class="br0">&#41;</span>
		<span class="sy3">&amp;&amp;</span> intersect_1 <span class="br0">&#40;</span>a.<span class="me1">y</span>, b.<span class="me1">y</span>, c.<span class="me1">y</span>, d.<span class="me1">y</span><span class="br0">&#41;</span>
		<span class="sy3">&amp;&amp;</span> area<span class="br0">&#40;</span>a,b,c<span class="br0">&#41;</span> <span class="sy2">*</span> area<span class="br0">&#40;</span>a,b,d<span class="br0">&#41;</span> <span class="sy1">&lt;=</span> <span class="nu0">0</span>
		<span class="sy3">&amp;&amp;</span> area<span class="br0">&#40;</span>c,d,a<span class="br0">&#41;</span> <span class="sy2">*</span> area<span class="br0">&#40;</span>c,d,b<span class="br0">&#41;</span> <span class="sy1">&lt;=</span> <span class="nu0">0</span><span class="sy4">;</span>
<span class="br0">&#125;</span></pre><p>В целях оптимизации проверка на bounding box вынесена в начало, до вычисления площадей &mdash; поскольку это более "лёгкая" проверка.<p>Само собой, этот код применим и для случая вещественных координат, просто все сравнения с нулём следует производить по эпсилону (и избегать перемножения двух вещественнозначных значений <img class=tex src="../tex2png/cache/7e287e68353b0b202fab0a1932de6fba.png" alt="\rm area()">, перемножая вместо этого их знаки).<p><p><h2 style="padding-top:40px;">Второй способ: пересечение двух прямых</h2><p>Вместо пересечения отрезков выполним <a href="lines_intersection.html">пересечение двух прямых</a>, в результате, если прямые не параллельны, получим какую-то точку, которую надо проверить на принадлежность обоим отрезкам; для этого достаточно проверить, что эта точка принадлежит обоим отрезкам в проекции на ось <img class=tex src="../tex2png/cache/6c40947c41a939b41e0cfe6506c9e3c8.png" alt="X"> и на ось <img class=tex src="../tex2png/cache/2f103fbb20004cd7122d15d73c2acaf0.png" alt="Y">.<p>Если же прямые оказались параллельными, то, если они не совпадают, то отрезки точно не пересекаются. Если же прямые совпали, то отрезки лежат на одной прямой, и для проверки их пересечения достаточно проверить, что пересекаются их проекции на ось <img class=tex src="../tex2png/cache/6c40947c41a939b41e0cfe6506c9e3c8.png" alt="X"> и <img class=tex src="../tex2png/cache/2f103fbb20004cd7122d15d73c2acaf0.png" alt="Y">.<p>Остаётся ещё особый случай, когда один или оба отрезка <b>вырождаются</b> в точки: в таком случае говорить о прямых некорректно, и этот метод будет неприменим (этот случай надо будет разбирать отдельно).<p><b>Реализация</b> (без учёта случая вырожденных отрезков):<p><pre class="notranslate cpp"><span class="kw4">struct</span> pt <span class="br0">&#123;</span>
	<span class="kw4">int</span> x, y<span class="sy4">;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">const</span> <span class="kw4">double</span> EPS <span class="sy1">=</span> <span class="nu19">1E-9</span><span class="sy4">;</span>
&nbsp;
<span class="kw2">inline</span> <span class="kw4">int</span> det <span class="br0">&#40;</span><span class="kw4">int</span> a, <span class="kw4">int</span> b, <span class="kw4">int</span> c, <span class="kw4">int</span> d<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">return</span> a <span class="sy2">*</span> d <span class="sy2">-</span> b <span class="sy2">*</span> c<span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">inline</span> <span class="kw4">bool</span> between <span class="br0">&#40;</span><span class="kw4">int</span> a, <span class="kw4">int</span> b, <span class="kw4">double</span> c<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">return</span> min<span class="br0">&#40;</span>a,b<span class="br0">&#41;</span> <span class="sy1">&lt;=</span> c <span class="sy2">+</span> EPS <span class="sy3">&amp;&amp;</span> c <span class="sy1">&lt;=</span> max<span class="br0">&#40;</span>a,b<span class="br0">&#41;</span> <span class="sy2">+</span> EPS<span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">inline</span> <span class="kw4">bool</span> intersect_1 <span class="br0">&#40;</span><span class="kw4">int</span> a, <span class="kw4">int</span> b, <span class="kw4">int</span> c, <span class="kw4">int</span> d<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>a <span class="sy1">&gt;</span> b<span class="br0">&#41;</span>  swap <span class="br0">&#40;</span>a, b<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>c <span class="sy1">&gt;</span> d<span class="br0">&#41;</span>  swap <span class="br0">&#40;</span>c, d<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">return</span> max<span class="br0">&#40;</span>a,c<span class="br0">&#41;</span> <span class="sy1">&lt;=</span> min<span class="br0">&#40;</span>b,d<span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">bool</span> intersect <span class="br0">&#40;</span>pt a, pt b, pt c, pt d<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw4">int</span> A1 <span class="sy1">=</span> a.<span class="me1">y</span><span class="sy2">-</span>b.<span class="me1">y</span>,  B1 <span class="sy1">=</span> b.<span class="me1">x</span><span class="sy2">-</span>a.<span class="me1">x</span>,  C1 <span class="sy1">=</span> <span class="sy2">-</span>A1<span class="sy2">*</span>a.<span class="me1">x</span> <span class="sy2">-</span> B1<span class="sy2">*</span>a.<span class="me1">y</span><span class="sy4">;</span>
	<span class="kw4">int</span> A2 <span class="sy1">=</span> c.<span class="me1">y</span><span class="sy2">-</span>d.<span class="me1">y</span>,  B2 <span class="sy1">=</span> d.<span class="me1">x</span><span class="sy2">-</span>c.<span class="me1">x</span>,  C2 <span class="sy1">=</span> <span class="sy2">-</span>A2<span class="sy2">*</span>c.<span class="me1">x</span> <span class="sy2">-</span> B2<span class="sy2">*</span>c.<span class="me1">y</span><span class="sy4">;</span>
	<span class="kw4">int</span> zn <span class="sy1">=</span> det <span class="br0">&#40;</span>A1, B1, A2, B2<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>zn <span class="sy3">!</span><span class="sy1">=</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw4">double</span> x <span class="sy1">=</span> <span class="sy2">-</span> det <span class="br0">&#40;</span>C1, B1, C2, B2<span class="br0">&#41;</span> <span class="sy2">*</span> <span class="nu0">1</span>. <span class="sy2">/</span> zn<span class="sy4">;</span>
		<span class="kw4">double</span> y <span class="sy1">=</span> <span class="sy2">-</span> det <span class="br0">&#40;</span>A1, C1, A2, C2<span class="br0">&#41;</span> <span class="sy2">*</span> <span class="nu0">1</span>. <span class="sy2">/</span> zn<span class="sy4">;</span>
		<span class="kw1">return</span> between <span class="br0">&#40;</span>a.<span class="me1">x</span>, b.<span class="me1">x</span>, x<span class="br0">&#41;</span> <span class="sy3">&amp;&amp;</span> between <span class="br0">&#40;</span>a.<span class="me1">y</span>, b.<span class="me1">y</span>, y<span class="br0">&#41;</span>
			<span class="sy3">&amp;&amp;</span> between <span class="br0">&#40;</span>c.<span class="me1">x</span>, d.<span class="me1">x</span>, x<span class="br0">&#41;</span> <span class="sy3">&amp;&amp;</span> between <span class="br0">&#40;</span>c.<span class="me1">y</span>, d.<span class="me1">y</span>, y<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">else</span>
		<span class="kw1">return</span> det <span class="br0">&#40;</span>A1, C1, A2, C2<span class="br0">&#41;</span> <span class="sy1">==</span> <span class="nu0">0</span> <span class="sy3">&amp;&amp;</span> det <span class="br0">&#40;</span>B1, C1, B2, C2<span class="br0">&#41;</span> <span class="sy1">==</span> <span class="nu0">0</span>
			<span class="sy3">&amp;&amp;</span> intersect_1 <span class="br0">&#40;</span>a.<span class="me1">x</span>, b.<span class="me1">x</span>, c.<span class="me1">x</span>, d.<span class="me1">x</span><span class="br0">&#41;</span>
			<span class="sy3">&amp;&amp;</span> intersect_1 <span class="br0">&#40;</span>a.<span class="me1">y</span>, b.<span class="me1">y</span>, c.<span class="me1">y</span>, d.<span class="me1">y</span><span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span></pre><p>Здесь сначала вычисляется коэффициент <img class=tex src="../tex2png/cache/2a8251254c9617148879b51105b04adc.png" alt="\rm zn"> &mdash; знаменатель в формуле Крамера. Если <img class=tex src="../tex2png/cache/fffd7db2f23690970c1edfff566956b0.png" alt="{\rm zn} = 0">, то коэффициенты <img class=tex src="../tex2png/cache/b5f17df636a8bd667d2f5c3404ed82e7.png" alt="A"> и <img class=tex src="../tex2png/cache/fb8234db4e6ea317a7c2aef7a38775ba.png" alt="B"> прямых пропорциональны, и прямые параллельны или совпадают. В этом случае надо проверить, совпадают они или нет, для чего надо проверить, что коэффициенты <img class=tex src="../tex2png/cache/5572481c8713abb69ad4011419e91fc7.png" alt="C"> прямых пропорциональны с тем же коэффициентом, для чего достаточно вычислить два следующих определителя, если они оба равны нулю, то прямые совпадают:<p class=formula><img class=tex src="../tex2png/cache/f3843941327446b308d790f179eba390.png" alt=" \left|\matrix{ A_1 & C_1 \cr A_2 & C_2 }\right|, [...]"></p><p>Если же <img class=tex src="../tex2png/cache/497b888b038d905d9c81dc39a0811e2e.png" alt="{\rm zn} \ne 0">, то прямые пересекаются, и по формуле Крамера находим точку пересечения <img class=tex src="../tex2png/cache/bceeeeebd9fec9d8ed4cd44b0d1a5b83.png" alt="(x,y)"> и проверяем её принадлежность обоим отрезкам.<p>Следует отметить, что если исходные координаты точек уже были вещественнозначными, то следует нормировать прямые (т.е. привести их к такому состоянию, что сумма квадратов коэффициентов <img class=tex src="../tex2png/cache/e4c9b6bf3a65f2e487e7cb3e199f2154.png" alt="a"> и <img class=tex src="../tex2png/cache/64e10b28938db2ba8a2b9fabb72a2cd9.png" alt="b"> равна единице), иначе погрешности при сравнении прямых на параллельность и на совпадение могут оказаться слишком большими.<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><hr><p>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'e-maxx';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script></td></tr></table></body></html>