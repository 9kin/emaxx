<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><title>MAXimal :: algo :: Теория Шпрага-Гранди. Ним</title><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><meta name="author" lang="ru" content="e-maxx" /><meta name="description" content="Алгоритмы, олимпиадное программирование, математика" /><meta name="keywords" content="алгоритмы программирование" /><meta name="google-site-verification" content="Pnjjj2XuxB0CTiqgDDvkp79bfSeDQ8Vw57iNeDJZkSc" /><link rel="stylesheet" type="text/css" href="../data/style.css"><script type="text/javascript" src="../data/jquery.js"></script><script type="text/javascript" src="../data/page-contents.js"></script><link rel="stylesheet" type="text/css" href="../geshi/geshi.css"><!--[if IE]><style>.menu a, .menu a:hover { width: 100%; }</style><![endif]--></head><body><table class=main cellpadding=0 cellspacing=0><tr><td class=title colspan=2><p>MAXimal</p></td></tr><tr><td class=menu><ul><li><a href="../index.php.html" >home</a></li><li><a href="index.html" class=current>algo</a></li><li><a href="../bookz/index.html" >bookz</a></li><li><a href="../forum/index.html" >forum</a></li><li><a href="../about.php.html" >about</a></li></ul></td><td class=content><p class=algoinfo>добавлено: 17 Jul 2009 23:00<br>редактировано: 15 Jul 2014 18:05</p><div id="contents-table"><p id="contents-table-title">Содержание <a href="sprague_grundy.html#" id="contents-hide">[скрыть]</a><a href="sprague_grundy.html#" id="contents-show" style="display:none">[показать]</a></p><div style="display:none"></div></div><h1> Теория Шпрага-Гранди. Ним </h1><p><p><h2 style="padding-top:40px;"> Введение </h2><p>Теория Шпрага-Гранди &mdash; это теория, описывающая так называемые <b>равноправные</b> (англ. "impartial") игры двух игроков, т.е. игры, в которых разрешённые ходы и выигрышность/проигрышность зависят только от состояния игры. От того, какой именно из двух игроков ходит, не зависит ничего: т.е. игроки полностью равноправны.<p>Кроме того, предполагается, что игроки располагают всей информацией (о правилах игры, возможных ходах, положении соперника).<p>Предполагается, что игра <b>конечна</b>, т.е. при любой стратегии игроки рано или поздно придут в <b>проигрышную</b> позицию, из которой нет переходов в другие позиции. Эта позиция является проигрышной для игрока, который должен делать ход из этой позиции. Соответственно, она является выигрышной для игрока, пришедшего в эту позицию. Понятно, ничейных исходов в такой игре не бывает.<p>Иными словами, такую игру можно полностью описать <b>ориентированным ациклическим графом</b>: вершинами в нём являются состояния игры, а рёбрами &mdash; переходы из одного состояния игры в другое в результате хода текущего игрока (повторимся, в этом первой и второй игрок равноправны). Одна или несколько вершин не имеют исходящих рёбер, они является проигрышными вершинами (для игрока, который должен совершать ход из такой вершины).<p>Поскольку ничейных исходов не бывает, то все состояния игры распадаются на два класса: <b>выигрышные и проигрышные</b>. Выигрышные &mdash; это такие состояния, что найдётся ход текущего игрока, который приведёт к неминуемому поражению другого игрока даже при его оптимальной игре. Соответственно, проигрышные состояния &mdash; это состояния, из которых все переходы ведут в состояния, приводящие к победе второго игрока, несмотря на "сопротивление" первого игрока. Иными словами, выигрышным будет состояние, из которого есть хотя бы один переход в проигрышное состояние, а проигрышным является состояние, из которого все переходы ведут в выигрышные состояния (или из которого вообще нет переходов).<p>Наша задача &mdash; для любой заданной игры провести классификацию состояний этой игры, т.е. для каждого состояния определить, выигрышное оно или проигрышное.<p>Теорию таких игр независимо разработали Роланд Шпраг (Roland Sprague) в 1935 г. и Патрик Майкл Гранди (Patrick Michael Grundy) в 1939 г.<p><p><h2 style="padding-top:40px;"> Игра "Ним" </h2><p>Эта игра является одним из примеров описываемых выше игр. Более того, как мы увидим чуть позже, <b>любая</b> из равноправных игр двух игроков на самом деле эквивалентна игре "ним" (англ. "nim"), поэтому изучение этой игры автоматически позволит нам решать все остальные игры (впрочем, об этом позже).<p>Исторически, эта игра была популярна ещё в древние времена. Вероятно, игра берёт своё происхождение в Китае &mdash; по крайней мере, китайская игра "Jianshizi" очень похожа на ним. В Европе первые упоминания о ниме относятся к XVI в. Само название "ним" придумал математик Чарлз Бутон (Charles Bouton), который в 1901 г. опубликовал полный анализ этой игры. Происхождение названия "ним" доподлинно неизвестно.<p><p><h3 style="padding-top:15px;"> Описание игры </h3><p>Игра "ним" представляет из себя следующую игру.<p>Есть несколько кучек, в каждой из которых по нескольку камней. За один ход игрок может взять из какой-нибудь одной кучки любое ненулевое число камней и выбросить их. Соответственно, проигрыш наступает, когда ходов больше не осталось, т.е. все кучки пусты.<p>Итак, состояние игры "ним" однозначно описывается неупорядоченным набором натуральных чисел. За один ход разрешается строго уменьшить любое из чисел (если в результате число станет нулём, то оно удаляется из набора).<p><p><h3 style="padding-top:15px;"> Решение нима </h3><p>Решение этой игры опубликовал в 1901 г. Чарлз Бутон (Charles L. Bouton), и выглядит оно следующим образом.<p><b>Теорема</b>. Текущий игрок имеет выигрышную стратегию тогда и только тогда, когда XOR-сумма размеров кучек отлична от нуля. В противном случае текущий игрок находится в проигрышном состоянии. (XOR-суммой чисел <img class=tex src="../tex2png/cache/ef875bf5bad8370d4f3bbe3c740d3dd3.png" alt="a_i"> называется выражение <img class=tex src="../tex2png/cache/3fa1cd044916b2b55d9418300b702722.png" alt="a_1 \oplus a_2 \oplus \ldots \oplus a_n">, где <img class=tex src="../tex2png/cache/e5f199ca03ee10d0e24361cf7a5b2a6b.png" alt="\oplus"> &mdash; операция побитового исключающего или)<p><b>Доказательство</b>.<p>Основная суть приведённого ниже доказательства &mdash; в наличии <b>симметричной стратегии для противника</b>. Мы покажем, что, оказавшись в состоянии с нулевой XOR-суммой, игрок не сможет выйти из этого состояния &mdash; при любом его переходе в состояние с ненулевой XOR-суммой у противника найдётся ответный ход, возвращающий XOR-сумму обратно в ноль.<p>Приступим теперь к формальному доказательству (оно будет конструктивным, т.е. мы покажем, как именно выглядит симметричная стратегия противника &mdash; какой именно ход нужно будет ему совершать).<p>Доказывать теорему будем по индукции.<p>Для пустого нима (когда размеры всех кучек равны нулю) XOR-сумма равна нулю, и теорема верна.<p>Пусть теперь мы хотим доказать теорему для некоторого состояния игры, из которого есть хотя бы один переход. Пользуясь предположением индукции (и ацикличностью игры) мы считаем, что теорема доказана для всех состояний, в которые мы можем попасть из текущего.<p>Тогда доказательство распадается на две части: если XOR-сумма <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s"> в текущем состоянии <img class=tex src="../tex2png/cache/3fd8c8a2e270f1b69794b4e461773e68.png" alt="=0">, то надо доказать, что текущее состояние проигрышно, т.е. все переходы из него ведут в состояния с XOR-суммой <img class=tex src="../tex2png/cache/b458aa5a657624fc647c15c1de91aa20.png" alt="t \ne 0">. Если же <img class=tex src="../tex2png/cache/270861a310b5030d0b6a524703e037f5.png" alt="s \ne 0">, то надо доказать, что найдётся переход, приводящий нас в состояние с <img class=tex src="../tex2png/cache/208dab3ad8e9d7abec663c3d7f27b177.png" alt="t = 0">.<p><ul><p><li>Пусть <img class=tex src="../tex2png/cache/ed839d5613296505b41ca782f510329b.png" alt="s = 0">, тогда мы хотим доказать, что текущее состояние &mdash; проигрышно. Рассмотрим любой переход из текущего состояния нима: обозначим через <img class=tex src="../tex2png/cache/2f8934466bea85c9661745280df23800.png" alt="p"> номер изменяемой кучки, через <img class=tex src="../tex2png/cache/bdf4742dd10f0eb4f2b7801e40b0e129.png" alt="x_i"> (<img class=tex src="../tex2png/cache/1cf0d52047c38a1a3bbeab42c2de96a3.png" alt="i = 1 \ldots n">) &mdash; размеры кучек до хода, через <img class=tex src="../tex2png/cache/fb0ccfa89dc1cadb04e1c765e4f696d7.png" alt="y_i"> (<img class=tex src="../tex2png/cache/1cf0d52047c38a1a3bbeab42c2de96a3.png" alt="i = 1 \ldots n">) &mdash; после хода. Тогда, пользуясь элементарными свойствами функции <img class=tex src="../tex2png/cache/e5f199ca03ee10d0e24361cf7a5b2a6b.png" alt="\oplus">, мы имеем:<p><p class=formula><img class=tex src="../tex2png/cache/9d01ca15f2a8bfb92568166703a0d80e.png" alt=" t = s \oplus x_p \oplus y_p = 0 \oplus x_p \oplus[...]"></p><p>Но поскольку <img class=tex src="../tex2png/cache/e4239f79d8849a5671341f6106afb3ff.png" alt="y_p < x_p">, то это означает, что <img class=tex src="../tex2png/cache/b458aa5a657624fc647c15c1de91aa20.png" alt="t \ne 0">. Значит, новое состояние будет иметь ненулевую XOR-сумму, т.е., согласно базе индукции, будет выигрышным, что и требовалось доказать.<p><li>Пусть <img class=tex src="../tex2png/cache/270861a310b5030d0b6a524703e037f5.png" alt="s \ne 0">. Тогда наша задача &mdash; доказать, что текущее состояние &mdash; выигрышно, т.е. из него существует ход в проигрышное состояние (с нулевой XOR-суммой).<p>Рассмотрим битовую запись числа <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s">. Возьмём старший ненулевой бит, пусть его номер равен <img class=tex src="../tex2png/cache/30956e25578e9cb8f03bd9d36433020c.png" alt="d">. Пусть <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> &mdash; номер той кучки, у размер <img class=tex src="../tex2png/cache/3332bcb94aa6610dbb2cc4e0b67581a5.png" alt="x_k"> которой <img class=tex src="../tex2png/cache/30956e25578e9cb8f03bd9d36433020c.png" alt="d">-ый бит отличен от нуля (такое <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> найдётся, иначе бы в XOR-сумме <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s"> этот бит не получился бы отличным от нуля).<p>Тогда, утверждается, искомый ход &mdash; это изменить <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k">-ую кучку, сделав её размера <img class=tex src="../tex2png/cache/3f690a149cc111a6e1260dcc96637ffc.png" alt="y_k = x_k \oplus s">.<p>Убедимся в этом.<p>Сначала надо проверить, что это ход корректный, т.е. что <img class=tex src="../tex2png/cache/1641390bbcb14df72baf562b4e9eabb7.png" alt="y_k < x_k">. Однако это верно, поскольку все биты, старшие <img class=tex src="../tex2png/cache/30956e25578e9cb8f03bd9d36433020c.png" alt="d">-го, у <img class=tex src="../tex2png/cache/3332bcb94aa6610dbb2cc4e0b67581a5.png" alt="x_k"> и <img class=tex src="../tex2png/cache/134a7d3afcf0f1246e5e9b3af50ba87b.png" alt="y_k"> совпадают, а в <img class=tex src="../tex2png/cache/30956e25578e9cb8f03bd9d36433020c.png" alt="d">-ом бите у <img class=tex src="../tex2png/cache/134a7d3afcf0f1246e5e9b3af50ba87b.png" alt="y_k"> будет ноль, а у <img class=tex src="../tex2png/cache/3332bcb94aa6610dbb2cc4e0b67581a5.png" alt="x_k"> будет единица.<p>Теперь посчитаем, какая XOR-сумма получится при этом ходе:<p><p class=formula><img class=tex src="../tex2png/cache/b61e902f4634670b839e7a229dd069de.png" alt=" t = s \oplus x_k \oplus y_k = s \oplus x_k \oplus[...]"></p><p>Таким образом, указанный нами ход &mdash; действительно ход в проигрышное состояние, а это и доказывает, что текущее состояние выигрышно.<p></ul><p>Теорема доказана.<p><b>Следствие</b>. Любое состояние ним-игры можно заменить эквивалентным состоянием, состоящим из единственной кучки размера, равного XOR-сумме размеров кучек в старом состоянии.<p>Иными словами, при анализе нима с несколькими кучками можно посчитать XOR-сумму <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s"> их размеров, и перейти к анализу нима из единственной кучки размера <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s"> &mdash; как показывает только что доказанная теорема, выигрышность/проигрышность от этого не изменится.<p><p><h2 style="padding-top:40px;"> Эквивалентность любой игры ниму. Теорема Шпрага-Гранди </h2><p>Здесь мы покажем, как любой игре (равноправной игре двух игроков) поставить в соответствие ним. Иными словами, любому состоянию любой игры мы научимся ставить в соответствие ним-кучку, полностью описывающее состояние исходной игры.<p><p><h3 style="padding-top:15px;"> Лемма о ниме с увеличениями </h3><p>Докажем сначала очень важную лемму &mdash; <b>лемму о ниме с увеличениями</b>.<p>А именно, рассмотрим следующий модифицированный ним: всё так же, как и в обычном ниме, однако теперь разрешается дополнительный вид хода: вместо уменьшения, наоборот, <b>увеличить размер некоторой кучки</b>. Если быть более точным, то ход игрока теперь заключается в том, что он либо забирает ненулевое количество камней из какой-нибудь кучки, либо увеличивает размер какой-либо кучки (в соответствии с некими правилами, см. следующий абзац).<p>Здесь важно понимать, что правила того, как именно игрок может совершать увеличения, <b>нас не интересуют</b> &mdash; однако такие правила всё же должны быть, чтобы наша игра по-прежнему была <b>ациклична</b>. Ниже в разделе "Примеры игр" рассмотрены примеры таких игр: "лестничный ним", "nimble-2", "turning turtles".<p>Повторимся, лемма будет доказана нами вообще для любых игр такого вида &mdash; игр вида "ним с увеличениями"; конкретные правила увеличений в доказательстве никак не используются.<p><b>Формулировка леммы</b>. Ним с увеличениями эквивалентен обычному ниму, в том смысле, что выигрышность/проигрышность состояния определяется по теореме Бутона согласно XOR-сумме размеров кучек. (Или, иными словами, суть леммы в том, что увеличения бесполезны, их нет смысла применять в оптимальной стратегии, и они никак не меняют выигрышность/проигрышность по сравнению с обычным нимом.)<p><b>Доказательство</b>.<p>Идея доказательства, как и в теореме Бутона &mdash; в наличии <b>симметричной стратегии</b>. Мы покажем, что увеличения ничего не меняют, поскольку после того, как один из игроков прибегнет к увеличению, другой сможет симметрично ответить ему.<p>В самом деле, предположим, что текущий игрок совершает ход-увеличение какой-либо кучки. Тогда его соперник сможет просто ответить ему, уменьшив обратно эту кучку до старого значения &mdash; ведь обычные ходы нима у нас по-прежнему могут свободно использоваться.<p>Таким образом, симметричным ответом на ход-увеличение будет ход-уменьшение обратно до старого размера кучки. Следовательно, после такого ответа игра вернётся обратно к тем же размерам кучек, т.е. игрок, совершивший увеличение, ничего от этого не выиграет. Т.к. игра ациклична, то рано или поздно ходы-увеличения кончатся, и текущему игроку придётся делать ход-уменьшение, а это и означает, что наличие увеличивающих ходов не меняет ровным счётом ничего.<p><p><h3 style="padding-top:15px;"> Теорема Шпрага-Гранди об эквивалентности любой игры ниму </h3><p>Перейдём теперь к самому главному в данной статье факту &mdash; теореме об эквивалентности ниму любой равноправной игры двух игроков.<p><b>Теорема Шпрага-Гранди</b>. Рассмотрим любое состояние <img class=tex src="../tex2png/cache/9530057de1d317139fef00be858ff2f1.png" alt="v"> некоторой равноправной игры двух игроков. Пусть из него есть переходы в некоторые состояния <img class=tex src="../tex2png/cache/6d1e63c6b617ead2db9a741c08cb44cb.png" alt="v_i"> <img class=tex src="../tex2png/cache/83ed0fde7fc0972db449033109e687de.png" alt="(i=1 \ldots k)"> (где <img class=tex src="../tex2png/cache/63e3314b884e64c2cdaf88946d0eaf68.png" alt="k \ge 0">). Утверждается, что состоянию <img class=tex src="../tex2png/cache/9530057de1d317139fef00be858ff2f1.png" alt="v"> этой игры можно поставить в соответствие кучку нима некоторого размера <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x"> (которая будет полностью описывать состояние <img class=tex src="../tex2png/cache/9530057de1d317139fef00be858ff2f1.png" alt="v"> нашей игры &mdash; т.е. эти два состояния двух разных игр будут эквивалентны). Это число <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x"> &mdash; называется <b>значением Шпрага-Гранди</b> состояния <img class=tex src="../tex2png/cache/9530057de1d317139fef00be858ff2f1.png" alt="v">.<p>Более того, это число <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x"> можно находить следующим рекурсивным образом: посчитаем значение Шпрага-Гранди <img class=tex src="../tex2png/cache/bdf4742dd10f0eb4f2b7801e40b0e129.png" alt="x_i"> по каждому переходу <img class=tex src="../tex2png/cache/80766781dd737dcbf37cd9a4e0d3ee65.png" alt="(v,v_i)">, и тогда выполняется:<p><p class=formula><img class=tex src="../tex2png/cache/821f4fc0122d075418e03761fc4aee6d.png" alt=" x = {\rm mex} \{ x_1, \ldots, x_k \}, "></p><p>где функция <img class=tex src="../tex2png/cache/790b9e558ae5ec4f1751bf65279bc125.png" alt="\rm mex"> от множества чисел возвращает наименьшее неотрицательное число, не встречающееся в этом множестве (название "mex" &mdash; это сокращение от "minimum excludant").<p>Таким образом, мы можем, стартуя от вершин без исходящих рёбер, постепенно <b>посчитать значения Шпрага-Гранди для всех состояний нашей игры</b>. Если значение Шпрага-Гранди какого-либо состояния равно нулю, то это состояние проигрышно, иначе &mdash; выигрышно.<p><b>Доказательство</b>. Доказывать теорему будем по индукции.<p>Для вершин, из которых нет ни одного перехода, величина <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x"> согласно теореме будет получаться как <img class=tex src="../tex2png/cache/790b9e558ae5ec4f1751bf65279bc125.png" alt="\rm mex"> от пустого множества, т.е. <img class=tex src="../tex2png/cache/d32f2231d5fc4448b5431a812a7485a4.png" alt="x = 0">. Но, в самом деле, состояние без переходов &mdash; это проигрышное состояние, и ему действительно должна соответствовать ним-кучка размера <img class=tex src="../tex2png/cache/d796aaaffd5bff4144c8ac3509c1d33d.png" alt="0">.<p>Рассмотрим теперь любое состояние <img class=tex src="../tex2png/cache/9530057de1d317139fef00be858ff2f1.png" alt="v">, из которого есть переходы. По индукции мы можем считать, что для всех состояний <img class=tex src="../tex2png/cache/6d1e63c6b617ead2db9a741c08cb44cb.png" alt="v_i">, в которые мы можем перейти из текущего состояния, значения <img class=tex src="../tex2png/cache/bdf4742dd10f0eb4f2b7801e40b0e129.png" alt="x_i"> уже подсчитаны.<p>Посчитаем величину <img class=tex src="../tex2png/cache/da7c5127d4f634d3a19c2fe8e5a3fc93.png" alt="p = {\rm mex} \{ x_1, \ldots, x_k \}">. Тогда, согласно определению функции <img class=tex src="../tex2png/cache/790b9e558ae5ec4f1751bf65279bc125.png" alt="\rm mex">, мы получаем, что для любого числа <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i"> в промежутке <img class=tex src="../tex2png/cache/4858b0aed1d7974ed13bd7b853d01f97.png" alt="[0; p)"> найдётся хотя бы один соответствующий переход в какое-то из <img class=tex src="../tex2png/cache/6d1e63c6b617ead2db9a741c08cb44cb.png" alt="v_i">-ых состояние. Кроме того, могут существовать также дополнительные переходы &mdash; в состояния со значениями Гранди, большими <img class=tex src="../tex2png/cache/2f8934466bea85c9661745280df23800.png" alt="p">.<p>Это означает, что текущее состояние <b>эквивалентно состоянию ниму с увеличениями с кучкой размера <img class=tex src="../tex2png/cache/2f8934466bea85c9661745280df23800.png" alt="p"></b>: в самом деле, у нас есть переходы из текущего состояния в состояния с кучками всех меньших размеров, а также могут быть переходы в состояния больших размеров.<p>Следовательно, величина <img class=tex src="../tex2png/cache/388f16686215816eccd4adb6b6ef7449.png" alt="{\rm mex} \{ x_1, \ldots, x_k \}"> действительно является искомым значением Шпрага-Гранди для текущего состояния, что и требовалось доказать.<p><p><h2 style="padding-top:40px;"> Применение теоремы Шпрага-Гранди </h2><p>Опишем наконец целостный алгоритм, применимый к любой равноправной игре двух игроков для определения выигрышности/проигрышности текущего состояния <img class=tex src="../tex2png/cache/9530057de1d317139fef00be858ff2f1.png" alt="v">.<p>Функция, которая каждому состоянию игры ставит в соответствие ним-число, называется <b>функцией Шпрага-Гранди</b>.<p>Итак, чтобы посчитать функцию Шпрага-Гранди для текущего состояния некоторой игры, нужно:<p><ul><p><li>Выписать все возможные переходы из текущего состояния.<p><li>Каждый такой переход может вести либо в одну игру, либо в <b>сумму независимых игр</b>.<p>В первом случае &mdash; просто посчитаем функцию Гранди рекурсивно для этого нового состояния.<p>Во втором случае, когда переход из текущего состояния приводит в сумму нескольких независимых игр &mdash; рекурсивно посчитаем для каждой из этих игр функцию Гранди, а затем скажем, что функция Гранди суммы игр равна XOR-сумме значений этих игр.<p><li>После того, как мы посчитали функцию Гранди для каждого возможного перехода &mdash; считаем <img class=tex src="../tex2png/cache/790b9e558ae5ec4f1751bf65279bc125.png" alt="\rm mex"> от этих значений, и найденное число &mdash; и есть искомое значение Гранди для текущего состояния.<p><li>Если полученное значение Гранди равно нулю, то текущее состояние проигрышно, иначе &mdash; выигрышно.<p></ul><p>Таким образом, по сравнению с теоремой Шпрага-Гранди здесь мы учитываем то, что в игре могут быть переходы из отдельных состояний в <b>суммы нескольких игр</b>. Чтобы работать с суммами игр, мы сначала заменяем каждую игру её значением Гранди, т.е. одной ним-кучкой некоторого размера. После этого мы приходим к сумме нескольких ним-кучек, т.е. к обычному ниму, ответ для которого, согласно теореме Бутона &mdash; XOR-сумма размеров кучек.<p><p><h2 style="padding-top:40px;"> Закономерности в значениях Шпрага-Гранди </h2><p>Очень часто при решении конкретных задач, когда требуется научиться считать функцию Шпрага-Гранди для заданной игры, помогает <b>изучение таблиц значений</b> этой функции в поисках закономерностей.<p>Во многих играх, кажущихся весьма трудными для теоретического анализа, функция Шпрага-Гранди на практике оказывается периодичной, либо же имеющей очень простой вид, который легко заметить "на глаз". В подавляющем большинстве случаев увиденные закономерности являются верными, и при желании доказываемыми с помощью математической индукции.<p>Впрочем, далеко не всегда функция Шпрага-Гранди содержит простые закономерности, а для некоторых, даже весьма простых по формулировке, игр вопрос о наличии таких закономерностей до сих пор открыт (например, "Grundy's game" ниже).<p><p><h2 style="padding-top:40px;"> Примеры игр </h2><p>Для наглядной демонстрации теории Шпрага-Гранди, разберём несколько задач.<p>Особо следует обратить внимание на задачи "лестничный ним", "nimble-2", "turning turtles", в которой демонстрируется нетривиальное сведение исходной задачи к ниму с увеличениями.<p><p><h3 style="padding-top:15px;"> "Крестики-крестики" </h3><p><b>Условие</b>. Рассмотрим клетчатую полоску размера <img class=tex src="../tex2png/cache/2a0e6b01ceb0c2f0a3764b1967a715f3.png" alt="1 \times n"> клеток. За один ход игроку надо поставить один крестик, но при этом запрещено ставить два крестика рядом (в соседние клетки). Проигрывает тот, кто не может сделать ход. Сказать, кто выиграет при оптимальной игре.<p><b>Решение</b>. Когда игрок ставит крестик в какую-либо клетку, можно считать, что вся полоска распадается на две независимые половинки: слева от крестика и справа от него. При этом сама клетка с крестиком, а также её левый и правый сосед уничтожаются &mdash; т.к. в них больше ничего нельзя будет поставить.<p>Следовательно, если мы занумеруем клетки полоски от <img class=tex src="../tex2png/cache/1737ac55fdbc871d8c7d14245b749ccd.png" alt="1"> до <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n">, то, поставив крестик в позицию <img class=tex src="../tex2png/cache/87bfa42a747d31f8dd0f33305855cbc1.png" alt="1 < i < n">, полоска распадётся на две полоски длины <img class=tex src="../tex2png/cache/28263d664fb55ed088f9b6fcaef4acd0.png" alt="i-2"> и <img class=tex src="../tex2png/cache/e0566ccc8abea5620a5772ddc7b5a194.png" alt="n-i-1">, т.е. мы переходим в сумму двух игр <img class=tex src="../tex2png/cache/28263d664fb55ed088f9b6fcaef4acd0.png" alt="i-2"> и <img class=tex src="../tex2png/cache/e0566ccc8abea5620a5772ddc7b5a194.png" alt="n-i-1">. Если же крестик ставится в позицию <img class=tex src="../tex2png/cache/1737ac55fdbc871d8c7d14245b749ccd.png" alt="1"> или <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n">, то это особый случай &mdash; мы просто перейдём в состояние <img class=tex src="../tex2png/cache/3c24e4e1066ea76ff7ba0fb29a761758.png" alt="n-2">.<p>Таким образом, функция Гранди <img class=tex src="../tex2png/cache/ca07abdace0de1298e2158bc4f554d97.png" alt="g[n]"> имеет вид (для <img class=tex src="../tex2png/cache/57e74afb511d3977121a467b910ccd30.png" alt="n \ge 3">):<p><p class=formula><img class=tex src="../tex2png/cache/3be0b1d46c890cd0ca5951ea80b197f8.png" alt=" g[n] = {\rm mex} \Bigg\{ g[n-2], \bigcup_{i=2}^{n[...]"></p><p>Т.е. <img class=tex src="../tex2png/cache/ca07abdace0de1298e2158bc4f554d97.png" alt="g[n]"> получается как <img class=tex src="../tex2png/cache/790b9e558ae5ec4f1751bf65279bc125.png" alt="\rm mex"> от множества, состоящего из числа <img class=tex src="../tex2png/cache/12f45c1178eaa01f0e494a70ab427b48.png" alt="g[n-2]">, а также всевозможных значений выражения <img class=tex src="../tex2png/cache/f574fc51918a304fde06373cc2dc2f78.png" alt="g[i-2] \oplus g[n-i-1]">.<p>Итак, мы получили решение этой задачи за <img class=tex src="../tex2png/cache/4cd2772b06262896a7cf8a9d3c989ea4.png" alt="O (n^2)">.<p>На самом деле, посчитав на компьютере таблицу значений для первой сотни значений <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n">, можно увидеть, что, начиная с <img class=tex src="../tex2png/cache/bb960b5fe7567861d10d3b6a513c15f7.png" alt="n=52">, последовательность <img class=tex src="../tex2png/cache/ca07abdace0de1298e2158bc4f554d97.png" alt="g[n]"> становится периодичной с периодом <img class=tex src="../tex2png/cache/41ff2803c1bb2ea6a317432ee7a257f9.png" alt="34">. Эта закономерность сохраняется и дальше (что, вероятно, можно доказать по индукции).<p><p><h3 style="padding-top:15px;"> "Крестики-крестики &mdash; 2" </h3><p><b>Условие</b>. Снова игра ведётся на полоске <img class=tex src="../tex2png/cache/2a0e6b01ceb0c2f0a3764b1967a715f3.png" alt="1 \times n"> клеток, и игроки по очереди ставят по одному крестику. Выигрывает тот, кто поставит три крестика подряд.<p><b>Решение</b>. Заметим, что если <img class=tex src="../tex2png/cache/3089c6f6d26fb2ddfe8ac47cee34a160.png" alt="n>2"> и мы оставили после своего хода два крестика рядом или через один пробел, то противник следующим ходом выиграет. Следовательно, если один игрок поставил где-то крестик, то другому игроку невыгодно ставить крестик в соседние с ним клетки, а также в соседние с соседними (т.е. на расстоянии <img class=tex src="../tex2png/cache/1737ac55fdbc871d8c7d14245b749ccd.png" alt="1"> и <img class=tex src="../tex2png/cache/1f68ec6d6ed94148fc6fb5efafc8a688.png" alt="2"> ставить невыгодно, это приведёт к поражению).<p>Тогда решение получается практически аналогичным предыдущей задаче, только теперь крестик удаляет у каждой половинки не по одной, а сразу по две клетки.<p><p><h3 style="padding-top:15px;"> "Пешки" </h3><p><b>Условие</b>. Есть поле <img class=tex src="../tex2png/cache/3f2fe34309b91f4dcef3e290c650226c.png" alt="3 \times n">, на котором в первом и третьем ряду стоят по <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> пешек &mdash; белых и чёрных, соответственно. Первый игрок ходит белыми пешками, второй &mdash; чёрными. Правила хода и удара &mdash; стандартные шахматные, за исключением того, что бить (при наличии такой возможности) обязательно.<p><b>Решение</b>. Проследим, что происходит, когда одна пешка сделает ход вперёд. Следующим ходом противник будет обязан съесть её, затем мы будем обязаны съесть пешку противника, затем снова он съест, и, наконец, наша пешка съест вражескую пешку и останется, "упёршись" в пешку противника. Таким образом, если мы в самом начале пошли пешкой в колонке <img class=tex src="../tex2png/cache/87bfa42a747d31f8dd0f33305855cbc1.png" alt="1 < i < n">, то в результате три колонки <img class=tex src="../tex2png/cache/d3103fadfa21c079b2a640bc95bc40fb.png" alt="[i-1; i+1]"> доски фактически уничтожатся, и мы перейдём к сумме игр размера <img class=tex src="../tex2png/cache/28263d664fb55ed088f9b6fcaef4acd0.png" alt="i-2"> и <img class=tex src="../tex2png/cache/8f490787169c4917e2e902b5e43161a7.png" alt="n - i - 1">. Граничные случаи <img class=tex src="../tex2png/cache/f139289eb1f84cc9579e92a95127828f.png" alt="i=1"> и <img class=tex src="../tex2png/cache/0e5f7b383b2dad6ca049877b37971120.png" alt="i=n"> приводят нас просто к доске размера <img class=tex src="../tex2png/cache/3c24e4e1066ea76ff7ba0fb29a761758.png" alt="n-2">.<p>Таким образом, мы получили выражения для функции Гранди, аналогичные рассмотренной выше задаче "Крестики-крестики".<p><p><h3 style="padding-top:15px;"> "Lasker's nim" </h3><p><b>Условие</b>. Имеется <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> кучек камней заданных размеров. За один ход игрок может взять любое ненулевое число камней из какой-либо кучки, либо же разделить какую-либо кучку на две непустые кучки. Проигрывает тот, кто не может сделать ход.<p><b>Решение</b>. Записывая оба вида переходов, легко получить функцию Шпрага-Гранди как:<p><p class=formula><img class=tex src="../tex2png/cache/90643a0e09c8b245240cf20a60fbf3b1.png" alt=" g[n] = {\rm mex} \Bigg\{ \bigcup_{i=0}^{n-1} g[i][...]"></p><p>Однако можно построить таблицу значений для малых <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> и увидеть простую закономерность:<p><p class=formula><img class=tex src="../tex2png/cache/164c1eb003e9262006b2b9808d2cdf2c.png" alt=" \matrix{
n & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 &[...]"></p><p>Здесь видно, что <img class=tex src="../tex2png/cache/a08f20fcefb6418517f059753af02857.png" alt="g[n] = n"> для чисел, равных <img class=tex src="../tex2png/cache/1737ac55fdbc871d8c7d14245b749ccd.png" alt="1"> или <img class=tex src="../tex2png/cache/1f68ec6d6ed94148fc6fb5efafc8a688.png" alt="2"> по модулю <img class=tex src="../tex2png/cache/540ccd7efd169a4313503b565bb0ce55.png" alt="4">, и <img class=tex src="../tex2png/cache/fd4b4526b2c2cf8a510c40264f600299.png" alt="g[n] = n \pm 1"> для чисел, равных <img class=tex src="../tex2png/cache/0e96f2a3dff7da2f31d78c5306207a14.png" alt="3"> и <img class=tex src="../tex2png/cache/d796aaaffd5bff4144c8ac3509c1d33d.png" alt="0"> по модулю <img class=tex src="../tex2png/cache/540ccd7efd169a4313503b565bb0ce55.png" alt="4">. Доказать это можно по индукции.<p><p><h3 style="padding-top:15px;"> "The game of Kayles" </h3><p><b>Условие</b>. Есть <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> кегель, выставленных в ряд. За один удар игрок может выбить либо одну кеглю, либо две рядом стоящие кегли. Выигрывает тот, который выбил последнюю кеглю.<p><b>Решение</b>. И когда игрок выбивает одну кеглю, и когда он выбивает две &mdash; игра распадается на сумму двух независимых игр.<p>Нетрудно получить такое выражение для функции Шпрага-Гранди:<p><p class=formula><img class=tex src="../tex2png/cache/826f72a16f2ea910580c2741c6cfe85f.png" alt=" g[n] = {\rm mex} \Bigg\{ \bigcup_{i=0}^{n-1} \Big[...]"></p><p>Посчитаем для него таблицу для нескольких первых десятков элементов:<p><p class=formula><img class=tex src="../tex2png/cache/49230e2564a1a0eeb2b4b667148c2c47.png" alt=" \matrix{
g[0 \ldots 11]: & 0 & 1 & 2 & 3 & 1 & 4[...]"></p><p>Можно заметить, что, начиная с некоторого момента, последовательность становится периодичной с периодом <img class=tex src="../tex2png/cache/ee1434096a19d64697cb61dd538468cc.png" alt="12">. В дальнейшем эта периодичность также не нарушится.<p><p><h3 style="padding-top:15px;"> Grundy's game </h3><p><b>Условие</b>. Есть <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> кучек камней, размеры которых мы обозначим через <img class=tex src="../tex2png/cache/ef875bf5bad8370d4f3bbe3c740d3dd3.png" alt="a_i">. За один ход игрок может взять какую-либо кучку размера как минимум <img class=tex src="../tex2png/cache/0e96f2a3dff7da2f31d78c5306207a14.png" alt="3"> и разделить её на две непустые кучки неравных размеров. Проигрывает тот, кто не может сделать ход (т.е. когда размеры всех оставшихся кучек меньше либо равны двум).<p><b>Решение</b>. Если <img class=tex src="../tex2png/cache/6afa0e10d372c154b1a0e9906e022455.png" alt="n > 1">, то все эти несколько кучек, очевидно, &mdash; независимые игры. Следовательно, наша задача &mdash; научиться искать функцию Шпрага-Гранди для одной кучки, а ответ для нескольких кучек будет получаться как их XOR-сумма.<p>Для одной кучки эта функция строится также легко, достаточно просмотреть все возможные переходы:<p><p class=formula><img class=tex src="../tex2png/cache/536e017f14982250e4bb3aab26c084d9.png" alt=" g[n] = {\rm mex} \Bigg\{ \bigcup_{i=[1 \ldots n-1[...]"></p><p>Чем эта игра интересна &mdash; тем, что до сих пор для неё не найдено общей закономерности. Несмотря на предположения, что последовательность <img class=tex src="../tex2png/cache/ca07abdace0de1298e2158bc4f554d97.png" alt="g[n]"> должна быть периодичной, она была просчитана вплоть до <img class=tex src="../tex2png/cache/acf5ed73809835b484dedfda8d4ef4e4.png" alt="2^{35}">, и периодов в этой области обнаружено не было.<p><p><h3 style="padding-top:15px;"> "Лестничный ним" </h3><p><b>Условие</b>. Есть лестница с <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> ступеньками (занумерованными от <img class=tex src="../tex2png/cache/1737ac55fdbc871d8c7d14245b749ccd.png" alt="1"> до <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n">), на <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i">-ой ступеньке лежит <img class=tex src="../tex2png/cache/ef875bf5bad8370d4f3bbe3c740d3dd3.png" alt="a_i"> монет. За один ход разрешается переместить некоторое ненулевое число монет с <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i">-ой на <img class=tex src="../tex2png/cache/81feab0e2cc1a37ff2c95e0a32cf5fc3.png" alt="i-1">-ую ступеньку. Проигрывает тот, кто не может сделать хода.<p><b>Решение</b>. Если попытаться свести эту задачу к ниму "в лоб", то получится, что ход у нас &mdash; это уменьшение одной кучки на сколько-то, и одновременное увеличение другой кучки на столько же. В итоге мы получаем модификацию нима, решить которую весьма сложно.<p>Поступим по-другому: рассмотрим только ступеньки с чётными номерами: <img class=tex src="../tex2png/cache/42616bea83b4f6b8be0a16c189ee61d5.png" alt="a_2, a_4, a_6, \ldots">. Посмотрим, как будет меняться этот набор чисел при совершении одного хода.<p>Если ход делается с чётным <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i">, то тогда этот ход означает уменьшение числа <img class=tex src="../tex2png/cache/ef875bf5bad8370d4f3bbe3c740d3dd3.png" alt="a_i">. Если же ход делается с нечётным <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i"> (<img class=tex src="../tex2png/cache/90ba1684c1882c21a4d17a268cc62a10.png" alt="i > 1">), то это означает увеличение <img class=tex src="../tex2png/cache/9f5dacc96591f67535ac70f5337e7095.png" alt="a_{i-1}">.<p>Получается, что наша задача &mdash; это обыкновенный ним с увеличениями с размерами кучек <img class=tex src="../tex2png/cache/42616bea83b4f6b8be0a16c189ee61d5.png" alt="a_2, a_4, a_6, \ldots">.<p>Следовательно, функция Гранди от него &mdash; это XOR-сумма чисел вида <img class=tex src="../tex2png/cache/a0d35763959487deab97f8a26256e34b.png" alt="a_{2i}">.<p><p><h3 style="padding-top:15px;"> "Nimble" и "Nimble-2" </h3><p><b>Условие</b>. Есть клетчатая полоска <img class=tex src="../tex2png/cache/2a0e6b01ceb0c2f0a3764b1967a715f3.png" alt="1 \times n">, на которой расположены <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> монет: <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i">-ая монета находится в <img class=tex src="../tex2png/cache/ef875bf5bad8370d4f3bbe3c740d3dd3.png" alt="a_i">-ой клетке. За один ход игрок может взять какую-то монету и подвинуть её влево на произвольное число клеток, но так, чтобы она не вылезла за пределы полоски. В игре "Nimble-2" дополнительно запрещается перепрыгивать другие монеты (или даже ставить две монеты в одну клетку). Проигрывает тот, кто не может сделать ход.<p><b>Решение "Nimble"</b>. Заметим, что монеты в этой игре независимы друг от друга. Более того, если мы рассмотрим набор чисел <img class=tex src="../tex2png/cache/47039910803f7ef5f00cce9c7f038738.png" alt="a_i-1"> <img class=tex src="../tex2png/cache/2b2a7319b278ab43dc79d75fcedb07e1.png" alt="(i = 1 \ldots k)">, то понятно, что за один ход игрок может взять любое из этих чисел и уменьшить его, а проигрыш наступает, когда все числа обращаются в ноль. Следовательно, игра "Nimble" &mdash; это <b>обычный ним</b>, и ответом на задачу является XOR-сумма чисел <img class=tex src="../tex2png/cache/47039910803f7ef5f00cce9c7f038738.png" alt="a_i-1">.<p><b>Решение "Nimble-2"</b>. Перенумеруем монеты в порядке их следования слева направо. Тогда обозначим через <img class=tex src="../tex2png/cache/21d1e5e0a98550967314625438cc5c3b.png" alt="d_i"> расстояние от <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i">-ой до <img class=tex src="../tex2png/cache/81feab0e2cc1a37ff2c95e0a32cf5fc3.png" alt="i-1">-ой монеты:<p><p class=formula><img class=tex src="../tex2png/cache/3bf585250bf02ea097cc99288849dd58.png" alt=" d_i = a_i - a_{i-1} - 1, ~~~~ (i = 1 \ldots k) "></p><p>(считая, что <img class=tex src="../tex2png/cache/ab6940d1a6451e8b5f8eaeb0ef7904f5.png" alt="a_0 = 0">).<p>Тогда за один игрок может отнять от какого-нибудь <img class=tex src="../tex2png/cache/54f5be23b588bd01d2e6d6ac258caeef.png" alt="d_p"> некоторое число <img class=tex src="../tex2png/cache/733a381de525580104aa275afe299ec1.png" alt="q">, и прибавить это же число <img class=tex src="../tex2png/cache/733a381de525580104aa275afe299ec1.png" alt="q"> к <img class=tex src="../tex2png/cache/45f8f15bcbc32785efc20018c102b1b7.png" alt="d_{p+1}">. Таким образом, эта игра &mdash; это фактически <b>"лестничный ним"</b> над числами <img class=tex src="../tex2png/cache/21d1e5e0a98550967314625438cc5c3b.png" alt="d_i"> (надо лишь изменить порядок этих чисел на противоположный).<p><p><h3 style="padding-top:15px;"> "Turning turtles" и "Twins" </h3><p><b>Условие</b>. Дана клетчатая полоска размера <img class=tex src="../tex2png/cache/2a0e6b01ceb0c2f0a3764b1967a715f3.png" alt="1 \times n">. В каждой клетке стоит либо крестик, либо нолик. За один ход можно взять какой-то нолик и превратить его в крестик.<p>При этом <b>дополнительно</b> разрешается выбрать одну из клеток слева от изменяемой и изменить в ней значение на противоположное (т.е. нолик заменить на крестик, а крестик &mdash; на нолик). В игре "turning turtles" делать это не обязательно (т.е. ход игрока может ограничиваться превращением нолика в крестик), а в "twins" &mdash; обязательно.<p><b>Решение "turning turtles"</b>. Утверждается, что эта игра &mdash; это обычный ним над числами <img class=tex src="../tex2png/cache/0993821d823b5b792321f13c90efa683.png" alt="b_i">, где <img class=tex src="../tex2png/cache/0993821d823b5b792321f13c90efa683.png" alt="b_i"> &mdash; позиция <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i">-го нолика (в 1-индексации). Проверим это утверждение.<p><ul><p><li>Если игрок просто поменял нолик на крестик, не воспользовавшись дополнительным ходом &mdash; то это можно понимать как то, что он просто забрал всю кучку, соответствующую этому нолику. Иными словами, если игрок поменял нолик на крестик в позиции <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x"> <img class=tex src="../tex2png/cache/03bf9775185240209aeb7057210aeed7.png" alt="(1 \le x \le n)">, то тем самым он взял кучку размера <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x"> и сделал её размер равным нулю.<p><li>Если игрок воспользовался дополнительным ходом, т.е. помимо того, что поменял нолик в позиции <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x"> на крестик, он ещё изменил клетку в позиции <img class=tex src="../tex2png/cache/e1fbf2db960f0155bd590871a486e78c.png" alt="y"> <img class=tex src="../tex2png/cache/e622f696880c8a6bdcdfaf8f024f13d0.png" alt="(y < x)">, то можно считать, что он уменьшил кучку <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x"> до размера <img class=tex src="../tex2png/cache/e1fbf2db960f0155bd590871a486e78c.png" alt="y">. Действительно, если в позиции <img class=tex src="../tex2png/cache/e1fbf2db960f0155bd590871a486e78c.png" alt="y"> раньше был крестик &mdash; то, в самом деле, после хода игрока там станет нолик, т.е. появится кучка размера <img class=tex src="../tex2png/cache/e1fbf2db960f0155bd590871a486e78c.png" alt="y">. А если в позиции <img class=tex src="../tex2png/cache/e1fbf2db960f0155bd590871a486e78c.png" alt="y"> раньше был нолик, то после хода игрока эта кучка исчезает &mdash; или, что то же самое, появилась вторая кучка точно такого же размера <img class=tex src="../tex2png/cache/e1fbf2db960f0155bd590871a486e78c.png" alt="y"> (поскольку в ниме две кучки одинаковых размеров фактически "уничтожают" друг друга).<p></ul><p>Таким образом, ответ на задачу &mdash; это XOR-сумма чисел &mdash; координат все ноликов в 1-индексации.<p><b>Решение "twins"</b>. Все рассуждения, приведённые выше, остаются верны, за исключением того, что хода "обнулить кучку" теперь у игрока нет. Т.е. если мы от всех координат отнимем единицу &mdash; то снова игра превратится в обычный ним.<p>Таким образом, ответ на задачу &mdash; это XOR-сумма чисел &mdash; координат все ноликов в 0-индексации.<p><p><h3 style="padding-top:15px;"> Northcott's game </h3><p><b>Условие</b>. Есть доска размера <img class=tex src="../tex2png/cache/ed0e13f7024ff254a4fccd689fe21ad3.png" alt="n \times m">: <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> строк и <img class=tex src="../tex2png/cache/4f70748eaed5e0c2c70d7e899166ee1d.png" alt="m"> столбцов. В каждой строке стоят по две фишки: одна чёрная и одна белая. За один ход игрок может взять любую фишку своего цвета и подвинуть её внутри строки вправо или влево на произвольное число шагов, но не перепрыгивая через другую фишку (и не вставая на неё). Проигрывает тот, кто не может сделать хода.<p><b>Решение</b>. Во-первых, понятно, что каждая из <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> строк доски образует независимую игру. Поэтому задача сводится к анализу игры в одной строке, а ответом на задачу будет XOR-сумма значений Шпрага-Гранди для каждой из строк.<p>Решая задачу для одной строки, обозначим через <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x"> расстояние между чёрной и белой фишкой (которое может меняться от нуля до <img class=tex src="../tex2png/cache/580399e364587d98f54204f102dc1f20.png" alt="m-2">). За один ход каждый игрок может либо уменьшить <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x"> на некоторое произвольное значение, либо, возможно, увеличить его до некоторого значения (увеличения доступны не всегда). Таким образом, эта игра &mdash; это <b>"ним с увеличениями"</b>, и, как мы уже знаем, увеличения в этой игре бесполезны. Следовательно, функция Гранди для одной строки &mdash; это и есть это расстояние <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x">.<p>(Следует заметить, что формально такое рассуждение неполно &mdash; т.к. в "ниме с увеличениями" предполагается, что игра <b>конечна</b>, а здесь правила игры позволяют игрокам играть бесконечно долго. Впрочем, бесконечная игра не может иметь места при оптимальной игре &mdash; т.к. стоит одному игроку увеличить расстояние <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x"> (ценой приближения к границе поля), как другой игрок приблизится к нему, уменьшив <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x"> обратно. Следовательно, при оптимальной игре противника игроку не удастся совершать увеличивающие ходы бесконечно долго, поэтому всё же описанное решение задачи остаётся в силе.)<p><p><h3 style="padding-top:15px;"> Триомино </h3><p><b>Условие</b>. Дано клетчатое поле размера <img class=tex src="../tex2png/cache/3f61ef398e2d9c30c2a1b5e5c16bba52.png" alt="2 \times n">. За один ход игрок может поставить на поле одну фигурку в форме буквы "Г" (т.е. связную фигуру из трёх клеток, не лежащих на одной прямой). Запрещено ставить фигурку так, чтобы она пересеклась хотя бы одной клеткой с какой-то из уже поставленных фигурок. Проигрывает тот, кто не может сделать ход.<p><b>Решение</b>. Заметим, что постановка одной фигурки разбивает всё поле на два независимых поля. Таким образом, нам надо анализировать не только прямоугольные поля, но и поля, у которых левая и/или правая границы неровные.<p>Нарисовав различные конфигурации, можно понять, что какой бы ни была конфигурация поля, главное &mdash; лишь то, сколько на этом поле клеток. На самом деле, если в текущем поле <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x"> свободных клеток, и мы хотим разбить это поле на два поля размером <img class=tex src="../tex2png/cache/e1fbf2db960f0155bd590871a486e78c.png" alt="y"> и <img class=tex src="../tex2png/cache/bb3cdafd77b2b4bf060c2c08de238c72.png" alt="z"> (где <img class=tex src="../tex2png/cache/596a3555d851db2d976857a50e2f7ad1.png" alt="y+z+3 = x">), то это всегда можно сделать, т.е. всегда можно найти соответствующее место для фигурки.<p>Таким образом, наша задача превращается в такую: изначально у нас есть кучка камней размера <img class=tex src="../tex2png/cache/02f3339bd527ea60f4b8a5fcb94023f1.png" alt="2n">, и за один ход мы можем выкинуть из некоторой кучки <img class=tex src="../tex2png/cache/0e96f2a3dff7da2f31d78c5306207a14.png" alt="3"> камня и затем разбить эту кучку на две кучки произвольных размеров. Функция Гранди для такой игры имеет вид:<p><p class=formula><img class=tex src="../tex2png/cache/77193b8694e60457a0455564f2d7eab7.png" alt=" g[n] = {\rm mex} \Bigg\{ \bigcup_{i=0}^{n-3} \Big[...]"><p></p><p><h3 style="padding-top:15px;"> Фишки на графе </h3><p><b>Условие</b>. Дан ориентированный ациклический граф. В некоторых вершинах графа стоят фишки. За один ход игрок может взять какую-то фишку и передвинуть её вдоль какого-либо ребра в новую вершину. Проигрывает тот, кто не может сделать ход.<p>Также бывает и второй вариант этой задачи: когда считается, что если две фишки приходят в одну вершину, то они обе взаимно уничтожают друг друга.<p><b>Решение первого варианта задачи</b>. Во-первых, все фишки &mdash; независимы друг от друга, поэтому наша задача &mdash; научиться искать функцию Гранди для одной фишки в графе.<p>Учитывая, что граф ацикличен, мы можем делать это рекурсивно: предположим, что мы посчитали функцию Гранди для всех потомков текущей вершины. Тогда функция Гранди в текущей вершине &mdash; это <img class=tex src="../tex2png/cache/790b9e558ae5ec4f1751bf65279bc125.png" alt="\rm mex"> от этого множества чисел.<p>Таким образом, решением задачи является следующее: для каждой вершины рекурсивно посчитать функцию Гранди, если бы фишка стояла именно в этой вершине. После этого ответом на задачу будет XOR-сумма значений Гранди от тех вершин графа, в которых по условию стоят фишки.<p><b>Решение второго варианта задачи</b>. На самом деле, второй вариант задачи ничем не отличается от первого. В самом деле, если две фишки стоят в одной и той же вершине графа, то в результирующей XOR-сумме их значения Гранди взаимно уничтожают друг друга. Следовательно, фактически это одна и та же задача.<p><p><h2 style="padding-top:40px;"> Реализация </h2><p>С позиции реализации интерес может представлять реализация функции <img class=tex src="../tex2png/cache/790b9e558ae5ec4f1751bf65279bc125.png" alt="\rm mex">.<p>Если это не является узким местом в программе, то можно написать какой-нибудь простой вариант за <img class=tex src="../tex2png/cache/cffe84ba82cc9c551d3f83db0bf960b9.png" alt="O (c \log c)"> (где <img class=tex src="../tex2png/cache/fdabaa70e1c423d289836bd4624e9e4e.png" alt="c"> &mdash; количество аргументов):<p><pre class="notranslate cpp"><span class="kw4">int</span> mex<span class="br0">&#40;</span>vector<span class="sy1">&lt;</span><span class="kw4">int</span><span class="sy1">&gt;</span> a<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	set<span class="sy1">&lt;</span><span class="kw4">int</span><span class="sy1">&gt;</span> b<span class="br0">&#40;</span>a.<span class="me1">begin</span><span class="br0">&#40;</span><span class="br0">&#41;</span>, a.<span class="me1">end</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> <span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy3">!</span>b.<span class="me1">count</span><span class="br0">&#40;</span>i<span class="br0">&#41;</span><span class="br0">&#41;</span>
			<span class="kw1">return</span> i<span class="sy4">;</span>
<span class="br0">&#125;</span></pre><p>Впрочем, не так уж и сложным является вариант <b>за линейное время</b>, т.е. за <img class=tex src="../tex2png/cache/ca86fc7fc8b4bc4b7373d65c023e7484.png" alt="O (c)">, где <img class=tex src="../tex2png/cache/fdabaa70e1c423d289836bd4624e9e4e.png" alt="c"> &mdash; число аргументов функции <img class=tex src="../tex2png/cache/790b9e558ae5ec4f1751bf65279bc125.png" alt="\rm mex">. Обозначим через <img class=tex src="../tex2png/cache/eb1a191fcb4a60d0abd8341d6d13e0e6.png" alt="D"> константу, равную максимально возможному значению <img class=tex src="../tex2png/cache/fdabaa70e1c423d289836bd4624e9e4e.png" alt="c"> (т.е. максимальной степени вершины в графе игры). В таком случае результат функции <img class=tex src="../tex2png/cache/790b9e558ae5ec4f1751bf65279bc125.png" alt="\rm mex"> не будет превосходить <img class=tex src="../tex2png/cache/eb1a191fcb4a60d0abd8341d6d13e0e6.png" alt="D">.<p>Следовательно, при реализации достаточно завести массив размера <img class=tex src="../tex2png/cache/5f8eba713328163279af777b2279db8c.png" alt="D+1"> (массив глобальный, или статический &mdash; главное, чтобы он не создавался при каждом вызове функции). При вызове функции <img class=tex src="../tex2png/cache/790b9e558ae5ec4f1751bf65279bc125.png" alt="\rm mex"> мы сначала отметим в этом массиве все <img class=tex src="../tex2png/cache/fdabaa70e1c423d289836bd4624e9e4e.png" alt="c"> аргументов (пропустив те из них, которые больше <img class=tex src="../tex2png/cache/eb1a191fcb4a60d0abd8341d6d13e0e6.png" alt="D"> &mdash; такие значения, очевидно, не влияют на результат). Затем проходом по этому массиву мы за <img class=tex src="../tex2png/cache/ca86fc7fc8b4bc4b7373d65c023e7484.png" alt="O (c)"> найдём первый неотмеченный элемент. Наконец, в конце можно снова пройтись по всем переданным аргументам и обнулить обратно массив для них. Тем самым, мы выполним все действия за <img class=tex src="../tex2png/cache/ca86fc7fc8b4bc4b7373d65c023e7484.png" alt="O (c)">, что на практике может оказаться существенно меньше максимальной степени <img class=tex src="../tex2png/cache/eb1a191fcb4a60d0abd8341d6d13e0e6.png" alt="D">.<p><pre class="notranslate cpp"><span class="kw4">int</span> mex <span class="br0">&#40;</span><span class="kw4">const</span> vector<span class="sy1">&lt;</span><span class="kw4">int</span><span class="sy1">&gt;</span> <span class="sy3">&amp;</span> a<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw4">static</span> <span class="kw4">bool</span> used<span class="br0">&#91;</span>D<span class="sy2">+</span><span class="nu0">1</span><span class="br0">&#93;</span> <span class="sy1">=</span> <span class="br0">&#123;</span> <span class="nu0">0</span> <span class="br0">&#125;</span><span class="sy4">;</span>
	<span class="kw4">int</span> c <span class="sy1">=</span> <span class="br0">&#40;</span><span class="kw4">int</span><span class="br0">&#41;</span> a.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp;
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>c<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>a<span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy1">&lt;=</span> D<span class="br0">&#41;</span>
			used<span class="br0">&#91;</span>a<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#93;</span> <span class="sy1">=</span> <span class="kw2">true</span><span class="sy4">;</span>
&nbsp;
	<span class="kw4">int</span> result<span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> <span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy3">!</span>used<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			result <span class="sy1">=</span> i<span class="sy4">;</span>
			 <span class="nu0">2</span> <span class="kw1">break</span><span class="sy4">;</span>
		<span class="br0">&#125;</span>
&nbsp;
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span>  <span class="nu0">1</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>c<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>a<span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy1">&lt;=</span> D<span class="br0">&#41;</span>
			used<span class="br0">&#91;</span>a<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#93;</span> <span class="sy1">=</span> <span class="kw2">false</span><span class="sy4">;</span>
&nbsp;
	<span class="kw1">return</span> result<span class="sy4">;</span>
<span class="br0">&#125;</span></pre><p>Другой вариант &mdash; воспользоваться техникой <b>"числового used"</b>. Т.е. сделать <img class=tex src="../tex2png/cache/4ecdf68925044e45b2fd890bdbbe9ef5.png" alt="\rm used"> массивом не булевских переменных, а чисел ("версий"), и завести глобальную переменную, обозначающую номер текущей версии. При входе в функцию <img class=tex src="../tex2png/cache/790b9e558ae5ec4f1751bf65279bc125.png" alt="\rm mex"> мы увеличиваем номер текущей версии, в первом цикле мы проставляем в массиве <img class=tex src="../tex2png/cache/4ecdf68925044e45b2fd890bdbbe9ef5.png" alt="\rm used"> не <img class=tex src="../tex2png/cache/d04c5eb60a53293d4878d3c73c349aa6.png" alt="\rm true">, а номер текущей версии. Наконец, во втором цикле мы просто сравниваем <img class=tex src="../tex2png/cache/397e9e9e8ac7e6f8ca2f4692cacb1ce0.png" alt="{\rm used}[i]"> с номером текущей версии &mdash; если они не совпали, то это означает, что текущее число не встречалось в массиве <img class=tex src="../tex2png/cache/e4c9b6bf3a65f2e487e7cb3e199f2154.png" alt="a">. Третий цикл (который ранее занулял массив <img class=tex src="../tex2png/cache/4ecdf68925044e45b2fd890bdbbe9ef5.png" alt="\rm used">) в таком решении не нужен.<p><p><h2 style="padding-top:40px;"> Обобщение нима: ним Мура (<img class=tex src="../tex2png/cache/336a051837a2ed662422914225a362d0.png" alt="k">-ним) </h2><p>Одно из интересных обобщений обычного нима было дано Муром (Moore) в 1910 г.<p><b>Условие</b>. Есть <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> кучек камней размера <img class=tex src="../tex2png/cache/ef875bf5bad8370d4f3bbe3c740d3dd3.png" alt="a_i">. Также задано натуральное число <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k">. За один ход игрок может уменьшить размеры от одной до <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> кучек (т.е. теперь разрешаются одновременные ходы в нескольких кучках сразу). Проигрывает тот, кто не может сделать хода.<p>Очевидно, при <img class=tex src="../tex2png/cache/c52bf046f58b7dd5434e50c9358055d3.png" alt="k=1"> ним Мура превращается в обычный ним.<p><b>Решение</b>. Решение такой задачи удивительно просто. Запишем размеры каждой кучки в двоичной системе счисления. Затем просуммируем эти числа в <img class=tex src="../tex2png/cache/b7e1992873e6c485f926be57173a6d22.png" alt="k+1">-ичной системе счисления без переносов разрядов. Если получилось число ноль, то текущая позиция проигрышная, иначе &mdash; выигрышная (и из неё есть ход в позицию с нулевой величиной).<p>Иными словами, для каждого бита мы смотрим, стоит этот бит или нет в двоичном представлении каждого числа <img class=tex src="../tex2png/cache/ef875bf5bad8370d4f3bbe3c740d3dd3.png" alt="a_i">. Затем мы суммируем получившиеся нули/единицы, и сумму берём по модулю <img class=tex src="../tex2png/cache/b7e1992873e6c485f926be57173a6d22.png" alt="k+1">. Если в итоге эта сумма для каждого бита получилась нулевой, то текущая позиция &mdash; проигрышная, иначе &mdash; выигрышная.<p><b>Доказательство</b>. Как и для нима, доказательство заключается в описании стратегии игроков: с одной стороны, мы показываем, что из игры с нулевым значением мы можем перейти только в игру с ненулевым значением, а с другой стороны &mdash; что из игры с ненулевым значением есть ход в игру с нулевым значением.<p>Во-первых, покажем, что из игры с нулевым значением можно перейти только в игру с ненулевым значением. Это вполне понятно: если сумма по модулю <img class=tex src="../tex2png/cache/b7e1992873e6c485f926be57173a6d22.png" alt="k+1"> была равна нулю, то после изменения от одного до <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> бит мы не могли получить снова нулевую сумму.<p>Во-вторых, покажем, как из игры с ненулевой суммы перейти в игру с нулевой суммой. Будем перебирать биты, в которых сумма получилась ненулевой, в порядке от старшего к младшему.<p>Обозначим через <img class=tex src="../tex2png/cache/6d55e3b56ba7b5ce8ff4c00cb6fed744.png" alt="u"> количество кучек, которые мы уже начали изменять; изначально <img class=tex src="../tex2png/cache/f3de840b1c54dad010006274cf1ca699.png" alt="u = 0">. Обратим внимание, что в этих <img class=tex src="../tex2png/cache/6d55e3b56ba7b5ce8ff4c00cb6fed744.png" alt="u"> кучках мы уже можем ставить любые биты по нашему желанию (поскольку у любой кучки, которая попадала в число этих <img class=tex src="../tex2png/cache/6d55e3b56ba7b5ce8ff4c00cb6fed744.png" alt="u"> кучек, уже уменьшился один из предыдущих, более старших, битов).<p>Итак, пусть мы рассматриваем текущий бит, в котором сумма по модулю <img class=tex src="../tex2png/cache/b7e1992873e6c485f926be57173a6d22.png" alt="k+1"> получилась ненулевой. Обозначим через <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s"> эту сумму, но в которой не учитываются те <img class=tex src="../tex2png/cache/6d55e3b56ba7b5ce8ff4c00cb6fed744.png" alt="u"> кучек, которые мы уже начали изменять. Обозначим через <img class=tex src="../tex2png/cache/733a381de525580104aa275afe299ec1.png" alt="q"> сумму, которую можно получить, поставив в эти <img class=tex src="../tex2png/cache/6d55e3b56ba7b5ce8ff4c00cb6fed744.png" alt="u"> кучек текущий бит равным единице:<p><p class=formula><img class=tex src="../tex2png/cache/210d3fa6016d959c6fbc25739eb1b859.png" alt=" q = (s + u) \pmod{(k+1)} "></p><p>У нас есть два варианта:<p><ul><p><li>Если <img class=tex src="../tex2png/cache/d976be2994cb51f105aab7a6cb03c24f.png" alt="q \le u">.<p>Тогда мы можем обойтись только лишь уже выбранными <img class=tex src="../tex2png/cache/6d55e3b56ba7b5ce8ff4c00cb6fed744.png" alt="u"> кучками: достаточно в <img class=tex src="../tex2png/cache/1ca8a27e4c60ffd2d31586d87c169c7f.png" alt="k+1-s = u-q"> из них поставить текущий бит равным единице, а во всех остальных &mdash; равным нулю.<p><li>Если <img class=tex src="../tex2png/cache/1d242353ef451134ea6772d073c47bef.png" alt="q > u">.<p>В таком случае мы, наоборот, поставим в уже выбранных <img class=tex src="../tex2png/cache/6d55e3b56ba7b5ce8ff4c00cb6fed744.png" alt="u"> кучках текущий бит равным нулю. Тогда сумма в текущем бите будет равна <img class=tex src="../tex2png/cache/c0b049033d91bddbebba7d5abe239dd9.png" alt="s > 0">, а, значит, среди невыбранных <img class=tex src="../tex2png/cache/a789f240df7832605a343c2ff1b08550.png" alt="n-u"> кучек в текущем бите есть как минимум <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s"> единиц. Выберем какие-нибудь <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s"> кучек среди них, и уменьшим в них текущий бит с единицы до нуля.<p>В результате число <img class=tex src="../tex2png/cache/6d55e3b56ba7b5ce8ff4c00cb6fed744.png" alt="u"> изменяемых кучек увеличится на <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s">, и составит <img class=tex src="../tex2png/cache/789ae74af1adb26d358428277686f9f8.png" alt="q \le k">.<p></ul><p>Таким образом, мы показали, каким образом выбирать множество изменяемых кучек и какие биты следует в них изменять, чтобы общее их количество <img class=tex src="../tex2png/cache/6d55e3b56ba7b5ce8ff4c00cb6fed744.png" alt="u"> никогда не превысило <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k">.<p>Следовательно, мы доказали, что искомый переход из состояния с ненулевой суммой в состояние с нулевой суммой существует, что и требовалось доказать.<p><p><h2 style="padding-top:40px;"> "Ним в поддавки" </h2><p>Тот ним, который мы рассматривали во всей данной статье &mdash; называется также "нормальным нимом" ("normal nim"). В противоположность ему, существует также <b>"ним в поддавки"</b> ("mis&#232;re nim") &mdash; когда игрок, совершивший последний ход, проигрывает (а не выигрывает).<p>(кстати говоря, по всей видимости, ним как настольная игра &mdash; более популярен именно в версии "в поддавки", а не в "нормальной" версии)<p><b>Решение</b> такого нима удивительно просто: будем действовать так же, как и в обычном ниме (т.е. посчитаем XOR-сумму всех размеров кучек, и если она равна нулю, то мы проиграем при любой стратегии, а иначе &mdash; выиграем, найдя переход в позицию с нулевым значением Шпрага-Гранди). Но есть одно <b>исключение</b>: если размеры всех кучек равны единице, то выигрышность/проигрышность меняются местами по сравнению с обычным нимом.<p>Таким образом, выигрышность/проигрышность нима "в поддавки" определяются по числу:<p><p class=formula><img class=tex src="../tex2png/cache/89929310c3bcb2933676a01f435d499e.png" alt=" a_1 \oplus a_2 \oplus \ldots \oplus a_n \oplus z,[...]"></p><p>где через <img class=tex src="../tex2png/cache/bb3cdafd77b2b4bf060c2c08de238c72.png" alt="z"> обозначена булевская переменная, равная единице, если <img class=tex src="../tex2png/cache/61e36ee78d67baeaf002d89d8f9f1dc0.png" alt="a_1 = a_2 = \ldots = a_n = 1">.<p>С учётом этого исключения, <b>оптимальная стратегия</b> для игрока в выигрышной позиции определяется следующим образом. Найдём ход, который игрок бы совершил, если бы он играл в нормальный ним. Теперь, если этот ход ведёт в позицию, в которой размеры всех кучек равны единице (и при этом до этого хода была кучка размера, большего единицы), то этот ход надо изменить: изменить так, чтобы количество остающихся непустых кучек изменило свою чётность.<p><b>Доказательство</b>. Обратим внимание, что вообще теория Шпрага-Гранди относится к "нормальным" играм, а не к играм в поддавки. Однако ним &mdash; одна из тех игр, для которых решение игры "в поддавки" не сильно отличается от решения "нормальной" игры. (Кстати говоря, решение нима "в поддавки" было дано тем же Чарлзом Бутоном, который описал решение "нормального" нима.)<p>Каким же образом можно объяснить столь странную закономерность &mdash; что выигрышность/проигрышность нима "в поддавки" совпадает с выигрышностью/проигрышностью "нормального" нима почти всегда?<p>Рассмотрим некоторое <b>течение игры</b>: т.е. выберем произвольную стартовую позицию и выпишем ходы игроков вплоть до завершения игры. Нетрудно понять, что при условии оптимальной игры соперников &mdash; игра завершится тем, что останется одна кучка размера <img class=tex src="../tex2png/cache/1737ac55fdbc871d8c7d14245b749ccd.png" alt="1">, и игрок будет вынужден пойти в ней и проиграть.<p>Следовательно, в любой игре двух оптимальных игроков рано или поздно наступает <b>момент</b>, когда размеры всех непустых кучек равны единице. Обозначим через <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> число непустых кучек в этот момент &mdash; тогда для текущего игрока эта позиция выигрышна тогда и только тогда, когда <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> чётно. Т.е. мы убедились в том, что в этих случаях выигрышность/проигрышность нима "в поддавки" <b>противоположна</b> "нормальному" ниму.<p>Снова вернёмся к тому моменту, когда впервые в игре все кучки стали размера <img class=tex src="../tex2png/cache/1737ac55fdbc871d8c7d14245b749ccd.png" alt="1">, и откатимся на один ход назад &mdash; прямо перед тем, как эта ситуация получилась. Мы оказались в ситуации, что одна кучка имеет размер <img class=tex src="../tex2png/cache/894689de87ad6448617fbc97af1c1a85.png" alt=">1">, а все остальные кучки (возможно, их было ноль штук) &mdash; размера <img class=tex src="../tex2png/cache/1737ac55fdbc871d8c7d14245b749ccd.png" alt="1">. Эта позиция очевидно выигрышна (т.к. мы в самом деле всегда можем сделать такой ход, чтобы осталось нечётное число кучек размера <img class=tex src="../tex2png/cache/1737ac55fdbc871d8c7d14245b749ccd.png" alt="1">, т.е. приведём соперника к поражению). С другой стороны, XOR-сумма размеров кучек в этот момент отлична от нуля &mdash; значит, здесь "нормальный" ним <b>совпадает</b> с нимом "в поддавки".<p>Далее, если продолжим откатываться по игре назад, то мы будем приходить в состояния, когда в игре было две кучки размера <img class=tex src="../tex2png/cache/894689de87ad6448617fbc97af1c1a85.png" alt=">1">, три кучки, и т.д. Для всех таких состояний выигрышность/проигрышность также будет совпадать с "нормальным" нимом &mdash; просто потому, что когда у нас есть более одной кучки размера <img class=tex src="../tex2png/cache/894689de87ad6448617fbc97af1c1a85.png" alt=">1">, то все переходы ведут в состояния с одной и более кучкой размера <img class=tex src="../tex2png/cache/894689de87ad6448617fbc97af1c1a85.png" alt=">1"> &mdash; а для всех них, как мы уже показали, ничего по сравнению с "нормальным" нимом <b>не изменилось</b>.<p>Таким образом, изменения в ниме "в поддавки" затрагивают только состояния, когда все кучки имеют размер, равный единице &mdash; что и требовалось доказать.<p><p><h2 style="padding-top:40px;"> Задачи в online judges </h2><p>Список задач в online judges, которые можно решать с помощью функции Гранди:<p><ul><p><li><a href="http://acm.timus.ru/problem.aspx?space=1&num=1465">TIMUS #1465 <b>"Игра в пешки"</b> &nbsp;&nbsp;&nbsp;&nbsp; [сложность: низкая]</a><p><li><a href="http://uva.onlinejudge.org/index.php?option=onlinejudge&page=show_problem&problem=2529">UVA #11534 <b>"Say Goodbye to Tic-Tac-Toe"</b> &nbsp;&nbsp;&nbsp;&nbsp; [сложность: средняя]</a><p><li><a href="http://acm.sgu.ru/problem.php?contest=0&problem=328">SGU #328 <b>"A Coloring Game"</b> &nbsp;&nbsp;&nbsp;&nbsp; [сложность: средняя]</a><p></ul><p><p><h2 style="padding-top:40px;"> Литература </h2><p><ul><p><li><a href="../bookz/files/conway.djvu">John Horton Conway. <b>On numbers and games</b> [1979]</a><li><a href="http://jourdan.ens.fr/~laffargue/teaching/Incertain/Problemes/lectnotes.pdf">Bernhard von Stengel. <b>Lecture Notes on Game Theory</b></a><p></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><hr><p>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'e-maxx';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script></td></tr></table></body></html>