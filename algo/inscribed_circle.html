<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><title>MAXimal :: algo :: Нахождение вписанной окружности в выпуклом многоугольнике методом сжатия сторон (shrinking sides) за O (N log N)</title><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><meta name="author" lang="ru" content="e-maxx" /><meta name="description" content="Алгоритмы, олимпиадное программирование, математика" /><meta name="keywords" content="алгоритмы программирование" /><meta name="google-site-verification" content="Pnjjj2XuxB0CTiqgDDvkp79bfSeDQ8Vw57iNeDJZkSc" /><link rel="stylesheet" type="text/css" href="../data/style.css"><script type="text/javascript" src="../data/jquery.js"></script><script type="text/javascript" src="../data/page-contents.js"></script><link rel="stylesheet" type="text/css" href="../geshi/geshi.css"><!--[if IE]><style>.menu a, .menu a:hover { width: 100%; }</style><![endif]--></head><body><table class=main cellpadding=0 cellspacing=0><tr><td class=title colspan=2><p>MAXimal</p></td></tr><tr><td class=menu><ul><li><a href="../index.php.html" >home</a></li><li><a href="index.html" class=current>algo</a></li><li><a href="../bookz/index.html" >bookz</a></li><li><a href="../forum/index.html" >forum</a></li><li><a href="../about.php.html" >about</a></li></ul></td><td class=content><p class=algoinfo>добавлено: 11 Jun 2008 10:34<br>редактировано: 28 Feb 2012 11:27</p><div id="contents-table"><p id="contents-table-title">Содержание <a href="inscribed_circle.html#" id="contents-hide">[скрыть]</a><a href="inscribed_circle.html#" id="contents-show" style="display:none">[показать]</a></p><div style="display:none"></div></div><h1> Нахождение вписанной окружности в выпуклом многоугольнике методом "сжатия сторон" ("shrinking sides") за <img class=tex src="../tex2png/cache/a11776a13135ae4d7d1007f97b9b95c4.png" alt="O (n \log n)"> </h1><p><p>Дан выпуклый многоугольник с <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> вершинами. Требуется найти вписанную в него окружность максимального радиуса: т.е. найти её радиус и координаты центра. (Если при данном радиусе возможны несколько вариантов центров, то достаточно найти любой из них.)<p>В отличие от описанного <a href="inscribed_circle_ternary.html">здесь</a> метода двойного тернарного поиска, асимптотика данного алгоритма &mdash; <img class=tex src="../tex2png/cache/65dae66ac82f684c5b24e464a8ca3610.png" alt="O (n \log n)"> &mdash; не зависит от ограничений на координаты и от требуемой точности, и поэтому этот алгоритм подходит при значительно больших <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> и больших ограничениях на величину координат.<p>Спасибо <b><a href="http://acm.uva.es/board/memberlist.php?mode=viewprofile&u=4424">Ивану Красильникову (mf)</b></a> за описание этого красивого алгоритма.<p><p><h2 style="padding-top:40px;"> Алгоритм </h2><p>Итак, дан выпуклый многоугольник. Начнём одновременно и с одинаковой скоростью <b>сдвигать</b> все его стороны параллельно самим себе внутрь многоугольника:<p><img src="inscribed_circle_shrinking.jpg"><p>Пусть, для удобства, это движение происходит со скоростью 1 координатная единица в секунду (т.е. время в каком-то смысле равно расстоянию: спустя единицу времени каждая точка преодолеет расстояние, равное единице).<p>В процессе этого движения стороны многоугольника будут постепенно исчезать (обращаться в точки). Рано или поздно весь многоугольник сожмётся в точку или отрезок, и этот момент времени <img class=tex src="../tex2png/cache/668c0ed766381807a81b9a534a4a70ce.png" alt="t"> будет являться <b>ответом на задачу</b> &mdash; искомым радиусом (а центр искомой окружности будет лежать на этом отрезке). В самом деле, если мы сжали многоугольник на толщину <img class=tex src="../tex2png/cache/668c0ed766381807a81b9a534a4a70ce.png" alt="t"> по всем направлениям, и он обратился в точку/отрезок, то это означает, что существует точка, отстоящая от всех сторон многоугольника на расстоянии <img class=tex src="../tex2png/cache/668c0ed766381807a81b9a534a4a70ce.png" alt="t">, а для бОльших расстояний &mdash; такой точки уже не существует.<p>Итак, нам надо научиться эффективно моделировать этот процесс сжатия. Для этого научимся для каждой стороны <b>определять время</b>, через которое она сожмётся в точку.<p>Для этого рассмотрим внимательно процесс движения сторон. Заметим, что вершины многоугольника всегда движутся по биссектрисам углов (это следует из равенства соответствующих треугольников). Но тогда вопрос о времени, через которое сторона сожмётся, сводится к вопросу об определении высоты <img class=tex src="../tex2png/cache/6bdb95cd9c9cf2e6e2c25ed807acfc09.png" alt="H"> треугольника, в котором известна длина стороны <img class=tex src="../tex2png/cache/88e54f90480ef3aeba329562335471f9.png" alt="L"> и два прилежащих к ней угла <img class=tex src="../tex2png/cache/1313ced986d9bce6ac81de89b88ac88a.png" alt="\alpha"> и <img class=tex src="../tex2png/cache/ae9d1b4855399fee90a2581ec62df847.png" alt="\beta">. Воспользовавшись, например, теоремой синусов, получаем формулу:<p><p class=formula><img class=tex src="../tex2png/cache/b4ada32a6a344986f4cdabd9a72dbb79.png" alt=" H = L \cdot \frac{ \sin \alpha \cdot \sin \beta }[...]"></p><p>Теперь мы умеем за <img class=tex src="../tex2png/cache/817532dd84d4eb666e5d80dc58098e94.png" alt="O(1)"> определять время, через которое сторона сожмётся в точку.<p>Занесём эти времена для каждой стороны в некую <b>структуру данных для извлечения минимума</b>, например, красно-чёрное дерево (<img class=tex src="../tex2png/cache/69ee37dcc56b08d150f58c59e467f874.png" alt="\rm set"> в языке C++).<p>Теперь если мы извлечём сторону с <b>наименьшим временем <img class=tex src="../tex2png/cache/6bdb95cd9c9cf2e6e2c25ed807acfc09.png" alt="H"></b>, то эта сторона первой сожмётся в точку &mdash; в момент времени <img class=tex src="../tex2png/cache/6bdb95cd9c9cf2e6e2c25ed807acfc09.png" alt="H">. Если многоугольник ещё не сжался в точку/отрезок, то эту сторону надо <b>удалить</b> из многоугольника, и продолжить алгоритм для оставшихся сторон. При удалении стороны мы должны <b>соединить</b> друг с другом её левого и правого соседа, <b>продлив</b> их до точки их пересечения. При этом необходимо будет найти эту точку пересечения, пересчитать длины двух сторон и их времена исчезновения.<p>При реализации для каждой стороны придётся хранить номер её правого и левого соседа (тем самым как бы построив двусвязный список из сторон многоугольника). Это позволяет реализовать удаление стороны и связывание двух её соседей за <img class=tex src="../tex2png/cache/817532dd84d4eb666e5d80dc58098e94.png" alt="O(1)">.<p>Если при удалении стороны оказывается, что её стороны-соседи <b>параллельны</b>, то это означает, что многоугольник после этого сжатия вырождается в точку/отрезок, поэтому мы можем сразу останавливать алгоритм и возвращать в качестве ответа время исчезнования текущей стороны (так что проблем с параллельными сторонами не возникает).<p>Если же такая ситуация с параллельными сторонами не возникает, то алгоритм доработает до момента, в который в многоугольнике останется только две стороны &mdash; и тогда ответом на задачу будет являться время удаления предыдущей стороны.<p>Очевидно, асимптотика этого алгоритма составляет <img class=tex src="../tex2png/cache/65dae66ac82f684c5b24e464a8ca3610.png" alt="O (n \log n)">, поскольку алгоритм состоит из <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> шагов, на каждом из которых удаляется по одной стороне (для чего производится несколько операций с <img class=tex src="../tex2png/cache/69ee37dcc56b08d150f58c59e467f874.png" alt="\rm set"> за время <img class=tex src="../tex2png/cache/65dae66ac82f684c5b24e464a8ca3610.png" alt="O (n \log n)">).<p><p><h2 style="padding-top:40px;"> Реализация </h2><p>Приведём реализацию описанного выше алгоритма. Данная реализация возвращает только радиус искомой окружности; впрочем, добавление вывода центра окружности не составит большого труда.<p>Данный алгоритм элегантен тем, что из вычислительной геометрии требуется только нахождение угла между двумя сторонами, пересечение двух прямых и проверка двух прямых на параллельность.<p>Примечание. Предполагается, что подаваемый на вход многоугольник &mdash; <b>строго выпуклый</b>, т.е. никакие три точки не лежат на одной прямой.<p><pre class="notranslate cpp"><span class="kw4">const</span> <span class="kw4">double</span> EPS <span class="sy1">=</span> <span class="nu19">1E-9</span><span class="sy4">;</span>
<span class="kw4">const</span> <span class="kw4">double</span> PI <span class="sy1">=</span> ...<span class="sy4">;</span>
&nbsp;
<span class="kw4">struct</span> pt <span class="br0">&#123;</span>
	<span class="kw4">double</span> x, y<span class="sy4">;</span>
	pt<span class="br0">&#40;</span><span class="br0">&#41;</span>  <span class="br0">&#123;</span> <span class="br0">&#125;</span>
	pt <span class="br0">&#40;</span><span class="kw4">double</span> x, <span class="kw4">double</span> y<span class="br0">&#41;</span> <span class="sy4">:</span> x<span class="br0">&#40;</span>x<span class="br0">&#41;</span>, y<span class="br0">&#40;</span>y<span class="br0">&#41;</span>  <span class="br0">&#123;</span> <span class="br0">&#125;</span>
	pt operator<span class="sy2">-</span> <span class="br0">&#40;</span><span class="kw4">const</span> pt <span class="sy3">&amp;</span> p<span class="br0">&#41;</span> <span class="kw4">const</span> <span class="br0">&#123;</span>
		<span class="kw1">return</span> pt <span class="br0">&#40;</span>x<span class="sy2">-</span>p.<span class="me1">x</span>, y<span class="sy2">-</span>p.<span class="me1">y</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">double</span> dist <span class="br0">&#40;</span><span class="kw4">const</span> pt <span class="sy3">&amp;</span> a, <span class="kw4">const</span> pt <span class="sy3">&amp;</span> b<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">return</span> <span class="kw3">sqrt</span> <span class="br0">&#40;</span><span class="br0">&#40;</span>a.<span class="me1">x</span><span class="sy2">-</span>b.<span class="me1">x</span><span class="br0">&#41;</span><span class="sy2">*</span><span class="br0">&#40;</span>a.<span class="me1">x</span><span class="sy2">-</span>b.<span class="me1">x</span><span class="br0">&#41;</span> <span class="sy2">+</span> <span class="br0">&#40;</span>a.<span class="me1">y</span><span class="sy2">-</span>b.<span class="me1">y</span><span class="br0">&#41;</span><span class="sy2">*</span><span class="br0">&#40;</span>a.<span class="me1">y</span><span class="sy2">-</span>b.<span class="me1">y</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">double</span> get_ang <span class="br0">&#40;</span><span class="kw4">const</span> pt <span class="sy3">&amp;</span> a, <span class="kw4">const</span> pt <span class="sy3">&amp;</span> b<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw4">double</span> ang <span class="sy1">=</span> <span class="kw3">abs</span> <span class="br0">&#40;</span><span class="kw3">atan2</span> <span class="br0">&#40;</span>a.<span class="me1">y</span>, a.<span class="me1">x</span><span class="br0">&#41;</span> <span class="sy2">-</span> <span class="kw3">atan2</span> <span class="br0">&#40;</span>b.<span class="me1">y</span>, b.<span class="me1">x</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">return</span> min <span class="br0">&#40;</span>ang, <span class="nu0">2</span><span class="sy2">*</span>PI<span class="sy2">-</span>ang<span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">struct</span> line <span class="br0">&#123;</span>
	<span class="kw4">double</span> a, b, c<span class="sy4">;</span>
	line <span class="br0">&#40;</span><span class="kw4">const</span> pt <span class="sy3">&amp;</span> p, <span class="kw4">const</span> pt <span class="sy3">&amp;</span> q<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		a <span class="sy1">=</span> p.<span class="me1">y</span> <span class="sy2">-</span> q.<span class="me1">y</span><span class="sy4">;</span>
		b <span class="sy1">=</span> q.<span class="me1">x</span> <span class="sy2">-</span> p.<span class="me1">x</span><span class="sy4">;</span>
		c <span class="sy1">=</span> <span class="sy2">-</span> a <span class="sy2">*</span> p.<span class="me1">x</span> <span class="sy2">-</span> b <span class="sy2">*</span> p.<span class="me1">y</span><span class="sy4">;</span>
		<span class="kw4">double</span> z <span class="sy1">=</span> <span class="kw3">sqrt</span> <span class="br0">&#40;</span>a<span class="sy2">*</span>a <span class="sy2">+</span> b<span class="sy2">*</span>b<span class="br0">&#41;</span><span class="sy4">;</span>
		a<span class="sy2">/</span><span class="sy1">=</span>z, b<span class="sy2">/</span><span class="sy1">=</span>z, c<span class="sy2">/</span><span class="sy1">=</span>z<span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">double</span> det <span class="br0">&#40;</span><span class="kw4">double</span> a, <span class="kw4">double</span> b, <span class="kw4">double</span> c, <span class="kw4">double</span> d<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">return</span> a <span class="sy2">*</span> d <span class="sy2">-</span> b <span class="sy2">*</span> c<span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
pt intersect <span class="br0">&#40;</span><span class="kw4">const</span> line <span class="sy3">&amp;</span> n, <span class="kw4">const</span> line <span class="sy3">&amp;</span> m<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw4">double</span> zn <span class="sy1">=</span> det <span class="br0">&#40;</span>n.<span class="me1">a</span>, n.<span class="me1">b</span>, m.<span class="me1">a</span>, m.<span class="me1">b</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">return</span> pt <span class="br0">&#40;</span>
		<span class="sy2">-</span> det <span class="br0">&#40;</span>n.<span class="me1">c</span>, n.<span class="me1">b</span>, m.<span class="me1">c</span>, m.<span class="me1">b</span><span class="br0">&#41;</span> <span class="sy2">/</span> zn,
		<span class="sy2">-</span> det <span class="br0">&#40;</span>n.<span class="me1">a</span>, n.<span class="me1">c</span>, m.<span class="me1">a</span>, m.<span class="me1">c</span><span class="br0">&#41;</span> <span class="sy2">/</span> zn
	<span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">bool</span> parallel <span class="br0">&#40;</span><span class="kw4">const</span> line <span class="sy3">&amp;</span> n, <span class="kw4">const</span> line <span class="sy3">&amp;</span> m<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">return</span> <span class="kw3">abs</span> <span class="br0">&#40;</span>det <span class="br0">&#40;</span>n.<span class="me1">a</span>, n.<span class="me1">b</span>, m.<span class="me1">a</span>, m.<span class="me1">b</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy1">&lt;</span> EPS<span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">double</span> get_h <span class="br0">&#40;</span><span class="kw4">const</span> pt <span class="sy3">&amp;</span> p1, <span class="kw4">const</span> pt <span class="sy3">&amp;</span> p2,
	<span class="kw4">const</span> pt <span class="sy3">&amp;</span> l1, <span class="kw4">const</span> pt <span class="sy3">&amp;</span> l2, <span class="kw4">const</span> pt <span class="sy3">&amp;</span> r1, <span class="kw4">const</span> pt <span class="sy3">&amp;</span> r2<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
	pt q1 <span class="sy1">=</span> intersect <span class="br0">&#40;</span>line <span class="br0">&#40;</span>p1, p2<span class="br0">&#41;</span>, line <span class="br0">&#40;</span>l1, l2<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	pt q2 <span class="sy1">=</span> intersect <span class="br0">&#40;</span>line <span class="br0">&#40;</span>p1, p2<span class="br0">&#41;</span>, line <span class="br0">&#40;</span>r1, r2<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw4">double</span> l <span class="sy1">=</span> dist <span class="br0">&#40;</span>q1, q2<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw4">double</span> alpha <span class="sy1">=</span> get_ang <span class="br0">&#40;</span>l2 <span class="sy2">-</span> l1, p2 <span class="sy2">-</span> p1<span class="br0">&#41;</span> <span class="sy2">/</span> <span class="nu0">2</span><span class="sy4">;</span>
	<span class="kw4">double</span> beta <span class="sy1">=</span> get_ang <span class="br0">&#40;</span>r2 <span class="sy2">-</span> r1, p1 <span class="sy2">-</span> p2<span class="br0">&#41;</span> <span class="sy2">/</span> <span class="nu0">2</span><span class="sy4">;</span>
	<span class="kw1">return</span> l <span class="sy2">*</span> <span class="kw3">sin</span><span class="br0">&#40;</span>alpha<span class="br0">&#41;</span> <span class="sy2">*</span> <span class="kw3">sin</span><span class="br0">&#40;</span>beta<span class="br0">&#41;</span> <span class="sy2">/</span> <span class="kw3">sin</span><span class="br0">&#40;</span>alpha<span class="sy2">+</span>beta<span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">struct</span> cmp <span class="br0">&#123;</span>
	<span class="kw4">bool</span> operator<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#40;</span><span class="kw4">const</span> pair<span class="sy1">&lt;</span><span class="kw4">double</span>,<span class="kw4">int</span><span class="sy1">&gt;</span> <span class="sy3">&amp;</span> a, <span class="kw4">const</span> pair<span class="sy1">&lt;</span><span class="kw4">double</span>,<span class="kw4">int</span><span class="sy1">&gt;</span> <span class="sy3">&amp;</span> b<span class="br0">&#41;</span> <span class="kw4">const</span> <span class="br0">&#123;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw3">abs</span> <span class="br0">&#40;</span>a.<span class="me1">first</span> <span class="sy2">-</span> b.<span class="me1">first</span><span class="br0">&#41;</span> <span class="sy1">&gt;</span> EPS<span class="br0">&#41;</span>
			<span class="kw1">return</span> a.<span class="me1">first</span> <span class="sy1">&lt;</span> b.<span class="me1">first</span><span class="sy4">;</span>
		<span class="kw1">return</span> a.<span class="me1">second</span> <span class="sy1">&lt;</span> b.<span class="me1">second</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw4">int</span> n<span class="sy4">;</span>
	vector<span class="sy1">&lt;</span>pt<span class="sy1">&gt;</span> p<span class="sy4">;</span>
	... чтение n и p ...
&nbsp;
	<span class="me1">vector</span><span class="sy1">&lt;</span><span class="kw4">int</span><span class="sy1">&gt;</span> next <span class="br0">&#40;</span>n<span class="br0">&#41;</span>, prev <span class="br0">&#40;</span>n<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>n<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		next<span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy1">=</span> <span class="br0">&#40;</span>i <span class="sy2">+</span> <span class="nu0">1</span><span class="br0">&#41;</span> <span class="sy2">%</span> n<span class="sy4">;</span>
		prev<span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy1">=</span> <span class="br0">&#40;</span>i <span class="sy2">-</span> <span class="nu0">1</span> <span class="sy2">+</span> n<span class="br0">&#41;</span> <span class="sy2">%</span> n<span class="sy4">;</span>
	<span class="br0">&#125;</span>
&nbsp;
	set <span class="sy1">&lt;</span> pair<span class="sy1">&lt;</span><span class="kw4">double</span>,<span class="kw4">int</span><span class="sy1">&gt;</span>, cmp <span class="sy1">&gt;</span> q<span class="sy4">;</span>
	vector<span class="sy1">&lt;</span><span class="kw4">double</span><span class="sy1">&gt;</span> h <span class="br0">&#40;</span>n<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>n<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		h<span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy1">=</span> get_h <span class="br0">&#40;</span>
			p<span class="br0">&#91;</span>i<span class="br0">&#93;</span>, p<span class="br0">&#91;</span>next<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#93;</span>,
			p<span class="br0">&#91;</span>i<span class="br0">&#93;</span>, p<span class="br0">&#91;</span>prev<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#93;</span>,
			p<span class="br0">&#91;</span>next<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#93;</span>, p<span class="br0">&#91;</span>next<span class="br0">&#91;</span>next<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#93;</span><span class="br0">&#93;</span>
		<span class="br0">&#41;</span><span class="sy4">;</span>
		q.<span class="me1">insert</span> <span class="br0">&#40;</span>make_pair <span class="br0">&#40;</span>h<span class="br0">&#91;</span>i<span class="br0">&#93;</span>, i<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="kw4">double</span> last_time<span class="sy4">;</span>
	<span class="kw1">while</span> <span class="br0">&#40;</span>q.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy1">&gt;</span> <span class="nu0">2</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
		last_time <span class="sy1">=</span> q.<span class="me1">begin</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy2">-</span><span class="sy1">&gt;</span>first<span class="sy4">;</span>
		<span class="kw4">int</span> i <span class="sy1">=</span> q.<span class="me1">begin</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy2">-</span><span class="sy1">&gt;</span>second<span class="sy4">;</span>
		q.<span class="me1">erase</span> <span class="br0">&#40;</span>q.<span class="me1">begin</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp;
		next<span class="br0">&#91;</span>prev<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#93;</span> <span class="sy1">=</span> next<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="sy4">;</span>
		prev<span class="br0">&#91;</span>next<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#93;</span> <span class="sy1">=</span> prev<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="sy4">;</span>
		<span class="kw4">int</span> nxt <span class="sy1">=</span> next<span class="br0">&#91;</span>i<span class="br0">&#93;</span>,   nxt1 <span class="sy1">=</span> <span class="br0">&#40;</span>nxt<span class="sy2">+</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy2">%</span>n,
			prv <span class="sy1">=</span> prev<span class="br0">&#91;</span>i<span class="br0">&#93;</span>,   prv1 <span class="sy1">=</span> <span class="br0">&#40;</span>prv<span class="sy2">+</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy2">%</span>n<span class="sy4">;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>parallel <span class="br0">&#40;</span>line <span class="br0">&#40;</span>p<span class="br0">&#91;</span>nxt<span class="br0">&#93;</span>, p<span class="br0">&#91;</span>nxt1<span class="br0">&#93;</span><span class="br0">&#41;</span>, line <span class="br0">&#40;</span>p<span class="br0">&#91;</span>prv<span class="br0">&#93;</span>, p<span class="br0">&#91;</span>prv1<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
			<span class="kw1">break</span><span class="sy4">;</span>
&nbsp;
		q.<span class="me1">erase</span> <span class="br0">&#40;</span>make_pair <span class="br0">&#40;</span>h<span class="br0">&#91;</span>nxt<span class="br0">&#93;</span>, nxt<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
		q.<span class="me1">erase</span> <span class="br0">&#40;</span>make_pair <span class="br0">&#40;</span>h<span class="br0">&#91;</span>prv<span class="br0">&#93;</span>, prv<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp;
		h<span class="br0">&#91;</span>nxt<span class="br0">&#93;</span> <span class="sy1">=</span> get_h <span class="br0">&#40;</span>
			p<span class="br0">&#91;</span>nxt<span class="br0">&#93;</span>, p<span class="br0">&#91;</span>nxt1<span class="br0">&#93;</span>,
			p<span class="br0">&#91;</span>prv1<span class="br0">&#93;</span>, p<span class="br0">&#91;</span>prv<span class="br0">&#93;</span>,
			p<span class="br0">&#91;</span>next<span class="br0">&#91;</span>nxt<span class="br0">&#93;</span><span class="br0">&#93;</span>, p<span class="br0">&#91;</span><span class="br0">&#40;</span>next<span class="br0">&#91;</span>nxt<span class="br0">&#93;</span><span class="sy2">+</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy2">%</span>n<span class="br0">&#93;</span>
		<span class="br0">&#41;</span><span class="sy4">;</span>
		h<span class="br0">&#91;</span>prv<span class="br0">&#93;</span> <span class="sy1">=</span> get_h <span class="br0">&#40;</span>
			p<span class="br0">&#91;</span>prv<span class="br0">&#93;</span>, p<span class="br0">&#91;</span>prv1<span class="br0">&#93;</span>,
			p<span class="br0">&#91;</span><span class="br0">&#40;</span>prev<span class="br0">&#91;</span>prv<span class="br0">&#93;</span><span class="sy2">+</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy2">%</span>n<span class="br0">&#93;</span>, p<span class="br0">&#91;</span>prev<span class="br0">&#91;</span>prv<span class="br0">&#93;</span><span class="br0">&#93;</span>,
			p<span class="br0">&#91;</span>nxt<span class="br0">&#93;</span>, p<span class="br0">&#91;</span>nxt1<span class="br0">&#93;</span>
		<span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp;
		q.<span class="me1">insert</span> <span class="br0">&#40;</span>make_pair <span class="br0">&#40;</span>h<span class="br0">&#91;</span>nxt<span class="br0">&#93;</span>, nxt<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
		q.<span class="me1">insert</span> <span class="br0">&#40;</span>make_pair <span class="br0">&#40;</span>h<span class="br0">&#91;</span>prv<span class="br0">&#93;</span>, prv<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="kw3">cout</span> <span class="sy1">&lt;&lt;</span> last_time <span class="sy1">&lt;&lt;</span> endl<span class="sy4">;</span>
<span class="br0">&#125;</span></pre><p>Основная функция здесь &mdash; это <img class=tex src="../tex2png/cache/51694a48f7a7b790e5df18e606494f78.png" alt="get\_h()">, которая по стороне и её левому и правому соседям вычисляет время исчезновения этой стороны. Для этого ищется точка пересечения этой стороны с соседями, и затем по приведённой выше формуле производится рассчёт искомого времени.<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><hr><p>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'e-maxx';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script></td></tr></table></body></html>