<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><title>MAXimal :: algo :: Поиск общих касательных к двум окружностям</title><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><meta name="author" lang="ru" content="e-maxx" /><meta name="description" content="Алгоритмы, олимпиадное программирование, математика" /><meta name="keywords" content="алгоритмы программирование" /><meta name="google-site-verification" content="Pnjjj2XuxB0CTiqgDDvkp79bfSeDQ8Vw57iNeDJZkSc" /><link rel="stylesheet" type="text/css" href="../data/style.css"><script type="text/javascript" src="../data/jquery.js"></script><script type="text/javascript" src="../data/page-contents.js"></script><link rel="stylesheet" type="text/css" href="../geshi/geshi.css"><!--[if IE]><style>.menu a, .menu a:hover { width: 100%; }</style><![endif]--></head><body><table class=main cellpadding=0 cellspacing=0><tr><td class=title colspan=2><p>MAXimal</p></td></tr><tr><td class=menu><ul><li><a href="../index.php.html" >home</a></li><li><a href="index.html" class=current>algo</a></li><li><a href="../bookz/index.html" >bookz</a></li><li><a href="../forum/index.html" >forum</a></li><li><a href="../about.php.html" >about</a></li></ul></td><td class=content><p class=algoinfo>добавлено: 15 Dec 2011 23:31<br>редактировано: 16 Dec 2011 0:20</p><div id="contents-table"><p id="contents-table-title">Содержание <a href="circle_tangents.html#" id="contents-hide">[скрыть]</a><a href="circle_tangents.html#" id="contents-show" style="display:none">[показать]</a></p><div style="display:none"></div></div><h1> Поиск общих касательных к двум окружностям </h1><p>Даны две окружности. Требуется найти все их общие касательные, т.е. все такие прямые, которые касаются обеих окружностей одновременно.<p>Описанный алгоритм будет работать также в случае, когда одна (или обе) окружности вырождаются в точки. Таким образом, этот алгоритм можно использовать также для нахождения касательных к окружности, проходящих через заданную точку.<p><p><h2 style="padding-top:40px;"> Количество общих касательных </h2><p>Сразу отметим, что мы не рассматриваем <b>вырожденные</b> случаи: когда окружности совпадают (в этом случае у них бесконечно много общих касательных), или одна окружность лежит внутри другой (в этом случае у них нет общих касательных, или, если окружности касаются, есть одна общая касательная).<p>В большинстве случаев, две окружности имеют <b>четыре</b> общих касательных.<p>Если окружности <b>касаются</b>, то у них будет три обших касательных, но это можно понимать как вырожденный случай: так, как будто две касательные совпали.<p>Более того, описанный ниже алгоритм будет работать и в случае, когда одна или обе окружности имеют нулевой радиус: в этом случае будет, соответственно, две или одна общая касательная.<p>Подводя итог, мы, за исключением описанных в начале случаев, всегда будем искать <b>четыре касательные</b>. В вырожденных случаях некоторые из них будут совпадать, однако тем не менее эти случаи также будут вписываться в общую картину.<p><p><h2 style="padding-top:40px;"> Алгоритм </h2><p>В целях простоты алгоритма, будем считать, не теряя общности, что центр первой окружности имеет координаты <img class=tex src="../tex2png/cache/76cbf8b53a406e4bc48f926d52ccee06.png" alt="(0;0)">. (Если это не так, то этого можно добиться простым сдвигом всей картины, а после нахождения решения &mdash; сдвигом полученных прямых обратно.)<p>Обозначим через <img class=tex src="../tex2png/cache/9b82d10f1951fedc8090fea9cee623bc.png" alt="r_1"> и <img class=tex src="../tex2png/cache/5a0746e655144644eb95b409a4f938d5.png" alt="r_2"> радиусы первой и второй окружностей, а через <img class=tex src="../tex2png/cache/9530057de1d317139fef00be858ff2f1.png" alt="v"> &mdash; координаты центра второй окружности (точка <img class=tex src="../tex2png/cache/9530057de1d317139fef00be858ff2f1.png" alt="v"> отлична от начала координат, т.к. мы не рассматриваем случае, когда окружности совпадают, или одна окружность находится внутри другой).<p>Для решения задачи подойдём к ней чисто <b>алгебраически</b>. Нам требуется найти все прямые вида <img class=tex src="../tex2png/cache/84e87b253b0aa6ee361ffe4970e3f257.png" alt="ax+by+c=0">, которые лежат на расстоянии <img class=tex src="../tex2png/cache/9b82d10f1951fedc8090fea9cee623bc.png" alt="r_1"> от начала координат, и на расстоянии <img class=tex src="../tex2png/cache/5a0746e655144644eb95b409a4f938d5.png" alt="r_2"> от точки <img class=tex src="../tex2png/cache/9530057de1d317139fef00be858ff2f1.png" alt="v">. Кроме того, наложим условие нормированности прямой: сумма квадратов коэффициентов <img class=tex src="../tex2png/cache/e4c9b6bf3a65f2e487e7cb3e199f2154.png" alt="a"> и <img class=tex src="../tex2png/cache/64e10b28938db2ba8a2b9fabb72a2cd9.png" alt="b"> должна быть равна единице (это необходимо, иначе одной и той же прямой будет соответствовать бесконечно много представлений вида <img class=tex src="../tex2png/cache/84e87b253b0aa6ee361ffe4970e3f257.png" alt="ax+by+c=0">). Итого получаем такую систему уравнений на искомые <img class=tex src="../tex2png/cache/2a1fe9194f0a58ef2fd83e776b28188f.png" alt="a,b,c">:<p><p class=formula><img class=tex src="../tex2png/cache/7b6e40faec1e1c4756a6d73c01595aa5.png" alt=" \begin{cases}
a^2 + b^2 = 1, \\
| a \cdot 0 + b[...]"></p><p>Чтобы избавиться от модулей, заметим, что всего есть четыре способа раскрыть модули в этой системе. Все эти способы можно рассмотреть общим случаем, если понимать раскрытие модуля как то, что коэффициент в правой части, возможно, умножается на <img class=tex src="../tex2png/cache/fc5f9135f75a6da19325dc3822484bbd.png" alt="-1">.<p>Иными словами, мы переходим к такой системе:<p><p class=formula><img class=tex src="../tex2png/cache/a9db587460abb6063fc777ad36052664.png" alt=" \begin{cases}
a^2 + b^2 = 1, \\
c = \pm r_1, \\[...]"></p><p>Введя обозначения <img class=tex src="../tex2png/cache/7e6b6c2d23d26b523e94589d35750ec4.png" alt="d_1 = \pm r_1"> и <img class=tex src="../tex2png/cache/6d30c97ebf15e91e7ac5da0c41fb90a4.png" alt="d_2 = \pm r_2">, мы приходим к тому, что четыре раза должны решать систему:<p><p class=formula><img class=tex src="../tex2png/cache/ab045cd38e2e774877384c0bd48adf09.png" alt=" \begin{cases}
a^2 + b^2 = 1, \\
c = d_1, \\
a [...]"></p><p>Решение этой системы сводится к решению квадратного уравнения. Мы опустим все громоздкие выкладки, и сразу приведём готовый ответ:<p><p class=formula><img class=tex src="../tex2png/cache/1d1f86d073e3245eb60eb11a355f43c9.png" alt=" \begin{cases}
a = \frac{ (d_2-d_1)v_x \pm v_y \s[...]"></p><p>Итого у нас получилось <img class=tex src="../tex2png/cache/fa6a7da1482cae770cdfc2108255c1b8.png" alt="8"> решений вместо <img class=tex src="../tex2png/cache/540ccd7efd169a4313503b565bb0ce55.png" alt="4">. Однако легко понять, в каком месте возникают лишние решения: на самом деле, в последней системе достаточно брать только одно решение (например, первое). В самом деле, геометрический смысл того, что мы берём <img class=tex src="../tex2png/cache/4c866fe3511286efca8209fc792bb820.png" alt="\pm r_1"> и <img class=tex src="../tex2png/cache/9408eeab772595ca900c9a24a5f7b37a.png" alt="\pm r_2">, понятен: мы фактически перебираем, по какую сторону от каждой из окружностей будет прямая. Поэтому два способа, возникающие при решении последней системы, избыточны: достаточно выбрать одно из двух решений (только, конечно, во всех четырёх случаях надо выбрать одно и то же семейство решений).<p>Последнее, что мы ещё не рассмотрели &mdash; это <b>как сдвигать прямые</b> в том случае, когда первая окружность не находилась изначально в начале координат. Однако здесь всё просто: из линейности уравнения прямой следует, что от коэффициента <img class=tex src="../tex2png/cache/fdabaa70e1c423d289836bd4624e9e4e.png" alt="c"> надо отнять величину <img class=tex src="../tex2png/cache/303e7fb855ff8baef85c522b01bf0422.png" alt="a \cdot x_0 + b \cdot y_0"> (где <img class=tex src="../tex2png/cache/469f2c65d8657af638ca2b52341a7edb.png" alt="x_0"> и <img class=tex src="../tex2png/cache/a6195bd4648f7e30c63de3740c75aa2c.png" alt="y_0"> &mdash; координаты первоначального центра первой окружности).<p><p><h2 style="padding-top:40px;"> Реализация </h2><p>Опишем сначала все необходимые структуры данных и другие вспомогательные определения:<p><pre class="notranslate cpp"><span class="kw4">struct</span> pt <span class="br0">&#123;</span>
	<span class="kw4">double</span> x, y<span class="sy4">;</span>
&nbsp;
	pt operator<span class="sy2">-</span> <span class="br0">&#40;</span>pt p<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		pt res <span class="sy1">=</span> <span class="br0">&#123;</span> x<span class="sy2">-</span>p.<span class="me1">x</span>, y<span class="sy2">-</span>p.<span class="me1">y</span> <span class="br0">&#125;</span><span class="sy4">;</span>
		<span class="kw1">return</span> res<span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">struct</span> circle <span class="sy4">:</span> pt <span class="br0">&#123;</span>
	<span class="kw4">double</span> r<span class="sy4">;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">struct</span> line <span class="br0">&#123;</span>
	<span class="kw4">double</span> a, b, c<span class="sy4">;</span>
<span class="br0">&#125;</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">const</span> <span class="kw4">double</span> EPS <span class="sy1">=</span> <span class="nu19">1E-9</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">double</span> sqr <span class="br0">&#40;</span><span class="kw4">double</span> a<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">return</span> a <span class="sy2">*</span> a<span class="sy4">;</span>
<span class="br0">&#125;</span></pre><p>Тогда само решение можно записать таким образом (где основная функция для вызова &mdash; вторая; а первая функция &mdash; вспомогательная):<p><pre class="notranslate cpp"><span class="kw4">void</span> tangents <span class="br0">&#40;</span>pt c, <span class="kw4">double</span> r1, <span class="kw4">double</span> r2, vector<span class="sy1">&lt;</span>line<span class="sy1">&gt;</span> <span class="sy3">&amp;</span> ans<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw4">double</span> r <span class="sy1">=</span> r2 <span class="sy2">-</span> r1<span class="sy4">;</span>
	<span class="kw4">double</span> z <span class="sy1">=</span> sqr<span class="br0">&#40;</span>c.<span class="me1">x</span><span class="br0">&#41;</span> <span class="sy2">+</span> sqr<span class="br0">&#40;</span>c.<span class="me1">y</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw4">double</span> d <span class="sy1">=</span> z <span class="sy2">-</span> sqr<span class="br0">&#40;</span>r<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>d <span class="sy1">&lt;</span> <span class="sy2">-</span>EPS<span class="br0">&#41;</span>  <span class="kw1">return</span><span class="sy4">;</span>
	d <span class="sy1">=</span> <span class="kw3">sqrt</span> <span class="br0">&#40;</span><span class="kw3">abs</span> <span class="br0">&#40;</span>d<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	line l<span class="sy4">;</span>
	l.<span class="me1">a</span> <span class="sy1">=</span> <span class="br0">&#40;</span>c.<span class="me1">x</span> <span class="sy2">*</span> r <span class="sy2">+</span> c.<span class="me1">y</span> <span class="sy2">*</span> d<span class="br0">&#41;</span> <span class="sy2">/</span> z<span class="sy4">;</span>
	l.<span class="me1">b</span> <span class="sy1">=</span> <span class="br0">&#40;</span>c.<span class="me1">y</span> <span class="sy2">*</span> r <span class="sy2">-</span> c.<span class="me1">x</span> <span class="sy2">*</span> d<span class="br0">&#41;</span> <span class="sy2">/</span> z<span class="sy4">;</span>
	l.<span class="me1">c</span> <span class="sy1">=</span> r1<span class="sy4">;</span>
	ans.<span class="me1">push_back</span> <span class="br0">&#40;</span>l<span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
vector<span class="sy1">&lt;</span>line<span class="sy1">&gt;</span> tangents <span class="br0">&#40;</span>circle a, circle b<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	vector<span class="sy1">&lt;</span>line<span class="sy1">&gt;</span> ans<span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i<span class="sy1">=</span><span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span> i<span class="sy1">&lt;=</span><span class="nu0">1</span><span class="sy4">;</span> i<span class="sy2">+</span><span class="sy1">=</span><span class="nu0">2</span><span class="br0">&#41;</span>
		<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> j<span class="sy1">=</span><span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span> j<span class="sy1">&lt;=</span><span class="nu0">1</span><span class="sy4">;</span> j<span class="sy2">+</span><span class="sy1">=</span><span class="nu0">2</span><span class="br0">&#41;</span>
			tangents <span class="br0">&#40;</span>b<span class="sy2">-</span>a, a.<span class="me1">r</span><span class="sy2">*</span>i, b.<span class="me1">r</span><span class="sy2">*</span>j, ans<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">size_t</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>ans.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span>
		ans<span class="br0">&#91;</span>i<span class="br0">&#93;</span>.<span class="me1">c</span> <span class="sy2">-</span><span class="sy1">=</span> ans<span class="br0">&#91;</span>i<span class="br0">&#93;</span>.<span class="me1">a</span> <span class="sy2">*</span> a.<span class="me1">x</span> <span class="sy2">+</span> ans<span class="br0">&#91;</span>i<span class="br0">&#93;</span>.<span class="me1">b</span> <span class="sy2">*</span> a.<span class="me1">y</span><span class="sy4">;</span>
	<span class="kw1">return</span> ans<span class="sy4">;</span>
<span class="br0">&#125;</span></pre><p><p><p><p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><hr><p>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'e-maxx';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script></td></tr></table></body></html>