<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><title>MAXimal :: algo :: Дискретное извлечение корня</title><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><meta name="author" lang="ru" content="e-maxx" /><meta name="description" content="Алгоритмы, олимпиадное программирование, математика" /><meta name="keywords" content="алгоритмы программирование" /><meta name="google-site-verification" content="Pnjjj2XuxB0CTiqgDDvkp79bfSeDQ8Vw57iNeDJZkSc" /><link rel="stylesheet" type="text/css" href="../data/style.css"><script type="text/javascript" src="../data/jquery.js"></script><script type="text/javascript" src="../data/page-contents.js"></script><link rel="stylesheet" type="text/css" href="../geshi/geshi.css"><!--[if IE]><style>.menu a, .menu a:hover { width: 100%; }</style><![endif]--></head><body><table class=main cellpadding=0 cellspacing=0><tr><td class=title colspan=2><p>MAXimal</p></td></tr><tr><td class=menu><ul><li><a href="../index.php.html" >home</a></li><li><a href="index.html" class=current>algo</a></li><li><a href="../bookz/index.html" >bookz</a></li><li><a href="../forum/index.html" >forum</a></li><li><a href="../about.php.html" >about</a></li></ul></td><td class=content><p class=algoinfo>добавлено: 16 Jan 2009 0:58<br>редактировано: 16 Jan 2009 10:04</p><div id="contents-table"><p id="contents-table-title">Содержание <a href="discrete_root.html#" id="contents-hide">[скрыть]</a><a href="discrete_root.html#" id="contents-show" style="display:none">[показать]</a></p><div style="display:none"></div></div><h1>Дискретное извлечение корня</h1><p>Задача дискретного извлечения корня (по аналогии с <a href="discrete_log.html">задачей дискретного логарифма</a>) звучит следующим образом. По данным <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> (<img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> &mdash; простое), <img class=tex src="../tex2png/cache/e4c9b6bf3a65f2e487e7cb3e199f2154.png" alt="a">, <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> требуется найти все <img class=tex src="../tex2png/cache/4a9252cee23f1a80a4e03256ef62d733.png" alt="x">, удовлетворяющие условию:<p class=formula><img class=tex src="../tex2png/cache/71ad35e12d1bc60d130e6c5dacf05e9d.png" alt=" x^k \equiv a \pmod{n} "></p><p><h2 style="padding-top:40px;">Алгоритм решения</h2><p>Решать задачу будем сведением её к задаче дискретного логарифма.<p>Для этого применим понятие <a href="primitive_root.html">Первообразного корня по модулю <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"></a>. Пусть <img class=tex src="../tex2png/cache/016b9521e1847132b61db0423dfff527.png" alt="g"> &mdash; первообразный корень по модулю <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> (т.к. <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> &mdash; простое, то он существует). Найти его мы можем, как описано в соответствующей статье, за <img class=tex src="../tex2png/cache/04c6fc8cb17a72096f347f95130f84cf.png" alt="O( {\rm Ans} \cdot \log \phi(n) \cdot \log n) = O( {\rm Ans} \cdot \log^2 n)"> плюс время факторизации числа <img class=tex src="../tex2png/cache/8ee5ca0943e68b4c996ccb40ca25ea2f.png" alt="\phi(n)">.<p>Отбросим сразу случай, когда <img class=tex src="../tex2png/cache/06151a871ce8bd90b208cb363db8bce7.png" alt="a=0"> &mdash; в этом случае сразу находим ответ <img class=tex src="../tex2png/cache/437d36e6951adaa42b6546bc87502a9c.png" alt="x=0">.<p>Поскольку в данном случае (<img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> &mdash; простое) любое число от <img class=tex src="../tex2png/cache/1737ac55fdbc871d8c7d14245b749ccd.png" alt="1"> до <img class=tex src="../tex2png/cache/0409310e642143903bd490e71e4a951e.png" alt="n-1"> представимо в виде степени первообразного корня, то задачу дискретного корня мы можем представить в виде:<p class=formula><img class=tex src="../tex2png/cache/08b0f00fd6cf8e218c722444f1c37093.png" alt=" {\left( g^y \right)}^k \equiv a \pmod{n} "></p>где<p class=formula><img class=tex src="../tex2png/cache/2d6c802909c1620bb088cd1bacc5f1f7.png" alt=" x \equiv g^y \pmod{n} "></p>Тривиальным преобразованием получаем:<p class=formula><img class=tex src="../tex2png/cache/87c8a7eab6ae3d97d368be46d388e4b7.png" alt=" {\left( g^k \right)}^y \equiv a \pmod{n} "></p>Здесь искомой величиной является <img class=tex src="../tex2png/cache/e1fbf2db960f0155bd590871a486e78c.png" alt="y">, таким образом, мы пришли к задаче дискретного логарифмирования в чистом виде. Эту задачу можно решить <a href="discrete_log.html">алгоритмом baby-step-giant-step Шэнкса</a> за <img class=tex src="../tex2png/cache/fd9197e613ef017534e85cff1b1849c8.png" alt="O( \sqrt{n} \log n )">, т.е. найти одно из решений <img class=tex src="../tex2png/cache/a6195bd4648f7e30c63de3740c75aa2c.png" alt="y_0"> этого уравнения (или обнаружить, что это уравнение решений не имеет).<p>Пусть мы нашли некоторое решение <img class=tex src="../tex2png/cache/a6195bd4648f7e30c63de3740c75aa2c.png" alt="y_0"> этого уравнения, тогда одним из решений задачи дискретного корня будет <img class=tex src="../tex2png/cache/38b274115469a29ce91648425dd2d598.png" alt="x_0 = g^{y_0} \pmod{n}">.<p><h2 style="padding-top:40px;">Нахождение всех решений, зная одно из них</h2><p>Чтобы полностью решить поставленную задачу, надо научиться по одному найденному <img class=tex src="../tex2png/cache/38b274115469a29ce91648425dd2d598.png" alt="x_0 = g^{y_0} \pmod{n}"> находить все остальные решения.<p>Для этого вспомним такой факт, что первообразный корень всегда имеет порядок <img class=tex src="../tex2png/cache/8ee5ca0943e68b4c996ccb40ca25ea2f.png" alt="\phi(n)"> (см. <a href="primitive_root.html">статью о первообразном корне</a>), т.е. наименьшей степенью <img class=tex src="../tex2png/cache/016b9521e1847132b61db0423dfff527.png" alt="g">, дающей единицу, является <img class=tex src="../tex2png/cache/8ee5ca0943e68b4c996ccb40ca25ea2f.png" alt="\phi(n)">. Поэтому добавление в показатель степени слагаемого с <img class=tex src="../tex2png/cache/8ee5ca0943e68b4c996ccb40ca25ea2f.png" alt="\phi(n)"> ничего не меняет:<p class=formula><img class=tex src="../tex2png/cache/dbe9ff36fb2ee7b94751e99fe7c53307.png" alt=" x^k \equiv g^{ y_0 \cdot k + l \cdot \phi(n) } \e[...]"></p>Отсюда все решения имеют вид:<p class=formula><img class=tex src="../tex2png/cache/d4b3fabc6731aa7039ea43c9814c4400.png" alt=" x = g^{ y_0 + \frac{ l \cdot \phi(n) }{ k } } \pm[...]"></p>где <img class=tex src="../tex2png/cache/c389ea8fa0131816bbcd01a1fbacec19.png" alt="l"> выбирается таким образом, чтобы дробь <img class=tex src="../tex2png/cache/2ec67bae1293d1642110595beebfc59a.png" alt="\frac{ l \cdot \phi(n) }{ k }"> была целой. Чтобы эта дробь была целой, числитель должен быть кратен наименьшему общему кратному <img class=tex src="../tex2png/cache/8ee5ca0943e68b4c996ccb40ca25ea2f.png" alt="\phi(n)"> и <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k">, откуда (вспоминая, что наименьшее общее кратное двух чисел <img class=tex src="../tex2png/cache/b0b77ea9970e9b441f409e625cbfd02a.png" alt="{\rm lcm}(a,b) = \frac{ a \cdot b }{ {\rm gcd}(a,b) }">), получаем:<p class=formula><img class=tex src="../tex2png/cache/d9ed0a8d59ab94ddf7b64792662a31da.png" alt=" x = g^{ y_0 + i \frac{ \phi(n) }{ {\rm gcd}(k,\ph[...]"></p>Это окончательная удобная формула, которая даёт общий вид всех решений задачи дискретного корня.<p><h2 style="padding-top:40px;">Реализация</h2><p>Приведём полную реализацию, включающую нахождение первообразного корня, дискретное логарифмирование и нахождение и вывод всех решений.<p><pre class="notranslate cpp"><span class="kw4">int</span> gcd <span class="br0">&#40;</span><span class="kw4">int</span> a, <span class="kw4">int</span> b<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw1">return</span> a <span class="sy4">?</span> gcd <span class="br0">&#40;</span>b<span class="sy2">%</span>a, a<span class="br0">&#41;</span> <span class="sy4">:</span> b<span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">int</span> powmod <span class="br0">&#40;</span><span class="kw4">int</span> a, <span class="kw4">int</span> b, <span class="kw4">int</span> p<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw4">int</span> res <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span>
	<span class="kw1">while</span> <span class="br0">&#40;</span>b<span class="br0">&#41;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>b <span class="sy3">&amp;</span> <span class="nu0">1</span><span class="br0">&#41;</span>
			res <span class="sy1">=</span> <span class="kw4">int</span> <span class="br0">&#40;</span>res <span class="sy2">*</span> 1ll <span class="sy2">*</span> a <span class="sy2">%</span> p<span class="br0">&#41;</span>,  <span class="sy2">--</span>b<span class="sy4">;</span>
		<span class="kw1">else</span>
			a <span class="sy1">=</span> <span class="kw4">int</span> <span class="br0">&#40;</span>a <span class="sy2">*</span> 1ll <span class="sy2">*</span> a <span class="sy2">%</span> p<span class="br0">&#41;</span>,  b <span class="sy1">&gt;&gt;=</span> <span class="nu0">1</span><span class="sy4">;</span>
	<span class="kw1">return</span> res<span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">int</span> generator <span class="br0">&#40;</span><span class="kw4">int</span> p<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	vector<span class="sy1">&lt;</span><span class="kw4">int</span><span class="sy1">&gt;</span> fact<span class="sy4">;</span>
	<span class="kw4">int</span> phi <span class="sy1">=</span> p<span class="sy2">-</span><span class="nu0">1</span>,  n <span class="sy1">=</span> phi<span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">2</span><span class="sy4">;</span> i<span class="sy2">*</span>i<span class="sy1">&lt;=</span>n<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>n <span class="sy2">%</span> i <span class="sy1">==</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			fact.<span class="me1">push_back</span> <span class="br0">&#40;</span>i<span class="br0">&#41;</span><span class="sy4">;</span>
			<span class="kw1">while</span> <span class="br0">&#40;</span>n <span class="sy2">%</span> i <span class="sy1">==</span> <span class="nu0">0</span><span class="br0">&#41;</span>
				n <span class="sy2">/</span><span class="sy1">=</span> i<span class="sy4">;</span>
		<span class="br0">&#125;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>n <span class="sy1">&gt;</span> <span class="nu0">1</span><span class="br0">&#41;</span>
		fact.<span class="me1">push_back</span> <span class="br0">&#40;</span>n<span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp;
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> res<span class="sy1">=</span><span class="nu0">2</span><span class="sy4">;</span> res<span class="sy1">&lt;=</span>p<span class="sy4">;</span> <span class="sy2">++</span>res<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw4">bool</span> ok <span class="sy1">=</span> <span class="kw2">true</span><span class="sy4">;</span>
		<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">size_t</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>fact.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy3">&amp;&amp;</span> ok<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span>
			ok <span class="sy3">&amp;</span><span class="sy1">=</span> powmod <span class="br0">&#40;</span>res, phi <span class="sy2">/</span> fact<span class="br0">&#91;</span>i<span class="br0">&#93;</span>, p<span class="br0">&#41;</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>ok<span class="br0">&#41;</span>  <span class="kw1">return</span> res<span class="sy4">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">return</span> <span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp;
	<span class="kw4">int</span> n, k, a<span class="sy4">;</span>
	<span class="kw3">cin</span> <span class="sy1">&gt;&gt;</span> n <span class="sy1">&gt;&gt;</span> k <span class="sy1">&gt;&gt;</span> a<span class="sy4">;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>a <span class="sy1">==</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw3">puts</span> <span class="br0">&#40;</span><span class="st0">&quot;1<span class="es1">\n</span>0&quot;</span><span class="br0">&#41;</span><span class="sy4">;</span>
		<span class="kw1">return</span> <span class="nu0">0</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="kw4">int</span> g <span class="sy1">=</span> generator <span class="br0">&#40;</span>n<span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp;
	<span class="kw4">int</span> sq <span class="sy1">=</span> <span class="br0">&#40;</span><span class="kw4">int</span><span class="br0">&#41;</span> <span class="kw3">sqrt</span> <span class="br0">&#40;</span>n <span class="sy2">+</span> <span class="nu18">.0</span><span class="br0">&#41;</span> <span class="sy2">+</span> <span class="nu0">1</span><span class="sy4">;</span>
	vector <span class="sy1">&lt;</span> pair<span class="sy1">&lt;</span><span class="kw4">int</span>,<span class="kw4">int</span><span class="sy1">&gt;</span> <span class="sy1">&gt;</span> dec <span class="br0">&#40;</span>sq<span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">1</span><span class="sy4">;</span> i<span class="sy1">&lt;=</span>sq<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span>
		dec<span class="br0">&#91;</span>i<span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#93;</span> <span class="sy1">=</span> make_pair <span class="br0">&#40;</span>powmod <span class="br0">&#40;</span>g, <span class="kw4">int</span> <span class="br0">&#40;</span>i <span class="sy2">*</span> sq <span class="sy2">*</span> 1ll <span class="sy2">*</span> k <span class="sy2">%</span> <span class="br0">&#40;</span>n <span class="sy2">-</span> <span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span>, n<span class="br0">&#41;</span>, i<span class="br0">&#41;</span><span class="sy4">;</span>
	sort <span class="br0">&#40;</span>dec.<span class="me1">begin</span><span class="br0">&#40;</span><span class="br0">&#41;</span>, dec.<span class="me1">end</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw4">int</span> any_ans <span class="sy1">=</span> <span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>sq<span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw4">int</span> my <span class="sy1">=</span> <span class="kw4">int</span> <span class="br0">&#40;</span>powmod <span class="br0">&#40;</span>g, <span class="kw4">int</span> <span class="br0">&#40;</span>i <span class="sy2">*</span> 1ll <span class="sy2">*</span> k <span class="sy2">%</span> <span class="br0">&#40;</span>n <span class="sy2">-</span> <span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span>, n<span class="br0">&#41;</span> <span class="sy2">*</span> 1ll <span class="sy2">*</span> a <span class="sy2">%</span> n<span class="br0">&#41;</span><span class="sy4">;</span>
		vector <span class="sy1">&lt;</span> pair<span class="sy1">&lt;</span><span class="kw4">int</span>,<span class="kw4">int</span><span class="sy1">&gt;</span> <span class="sy1">&gt;</span><span class="sy4">::</span><span class="me2">iterator</span> it <span class="sy1">=</span>
			lower_bound <span class="br0">&#40;</span>dec.<span class="me1">begin</span><span class="br0">&#40;</span><span class="br0">&#41;</span>, dec.<span class="me1">end</span><span class="br0">&#40;</span><span class="br0">&#41;</span>, make_pair <span class="br0">&#40;</span>my, <span class="nu0">0</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>it <span class="sy3">!</span><span class="sy1">=</span> dec.<span class="me1">end</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy3">&amp;&amp;</span> it<span class="sy2">-</span><span class="sy1">&gt;</span>first <span class="sy1">==</span> my<span class="br0">&#41;</span> <span class="br0">&#123;</span>
			any_ans <span class="sy1">=</span> it<span class="sy2">-</span><span class="sy1">&gt;</span>second <span class="sy2">*</span> sq <span class="sy2">-</span> i<span class="sy4">;</span>
			<span class="kw1">break</span><span class="sy4">;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span>any_ans <span class="sy1">==</span> <span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw3">puts</span> <span class="br0">&#40;</span><span class="st0">&quot;0&quot;</span><span class="br0">&#41;</span><span class="sy4">;</span>
		<span class="kw1">return</span> <span class="nu0">0</span><span class="sy4">;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="kw4">int</span> delta <span class="sy1">=</span> <span class="br0">&#40;</span>n<span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span> <span class="sy2">/</span> gcd <span class="br0">&#40;</span>k, n<span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy4">;</span>
	vector<span class="sy1">&lt;</span><span class="kw4">int</span><span class="sy1">&gt;</span> ans<span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> cur<span class="sy1">=</span>any_ans<span class="sy2">%</span>delta<span class="sy4">;</span> cur<span class="sy1">&lt;</span>n<span class="sy2">-</span><span class="nu0">1</span><span class="sy4">;</span> cur<span class="sy2">+</span><span class="sy1">=</span>delta<span class="br0">&#41;</span>
		ans.<span class="me1">push_back</span> <span class="br0">&#40;</span>powmod <span class="br0">&#40;</span>g, cur, n<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	sort <span class="br0">&#40;</span>ans.<span class="me1">begin</span><span class="br0">&#40;</span><span class="br0">&#41;</span>, ans.<span class="me1">end</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw3">printf</span> <span class="br0">&#40;</span><span class="st0">&quot;%d<span class="es1">\n</span>&quot;</span>, ans.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">size_t</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> i<span class="sy1">&lt;</span>ans.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span> <span class="sy2">++</span>i<span class="br0">&#41;</span>
		<span class="kw3">printf</span> <span class="br0">&#40;</span><span class="st0">&quot;%d &quot;</span>, ans<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy4">;</span>
&nbsp;
<span class="br0">&#125;</span></pre><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><hr><p>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'e-maxx';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script></td></tr></table></body></html>