<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><title>MAXimal :: algo :: Декомпозиция Линдона. Алгоритм Дюваля. Нахождение наименьшего циклического сдвига</title><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><meta name="author" lang="ru" content="e-maxx" /><meta name="description" content="Алгоритмы, олимпиадное программирование, математика" /><meta name="keywords" content="алгоритмы программирование" /><meta name="google-site-verification" content="Pnjjj2XuxB0CTiqgDDvkp79bfSeDQ8Vw57iNeDJZkSc" /><link rel="stylesheet" type="text/css" href="../data/style.css"><script type="text/javascript" src="../data/jquery.js"></script><script type="text/javascript" src="../data/page-contents.js"></script><link rel="stylesheet" type="text/css" href="../geshi/geshi.css"><!--[if IE]><style>.menu a, .menu a:hover { width: 100%; }</style><![endif]--></head><body><table class=main cellpadding=0 cellspacing=0><tr><td class=title colspan=2><p>MAXimal</p></td></tr><tr><td class=menu><ul><li><a href="../index.php.html" >home</a></li><li><a href="index.html" class=current>algo</a></li><li><a href="../bookz/index.html" >bookz</a></li><li><a href="../forum/index.html" >forum</a></li><li><a href="../about.php.html" >about</a></li></ul></td><td class=content><p class=algoinfo>добавлено: 7 Sep 2008 14:40<br>редактировано: 24 Aug 2011 18:36</p><div id="contents-table"><p id="contents-table-title">Содержание <a href="duval_algorithm.html#" id="contents-hide">[скрыть]</a><a href="duval_algorithm.html#" id="contents-show" style="display:none">[показать]</a></p><div style="display:none"></div></div><h1>Декомпозиция Линдона. Алгоритм Дюваля. Нахождение наименьшего циклического сдвига</h1><p><p><h2 style="padding-top:40px;">Понятие декомпозиции Линдона</h2><p>Определим понятие <b>декомпозиции Линдона</b> (Lyndon decomposition).<p>Строка называется <b>простой</b>, если она строго <b>меньше</b> любого своего собственного <b>суффикса</b>. Примеры простых строк: <img class=tex src="../tex2png/cache/e4c9b6bf3a65f2e487e7cb3e199f2154.png" alt="a">, <img class=tex src="../tex2png/cache/64e10b28938db2ba8a2b9fabb72a2cd9.png" alt="b">, <img class=tex src="../tex2png/cache/3698bb2e4986b233d66bcbf5f7f883a6.png" alt="ab">, <img class=tex src="../tex2png/cache/cd7026983b66f2cec787bb0b4f5b1cbc.png" alt="aab">, <img class=tex src="../tex2png/cache/fca899a400472e7fc5c60cfe4547b9b4.png" alt="abb">, <img class=tex src="../tex2png/cache/cf2b79366d673247bffee807f6aab1ee.png" alt="ababb">, <img class=tex src="../tex2png/cache/75d0ce541a0d25a32d1161af3bef0dcf.png" alt="abcd">. Можно показать, что строка является простой тогда и только тогда, когда она строго <b>меньше</b> всех своих нетривиальных <b>циклических сдвигов</b>.<p>Далее, пусть дана строка <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s">. Тогда <b>декомпозицией Линдона</b> строки <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s"> называется её разложение <img class=tex src="../tex2png/cache/1be21fa467ed82c0f746ed78022c1033.png" alt="s = w_1 w_2 \ldots w_k">, где строки <img class=tex src="../tex2png/cache/f4c8be12bd1b15c8f474551356eb71a6.png" alt="w_i"> просты, и при этом <img class=tex src="../tex2png/cache/68c8d39d7c0c95eebb853502337b6170.png" alt="w_1 \ge w_2 \ge \ldots \ge w_k">.<p>Можно показать, что для любой строки <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s"> это разложение существует и единственно.<p><p><h2 style="padding-top:40px;">Алгоритм Дюваля</h2><p><b>Алгоритм Дюваля</b> (Duval's algorithm) находит для данной строки длины <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> декомпозицию Линдона за время <img class=tex src="../tex2png/cache/ad5a094bea72e51fb50321739f51ec0d.png" alt="O (n)"> с использованием <img class=tex src="../tex2png/cache/d0ea0c0a39869a72fadf80b704c58fbf.png" alt="O (1)"> дополнительной памяти.<p>Работать со строками будем в 0-индексации.<p>Введём вспомогательное понятие предпростой строки. Строка <img class=tex src="../tex2png/cache/668c0ed766381807a81b9a534a4a70ce.png" alt="t"> называется <b>предпростой</b>, если она имеет вид <img class=tex src="../tex2png/cache/344617b02ed61056d381845959e24229.png" alt="t = w w w \ldots w \overline{w}">, где <img class=tex src="../tex2png/cache/fee0bf4308e5ab449d0ff8518fb4207e.png" alt="w"> &mdash; некоторая простая строка, а <img class=tex src="../tex2png/cache/8425bdf2ddb31af2f2820d4e5cb4f16f.png" alt="\overline{w}"> &mdash; некоторый префикс строки <img class=tex src="../tex2png/cache/fee0bf4308e5ab449d0ff8518fb4207e.png" alt="w">.<p>Алгоритм Дюваля является жадным. В любой момент его работы строка S фактически разделена на три строки <img class=tex src="../tex2png/cache/596de3fc52d6bee9a7a854672690c8de.png" alt="s = s_1 s_2 s_3">, где в строке <img class=tex src="../tex2png/cache/cd548a9fbb8de35cf44075d674a0c87f.png" alt="s_1"> декомпозиция Линдона уже найдена и <img class=tex src="../tex2png/cache/cd548a9fbb8de35cf44075d674a0c87f.png" alt="s_1"> уже больше не используется алгоритмом; строка <img class=tex src="../tex2png/cache/3ed6054202645738e76ec69ceaab3727.png" alt="s_2"> &mdash; это предпростая строка (причём длину простых строк внутри неё мы также запоминаем); строка <img class=tex src="../tex2png/cache/40a0ba0ae0b98df009b62630c6157c7f.png" alt="s_3"> &mdash; это ещё не обработанная часть строки <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s">. Каждый раз алгоритм Дюваля берёт первый символ строки <img class=tex src="../tex2png/cache/40a0ba0ae0b98df009b62630c6157c7f.png" alt="s_3"> и пытается дописать его к строке <img class=tex src="../tex2png/cache/3ed6054202645738e76ec69ceaab3727.png" alt="s_2">. При этом, возможно, для какого-то префикса строки <img class=tex src="../tex2png/cache/3ed6054202645738e76ec69ceaab3727.png" alt="s_2"> декомпозиция Линдона становится известной, и эта часть переходит к строке <img class=tex src="../tex2png/cache/cd548a9fbb8de35cf44075d674a0c87f.png" alt="s_1">.<p>Опишем теперь алгоритм <b>формально</b>. Во-первых, будет поддерживаться указатель <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i"> на начало строки <img class=tex src="../tex2png/cache/3ed6054202645738e76ec69ceaab3727.png" alt="s_2">. Внешний цикл алгоритма будет выполняться, пока <img class=tex src="../tex2png/cache/8e1ab3720005ae9c76ae3d602ffb886d.png" alt="i < n">, т.е. пока вся строка <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s"> не перейдёт в строку <img class=tex src="../tex2png/cache/cd548a9fbb8de35cf44075d674a0c87f.png" alt="s_1">. Внутри этого цикла создаются два указателя: указатель <img class=tex src="../tex2png/cache/f2761432c5377ee4ded848884be6d407.png" alt="j"> на начало строки <img class=tex src="../tex2png/cache/40a0ba0ae0b98df009b62630c6157c7f.png" alt="s_3"> (фактически указатель на следующий символ-кандидат) и указатель <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> на текущий символ в строке <img class=tex src="../tex2png/cache/3ed6054202645738e76ec69ceaab3727.png" alt="s_2">, с которым будет производиться сравнение. Затем будем в цикле пытаться добавить символ <img class=tex src="../tex2png/cache/6989ece3ad295d18904612384b74598e.png" alt="s[j]"> к строке <img class=tex src="../tex2png/cache/3ed6054202645738e76ec69ceaab3727.png" alt="s_2">, для чего необходимо произвести сравнение с символом <img class=tex src="../tex2png/cache/a16d7150d5b2302c827ba5fd3b610b5b.png" alt="s[k]">. Здесь у нас возникают три различных случая:<p><ul><p><li>Если <img class=tex src="../tex2png/cache/344b02acccbdee4c55146fe78c58804d.png" alt="s[j] = s[k]">, то мы можем дописать символ <img class=tex src="../tex2png/cache/6989ece3ad295d18904612384b74598e.png" alt="s[j]"> к строке <img class=tex src="../tex2png/cache/3ed6054202645738e76ec69ceaab3727.png" alt="s_2">, не нарушив её "предпростоты". Следовательно, в этом случае мы просто увеличиваем указатели <img class=tex src="../tex2png/cache/f2761432c5377ee4ded848884be6d407.png" alt="j"> и <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> на единицу.<p><li>Если <img class=tex src="../tex2png/cache/feb36283ba087ceba37a5403c59d26c3.png" alt="s[j] > s[k]">, то, очевидно, строка <img class=tex src="../tex2png/cache/41c524166f504ecda59fdab4ed8e63c5.png" alt="s_2 + s[j]"> станет простой. Тогда мы увеличиваем <img class=tex src="../tex2png/cache/f2761432c5377ee4ded848884be6d407.png" alt="j"> на единицу, а <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> передвигаем обратно на <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i">, чтобы следующий символ сравнивался с первым символом <img class=tex src="../tex2png/cache/3ed6054202645738e76ec69ceaab3727.png" alt="s_2">.<p><li>Если <img class=tex src="../tex2png/cache/1a537a84675aacef0bcf003abbc22b09.png" alt="s[j] < s[k]">, то строка <img class=tex src="../tex2png/cache/9a7c113f533f15c3000504e49130311c.png" alt="s_2+s[j]"> уже не может быть предпростой. Поэтому мы разбиваем предпростую строку <img class=tex src="../tex2png/cache/3ed6054202645738e76ec69ceaab3727.png" alt="s_2"> на простые строки плюс "остаток" (префикс простой строки, возможно, пустой); простые строки добавляем в ответ (т.е. выводим их позиции, попутно передвигая указатель <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i">), а "остаток" вместе с символом <img class=tex src="../tex2png/cache/6989ece3ad295d18904612384b74598e.png" alt="s[j]"> переводим обратно в строку <img class=tex src="../tex2png/cache/40a0ba0ae0b98df009b62630c6157c7f.png" alt="s_3">, и останавливаем выполнение внутреннего цикла. Тем самым мы на следующей итерации внешнего цикла заново обработаем остаток, зная, что он не мог образовать предпростую строку с предыдущими простыми строками. Осталось только заметить, что при выводе позиций простых строк нам нужно знать их длину; но она, очевидно, равна <img class=tex src="../tex2png/cache/24216e00f142276a767331f664b064a9.png" alt="j-k">.<p></ul><p><p><h3 style="padding-top:15px;">Реализация</h3><p>Приведём реализацию алгоритма Дюваля, которая будет выводить искомую декомпозицию Линдона строки <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s">:<p><pre class="notranslate cpp">string s<span class="sy4">;</span> <span class="co1">// входная строка</span>
<span class="kw4">int</span> n <span class="sy1">=</span> <span class="br0">&#40;</span><span class="kw4">int</span><span class="br0">&#41;</span> s.<span class="me1">length</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span>
<span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span>
<span class="kw1">while</span> <span class="br0">&#40;</span>i <span class="sy1">&lt;</span> n<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	<span class="kw4">int</span> j<span class="sy1">=</span>i<span class="sy2">+</span><span class="nu0">1</span>, k<span class="sy1">=</span>i<span class="sy4">;</span>
	<span class="kw1">while</span> <span class="br0">&#40;</span>j <span class="sy1">&lt;</span> n <span class="sy3">&amp;&amp;</span> s<span class="br0">&#91;</span>k<span class="br0">&#93;</span> <span class="sy1">&lt;=</span> s<span class="br0">&#91;</span>j<span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span>s<span class="br0">&#91;</span>k<span class="br0">&#93;</span> <span class="sy1">&lt;</span> s<span class="br0">&#91;</span>j<span class="br0">&#93;</span><span class="br0">&#41;</span>
			k <span class="sy1">=</span> i<span class="sy4">;</span>
		<span class="kw1">else</span>
			<span class="sy2">++</span>k<span class="sy4">;</span>
		<span class="sy2">++</span>j<span class="sy4">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">while</span> <span class="br0">&#40;</span>i <span class="sy1">&lt;=</span> k<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw3">cout</span> <span class="sy1">&lt;&lt;</span> s.<span class="me1">substr</span> <span class="br0">&#40;</span>i, j<span class="sy2">-</span>k<span class="br0">&#41;</span> <span class="sy1">&lt;&lt;</span> <span class="st0">' '</span><span class="sy4">;</span>
		i <span class="sy2">+</span><span class="sy1">=</span> j <span class="sy2">-</span> k<span class="sy4">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre><p><p><h3 style="padding-top:15px;">Асимптотика</h3><p>Сразу заметим, что для алгоритма Дюваля требуется <b><img class=tex src="../tex2png/cache/d0ea0c0a39869a72fadf80b704c58fbf.png" alt="O (1)"> памяти</b>, а именно три указателя <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i">, <img class=tex src="../tex2png/cache/f2761432c5377ee4ded848884be6d407.png" alt="j">, <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k">.<p>Оценим теперь <b>время работы</b> алгоритма.<p><b>Внешний цикл while</b> делает не более <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> итераций, поскольку в конце каждой его итерации выводится как минимум один символ (а всего символов выводится, очевидно, ровно <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n">).<p>Оценим теперь количество итераций <b>первого вложенного цикла while</b>. Для этого рассмотрим второй вложенный цикл while &mdash; он при каждом своём запуске выводит некоторое количество <img class=tex src="../tex2png/cache/a84a88937ba0924b3d7b57d0e07e394d.png" alt="r \ge 1"> копий одной и той же простой строки некоторой длины <img class=tex src="../tex2png/cache/6172e4a9aa7d91de200bf5ce5bc7ce5d.png" alt="p = j-k">. Заметим, что строка <img class=tex src="../tex2png/cache/3ed6054202645738e76ec69ceaab3727.png" alt="s_2"> является предпростой, причём её простые строки имеют длину как раз <img class=tex src="../tex2png/cache/2f8934466bea85c9661745280df23800.png" alt="p">, т.е. её длина не превосходит <img class=tex src="../tex2png/cache/5e46cda5eefe6b003a5b286be6277437.png" alt="r p + p - 1">. Поскольку длина строки <img class=tex src="../tex2png/cache/3ed6054202645738e76ec69ceaab3727.png" alt="s_2"> равна <img class=tex src="../tex2png/cache/3de437f6423080e66fd44e37edd0d925.png" alt="j-i">, а указатель <img class=tex src="../tex2png/cache/f2761432c5377ee4ded848884be6d407.png" alt="j"> увеличивается по единице на каждой итерации первого вложенного цикла while, то этот цикл выполнит не более <img class=tex src="../tex2png/cache/c4ea020374bd6bb5dce3282b8576d397.png" alt="r p + p - 2"> итераций. Худшим случаем является случай <img class=tex src="../tex2png/cache/5b93abc2cd0acff6f08f73bbf31c0709.png" alt="r = 1">, и мы получаем, что первый вложенный цикл while всякий раз выполняет не более <img class=tex src="../tex2png/cache/4cb4e5463874118445f71a259d7365d1.png" alt="2 p - 2"> итераций. Вспоминая, что всего выводится <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> символов, получаем, что для вывода <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> символов требуется не более <img class=tex src="../tex2png/cache/7dc20332403ca8ffa2a3204eea652659.png" alt="2 n - 2"> итераций первого вложенного while-а.<p>Следовательно, <b>алгоритм Дюваля выполняется за <img class=tex src="../tex2png/cache/ad5a094bea72e51fb50321739f51ec0d.png" alt="O (n)"></b>.<p>Легко оценить и число сравнений символов, выполняемых алгоритмом Дюваля. Поскольку каждая итерация первого вложенного цикла while производит два сравнения символов, а также одно сравнение производится после последней итерации цикла (чтобы понять, что цикл должен остановиться), то общее <b>число сравнений символов</b> не превосходит <img class=tex src="../tex2png/cache/6a6d28f76dfab56ced69bba8ef052bbd.png" alt="4 n - 3">.<p><p><h2 style="padding-top:40px;">Нахождение наименьшего циклического сдвига</h2><p>Пусть дана строка <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s">. Построим для строки <img class=tex src="../tex2png/cache/7c705d862f1dccbdda91b430167bc0f7.png" alt="s+s"> декомпозицию Линдона (мы можем это сделать за <img class=tex src="../tex2png/cache/ad5a094bea72e51fb50321739f51ec0d.png" alt="O (n)"> времени и <img class=tex src="../tex2png/cache/d0ea0c0a39869a72fadf80b704c58fbf.png" alt="O (1)"> памяти (если не выполнять конкатенацию в явном виде)). Найдём предпростой блок, который начинается в позиции, меньшей <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> (т.е. в первом экземпляре строки <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s">), и заканчивается в позиции, большей или равной n (т.е. во втором экземпляре). Утверждается, что <b>позиция начала</b> этого блока и будет началом искомого циклического сдвига (в этом легко убедиться, воспользовавшись определением декомпозиции Линдона).<p>Начало предпростого блока найти просто &mdash; достаточно заметить, что указатель <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i"> в начале каждой итерации внешнего цикла while указывает на начало текущего предпростого блока.<p>Итого мы получаем такую <b>реализацию</b> (для упрощения кода она использует <img class=tex src="../tex2png/cache/ad5a094bea72e51fb50321739f51ec0d.png" alt="O (n)"> памяти, явным образом дописывая строку к себе):<p><pre class="notranslate cpp">string min_cyclic_shift <span class="br0">&#40;</span>string s<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	s <span class="sy2">+</span><span class="sy1">=</span> s<span class="sy4">;</span>
	<span class="kw4">int</span> n <span class="sy1">=</span> <span class="br0">&#40;</span><span class="kw4">int</span><span class="br0">&#41;</span> s.<span class="me1">length</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span>
	<span class="kw4">int</span> i<span class="sy1">=</span><span class="nu0">0</span>, ans<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span>
	<span class="kw1">while</span> <span class="br0">&#40;</span>i <span class="sy1">&lt;</span> n<span class="sy2">/</span><span class="nu0">2</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
		ans <span class="sy1">=</span> i<span class="sy4">;</span>
		<span class="kw4">int</span> j<span class="sy1">=</span>i<span class="sy2">+</span><span class="nu0">1</span>, k<span class="sy1">=</span>i<span class="sy4">;</span>
		<span class="kw1">while</span> <span class="br0">&#40;</span>j <span class="sy1">&lt;</span> n <span class="sy3">&amp;&amp;</span> s<span class="br0">&#91;</span>k<span class="br0">&#93;</span> <span class="sy1">&lt;=</span> s<span class="br0">&#91;</span>j<span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
			<span class="kw1">if</span> <span class="br0">&#40;</span>s<span class="br0">&#91;</span>k<span class="br0">&#93;</span> <span class="sy1">&lt;</span> s<span class="br0">&#91;</span>j<span class="br0">&#93;</span><span class="br0">&#41;</span>
				k <span class="sy1">=</span> i<span class="sy4">;</span>
			<span class="kw1">else</span>
				<span class="sy2">++</span>k<span class="sy4">;</span>
			<span class="sy2">++</span>j<span class="sy4">;</span>
		<span class="br0">&#125;</span>
		<span class="kw1">while</span> <span class="br0">&#40;</span>i <span class="sy1">&lt;=</span> k<span class="br0">&#41;</span>  i <span class="sy2">+</span><span class="sy1">=</span> j <span class="sy2">-</span> k<span class="sy4">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">return</span> s.<span class="me1">substr</span> <span class="br0">&#40;</span>ans, n<span class="sy2">/</span><span class="nu0">2</span><span class="br0">&#41;</span><span class="sy4">;</span>
<span class="br0">&#125;</span></pre><p><p><h2 style="padding-top:40px;"> Задачи в online judges </h2><p>Список задач, которые можно решить, используя алгоритм Дюваля:<p><ul><p><li><a href="http://uva.onlinejudge.org/index.php?option=onlinejudge&page=show_problem&problem=660">UVA #719 <b>"Glass Beads"</b> &nbsp;&nbsp;&nbsp;&nbsp; [сложность: низкая]</a><p></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><hr><p>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'e-maxx';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script></td></tr></table></body></html>