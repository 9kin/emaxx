<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><title>MAXimal :: algo :: Перебор всех подмасок данной маски. Оценка 3^N</title><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><meta name="author" lang="ru" content="e-maxx" /><meta name="description" content="Алгоритмы, олимпиадное программирование, математика" /><meta name="keywords" content="алгоритмы программирование" /><meta name="google-site-verification" content="Pnjjj2XuxB0CTiqgDDvkp79bfSeDQ8Vw57iNeDJZkSc" /><link rel="stylesheet" type="text/css" href="../data/style.css"><script type="text/javascript" src="../data/jquery.js"></script><script type="text/javascript" src="../data/page-contents.js"></script><link rel="stylesheet" type="text/css" href="../geshi/geshi.css"><!--[if IE]><style>.menu a, .menu a:hover { width: 100%; }</style><![endif]--></head><body><table class=main cellpadding=0 cellspacing=0><tr><td class=title colspan=2><p>MAXimal</p></td></tr><tr><td class=menu><ul><li><a href="../index.php.html" >home</a></li><li><a href="index.html" class=current>algo</a></li><li><a href="../bookz/index.html" >bookz</a></li><li><a href="../forum/index.html" >forum</a></li><li><a href="../about.php.html" >about</a></li></ul></td><td class=content><p class=algoinfo>добавлено: 16 Jan 2009 0:58<br>редактировано: 25 Apr 2012 3:11</p><div id="contents-table"><p id="contents-table-title">Содержание <a href="all_submasks.html#" id="contents-hide">[скрыть]</a><a href="all_submasks.html#" id="contents-show" style="display:none">[показать]</a></p><div style="display:none"></div></div><h1> Перебор всех подмасок данной маски </h1><p><p><h2 style="padding-top:40px;"> Перебор подмасок фиксированной маски </h2><p>Дана битовая маска <img class=tex src="../tex2png/cache/4f70748eaed5e0c2c70d7e899166ee1d.png" alt="m">. Требуется эффективно перебрать все её подмаски, т.е. такие маски <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s">, в которых могут быть включены только те биты, которые были включены в маске <img class=tex src="../tex2png/cache/4f70748eaed5e0c2c70d7e899166ee1d.png" alt="m">.<p>Сразу рассмотрим реализацию этого алгоритма, основанную на трюках с битовыми операциями:<p><pre class="notranslate cpp"><span class="kw4">int</span> s <span class="sy1">=</span> m<span class="sy4">;</span>
<span class="kw1">while</span> <span class="br0">&#40;</span>s <span class="sy1">&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
	... можно использовать s ...
	<span class="me1">s</span> <span class="sy1">=</span> <span class="br0">&#40;</span>s<span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span> <span class="sy3">&amp;</span> m<span class="sy4">;</span>
<span class="br0">&#125;</span></pre><p>или, используя более компактный оператор <img class=tex src="../tex2png/cache/e4bd34533fcaa5c6bb8560a9ced4c800.png" alt="for">:<p><pre class="notranslate cpp"><span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> s<span class="sy1">=</span>m<span class="sy4">;</span> s<span class="sy4">;</span> s<span class="sy1">=</span><span class="br0">&#40;</span>s<span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy3">&amp;</span>m<span class="br0">&#41;</span>
	... можно использовать s ...</pre><p>Единственное исключение для обоих вариантов кода &mdash; подмаска, равная нулю, обработана не будет. Её обработку придётся выносить из цикла, или использовать менее изящную конструкцию, например:<p><pre class="notranslate cpp"><span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> s<span class="sy1">=</span>m<span class="sy4">;</span> <span class="sy4">;</span> s<span class="sy1">=</span><span class="br0">&#40;</span>s<span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy3">&amp;</span>m<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	... можно использовать s ...
	<span class="kw1">if</span> <span class="br0">&#40;</span>s<span class="sy1">==</span><span class="nu0">0</span><span class="br0">&#41;</span>  <span class="kw1">break</span><span class="sy4">;</span>
<span class="br0">&#125;</span></pre><p>Разберём, почему приведённый выше код действительно находит все подмаски данной маски, причём без повторений, за O (их количества), и в порядке убывания.<p>Пусть у нас есть текущая подмаска <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s">, и мы хотим перейти к следующей подмаске. Отнимем от маски <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s"> единицу, тем самым мы снимем самый правый единичный бит, а все биты правее него поставятся в <img class=tex src="../tex2png/cache/1737ac55fdbc871d8c7d14245b749ccd.png" alt="1">. Затем удалим все "лишние" единичные биты, которые не входят в маску <img class=tex src="../tex2png/cache/4f70748eaed5e0c2c70d7e899166ee1d.png" alt="m"> и потому не могут входить в подмаску. Удаление осуществляется битовой операцией <img class=tex src="../tex2png/cache/852e8bd810036e88d3bbcc64e22efda4.png" alt="\& m">. В результате мы "обрежем" маску <img class=tex src="../tex2png/cache/b0451fe797222182070d187d7a4031dc.png" alt="s-1"> до того наибольшего значения, которое она может принять, т.е. до следующей подмаски после <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s"> в порядке убывания.<p>Таким образом, этот алгоритм генерирует все подмаски данной маски в порядке строгого убывания, затрачивая на каждый переход по две элементарные операции.<p>Особо рассмотрим момент, когда <img class=tex src="../tex2png/cache/ed839d5613296505b41ca782f510329b.png" alt="s = 0">. После выполнения <img class=tex src="../tex2png/cache/b0451fe797222182070d187d7a4031dc.png" alt="s-1"> мы получим маску, в которой все биты включены (битовое представление числа <img class=tex src="../tex2png/cache/fc5f9135f75a6da19325dc3822484bbd.png" alt="-1">), и после удаления лишних битов операцией <img class=tex src="../tex2png/cache/e834e886540a4d75f882dcea3507de77.png" alt="(s-1) \& m"> получится не что иное, как маска <img class=tex src="../tex2png/cache/4f70748eaed5e0c2c70d7e899166ee1d.png" alt="m">. Поэтому с маской <img class=tex src="../tex2png/cache/ed839d5613296505b41ca782f510329b.png" alt="s = 0"> следует быть осторожным &mdash; если вовремя не остановиться на нулевой маске, то алгоритм может войти в бесконечный цикл.<p><p><h2 style="padding-top:40px;"> Перебор всех масок с их подмасками. Оценка <img class=tex src="../tex2png/cache/8c2ae8f8522dfa6b2db35a9ba5e9c3df.png" alt="3^n"> </h2><p>Во многих задачах, особенно на динамическое программирование по маскам, требуется перебирать все маски, и для каждой маски - все подмаски:<p><pre class="notranslate cpp"><span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> m<span class="sy1">=</span><span class="nu0">0</span><span class="sy4">;</span> m<span class="sy1">&lt;</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="sy1">&lt;&lt;</span>n<span class="br0">&#41;</span><span class="sy4">;</span> <span class="sy2">++</span>m<span class="br0">&#41;</span>
	<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> s<span class="sy1">=</span>m<span class="sy4">;</span> s<span class="sy4">;</span> s<span class="sy1">=</span><span class="br0">&#40;</span>s<span class="sy2">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy3">&amp;</span>m<span class="br0">&#41;</span>
		... использование s и m ...</pre><p>Докажем, что внутренний цикл суммарно выполнит <img class=tex src="../tex2png/cache/28e258b9c4ea986e73f2b3739dcc2be9.png" alt="O (3^n)"> итераций.<p><b>Доказательство: 1 способ</b>. Рассмотрим <img class=tex src="../tex2png/cache/2d9d1096e116db33bc39a0accf4e9ef7.png" alt="i">-ый бит. Для него, вообще говоря, есть ровно три варианта: он не входит в маску <img class=tex src="../tex2png/cache/4f70748eaed5e0c2c70d7e899166ee1d.png" alt="m"> (и потому в подмаску <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s">); он входит в <img class=tex src="../tex2png/cache/4f70748eaed5e0c2c70d7e899166ee1d.png" alt="m">, но не входит в <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s">; он входит в <img class=tex src="../tex2png/cache/4f70748eaed5e0c2c70d7e899166ee1d.png" alt="m"> и в <img class=tex src="../tex2png/cache/342d607718e99ee38ba275df55ced44e.png" alt="s">. Всего битов <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n">, поэтому всего различных комбинаций будет <img class=tex src="../tex2png/cache/7ca2ebdcb7f5db689ed93f2206ca2933.png" alt="3^n">, что и требовалось доказать.<p><b>Доказательство: 2 способ</b>. Заметим, что если маска <img class=tex src="../tex2png/cache/4f70748eaed5e0c2c70d7e899166ee1d.png" alt="m"> имеет <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> включённых битов, то она будет иметь <img class=tex src="../tex2png/cache/a631b6ee74bdfc6711813da7ca95a648.png" alt="2^k"> подмасок. Поскольку масок длины <img class=tex src="../tex2png/cache/8bc19c5640342f9c5ad0ba16baf59981.png" alt="n"> с <img class=tex src="../tex2png/cache/252410059470b019db6fd4c3b844a348.png" alt="k"> включёнными битами есть <img class=tex src="../tex2png/cache/c9a0f1213ba475c08fdecd5df29a7fdd.png" alt="C_n^k"> (см. <a href="binomial_coeff.html">"биномиальные коэффициенты"</a>), то всего комбинаций будет:<p><p class=formula><img class=tex src="../tex2png/cache/5621fbc2dcfc627b963cbf38da600d17.png" alt=" \sum_{k=0}^n C_n^k 2^k. "></p><p>Посчитаем эту сумму. Для этого заметим, что она есть не что иное, как разложение в бином Ньютона выражения <img class=tex src="../tex2png/cache/9136797fc0f1d2c58f871c8e27b7e8ed.png" alt="(1+2)^n">, т.е. <img class=tex src="../tex2png/cache/7ca2ebdcb7f5db689ed93f2206ca2933.png" alt="3^n">, что и требовалось доказать.<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><hr><p>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'e-maxx';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script></td></tr></table></body></html>